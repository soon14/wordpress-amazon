
(function(){var u=this,P=u._,q={},m=Array.prototype,r=Object.prototype,v=m.push,j=m.slice,s=m.concat,o=r.toString,Q=r.hasOwnProperty,B=m.forEach,C=m.map,D=m.reduce,E=m.reduceRight,F=m.filter,G=m.every,H=m.some,t=m.indexOf,I=m.lastIndexOf;r=Array.isArray;var R=Object.keys,w=Function.prototype.bind,c=function(a){if(a instanceof c)return a;if(!(this instanceof c))return new c(a);this._wrapped=a};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=c;
exports._=c}else u._=c;c.VERSION="1.4.4";var k=c.each=c.forEach=function(a,b,d){if(a!=null)if(B&&a.forEach===B)a.forEach(b,d);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++){if(b.call(d,a[e],e,a)===q)return}else for(e in a)if(c.has(a,e))if(b.call(d,a[e],e,a)===q)return};c.map=c.collect=function(a,b,d){var e=[];if(a==null)return e;if(C&&a.map===C)return a.map(b,d);k(a,function(f,g,h){e[e.length]=b.call(d,f,g,h)});return e};c.reduce=c.foldl=c.inject=function(a,b,d,e){var f=arguments.length>
2;if(a==null)a=[];if(D&&a.reduce===D){if(e)b=c.bind(b,e);return f?a.reduce(b,d):a.reduce(b)}k(a,function(g,h,i){if(f)d=b.call(e,d,g,h,i);else{d=g;f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};c.reduceRight=c.foldr=function(a,b,d,e){var f=arguments.length>2;if(a==null)a=[];if(E&&a.reduceRight===E){if(e)b=c.bind(b,e);return f?a.reduceRight(b,d):a.reduceRight(b)}var g=a.length;if(g!==+g){var h=c.keys(a);g=h.length}k(a,function(i,l,n){l=h?h[--g]:--g;if(f)d=
b.call(e,d,a[l],l,n);else{d=a[l];f=true}});if(!f)throw new TypeError("Reduce of empty array with no initial value");return d};c.find=c.detect=function(a,b,d){var e;J(a,function(f,g,h){if(b.call(d,f,g,h)){e=f;return true}});return e};c.filter=c.select=function(a,b,d){var e=[];if(a==null)return e;if(F&&a.filter===F)return a.filter(b,d);k(a,function(f,g,h){if(b.call(d,f,g,h))e[e.length]=f});return e};c.reject=function(a,b,d){return c.filter(a,function(e,f,g){return!b.call(d,e,f,g)},d)};c.every=c.all=
function(a,b,d){b||(b=c.identity);var e=true;if(a==null)return e;if(G&&a.every===G)return a.every(b,d);k(a,function(f,g,h){if(!(e=e&&b.call(d,f,g,h)))return q});return!!e};var J=c.some=c.any=function(a,b,d){b||(b=c.identity);var e=false;if(a==null)return e;if(H&&a.some===H)return a.some(b,d);k(a,function(f,g,h){if(e||(e=b.call(d,f,g,h)))return q});return!!e};c.contains=c.include=function(a,b){if(a==null)return false;if(t&&a.indexOf===t)return a.indexOf(b)!=-1;return J(a,function(d){return d===b})};
c.invoke=function(a,b){var d=j.call(arguments,2),e=c.isFunction(b);return c.map(a,function(f){return(e?b:f[b]).apply(f,d)})};c.pluck=function(a,b){return c.map(a,function(d){return d[b]})};c.where=function(a,b,d){if(c.isEmpty(b))return d?null:[];return c[d?"find":"filter"](a,function(e){for(var f in b)if(b[f]!==e[f])return false;return true})};c.findWhere=function(a,b){return c.where(a,b,true)};c.max=function(a,b,d){if(!b&&c.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&
c.isEmpty(a))return-Infinity;var e={computed:-Infinity,value:-Infinity};k(a,function(f,g,h){g=b?b.call(d,f,g,h):f;g>=e.computed&&(e={value:f,computed:g})});return e.value};c.min=function(a,b,d){if(!b&&c.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&c.isEmpty(a))return Infinity;var e={computed:Infinity,value:Infinity};k(a,function(f,g,h){g=b?b.call(d,f,g,h):f;g<e.computed&&(e={value:f,computed:g})});return e.value};c.shuffle=function(a){var b,d=0,e=[];k(a,function(f){b=
c.random(d++);e[d-1]=e[b];e[b]=f});return e};var x=function(a){return c.isFunction(a)?a:function(b){return b[a]}};c.sortBy=function(a,b,d){var e=x(b);return c.pluck(c.map(a,function(f,g,h){return{value:f,index:g,criteria:e.call(d,f,g,h)}}).sort(function(f,g){var h=f.criteria,i=g.criteria;if(h!==i){if(h>i||h===void 0)return 1;if(h<i||i===void 0)return-1}return f.index<g.index?-1:1}),"value")};var K=function(a,b,d,e){var f={},g=x(b||c.identity);k(a,function(h,i){i=g.call(d,h,i,a);e(f,i,h)});return f};
c.groupBy=function(a,b,d){return K(a,b,d,function(e,f,g){(c.has(e,f)?e[f]:(e[f]=[])).push(g)})};c.countBy=function(a,b,d){return K(a,b,d,function(e,f){c.has(e,f)||(e[f]=0);e[f]++})};c.sortedIndex=function(a,b,d,e){d=d==null?c.identity:x(d);b=d.call(e,b);for(var f=0,g=a.length;f<g;){var h=f+g>>>1;d.call(e,a[h])<b?(f=h+1):(g=h)}return f};c.toArray=function(a){if(!a)return[];if(c.isArray(a))return j.call(a);if(a.length===+a.length)return c.map(a,c.identity);return c.values(a)};c.size=function(a){if(a==
null)return 0;return a.length===+a.length?a.length:c.keys(a).length};c.first=c.head=c.take=function(a,b,d){if(a!=null)return b!=null&&!d?j.call(a,0,b):a[0]};c.initial=function(a,b,d){return j.call(a,0,a.length-(b==null||d?1:b))};c.last=function(a,b,d){if(a!=null)return b!=null&&!d?j.call(a,Math.max(a.length-b,0)):a[a.length-1]};c.rest=c.tail=c.drop=function(a,b,d){return j.call(a,b==null||d?1:b)};c.compact=function(a){return c.filter(a,c.identity)};var L=function(a,b,d){k(a,function(e){if(c.isArray(e))b?
v.apply(d,e):L(e,b,d);else d.push(e)});return d};c.flatten=function(a,b){return L(a,b,[])};c.without=function(a){return c.difference(a,j.call(arguments,1))};c.uniq=c.unique=function(a,b,d,e){if(c.isFunction(b)){e=d;d=b;b=false}d=d?c.map(a,d,e):a;var f=[],g=[];k(d,function(h,i){if(b?!i||g[g.length-1]!==h:!c.contains(g,h)){g.push(h);f.push(a[i])}});return f};c.union=function(){return c.uniq(s.apply(m,arguments))};c.intersection=function(a){var b=j.call(arguments,1);return c.filter(c.uniq(a),function(d){return c.every(b,
function(e){return c.indexOf(e,d)>=0})})};c.difference=function(a){var b=s.apply(m,j.call(arguments,1));return c.filter(a,function(d){return!c.contains(b,d)})};c.zip=function(){for(var a=j.call(arguments),b=c.max(c.pluck(a,"length")),d=new Array(b),e=0;e<b;e++)d[e]=c.pluck(a,""+e);return d};c.object=function(a,b){if(a==null)return{};for(var d={},e=0,f=a.length;e<f;e++)if(b)d[a[e]]=b[e];else d[a[e][0]]=a[e][1];return d};c.indexOf=function(a,b,d){if(a==null)return-1;var e=0,f=a.length;if(d)if(typeof d==
"number")e=d<0?Math.max(0,f+d):d;else{e=c.sortedIndex(a,b);return a[e]===b?e:-1}if(t&&a.indexOf===t)return a.indexOf(b,d);for(;e<f;e++)if(a[e]===b)return e;return-1};c.lastIndexOf=function(a,b,d){if(a==null)return-1;var e=d!=null;if(I&&a.lastIndexOf===I)return e?a.lastIndexOf(b,d):a.lastIndexOf(b);for(d=e?d:a.length;d--;)if(a[d]===b)return d;return-1};c.range=function(a,b,d){if(arguments.length<=1){b=a||0;a=0}d=arguments[2]||1;for(var e=Math.max(Math.ceil((b-a)/d),0),f=0,g=new Array(e);f<e;){g[f++]=
a;a+=d}return g};c.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,j.call(arguments,1));var d=j.call(arguments,2);return function(){return a.apply(b,d.concat(j.call(arguments)))}};c.partial=function(a){var b=j.call(arguments,1);return function(){return a.apply(this,b.concat(j.call(arguments)))}};c.bindAll=function(a){var b=j.call(arguments,1);if(b.length===0)b=c.functions(a);k(b,function(d){a[d]=c.bind(a[d],a)});return a};c.memoize=function(a,b){var d={};b||(b=c.identity);return function(){var e=
b.apply(this,arguments);return c.has(d,e)?d[e]:(d[e]=a.apply(this,arguments))}};c.delay=function(a,b){var d=j.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},b)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(j.call(arguments,1)))};c.throttle=function(a,b){var d,e,f,g,h=0,i=function(){h=new Date;f=null;g=a.apply(d,e)};return function(){var l=new Date,n=b-(l-h);d=this;e=arguments;if(n<=0){clearTimeout(f);f=null;h=l;g=a.apply(d,e)}else f||(f=setTimeout(i,n));return g}};
c.debounce=function(a,b,d){var e,f;return function(){var g=this,h=arguments,i=d&&!e;clearTimeout(e);e=setTimeout(function(){e=null;d||(f=a.apply(g,h))},b);if(i)f=a.apply(g,h);return f}};c.once=function(a){var b=false,d;return function(){if(b)return d;b=true;d=a.apply(this,arguments);a=null;return d}};c.wrap=function(a,b){return function(){var d=[a];v.apply(d,arguments);return b.apply(this,d)}};c.compose=function(){var a=arguments;return function(){for(var b=arguments,d=a.length-1;d>=0;d--)b=[a[d].apply(this,
b)];return b[0]}};c.after=function(a,b){if(a<=0)return b();return function(){if(--a<1)return b.apply(this,arguments)}};c.keys=R||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var d in a)if(c.has(a,d))b[b.length]=d;return b};c.values=function(a){var b=[];for(var d in a)c.has(a,d)&&b.push(a[d]);return b};c.pairs=function(a){var b=[];for(var d in a)c.has(a,d)&&b.push([d,a[d]]);return b};c.invert=function(a){var b={};for(var d in a)if(c.has(a,d))b[a[d]]=d;return b};c.functions=
c.methods=function(a){var b=[];for(var d in a)c.isFunction(a[d])&&b.push(d);return b.sort()};c.extend=function(a){k(j.call(arguments,1),function(b){if(b)for(var d in b)a[d]=b[d]});return a};c.pick=function(a){var b={},d=s.apply(m,j.call(arguments,1));k(d,function(e){if(e in a)b[e]=a[e]});return b};c.omit=function(a){var b={},d=s.apply(m,j.call(arguments,1));for(var e in a)c.contains(d,e)||(b[e]=a[e]);return b};c.defaults=function(a){k(j.call(arguments,1),function(b){if(b)for(var d in b)if(a[d]==null)a[d]=
b[d]});return a};c.clone=function(a){if(!c.isObject(a))return a;return c.isArray(a)?a.slice():c.extend({},a)};c.tap=function(a,b){b(a);return a};var y=function(a,b,d,e){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof c)a=a._wrapped;if(b instanceof c)b=b._wrapped;var f=o.call(a);if(f!=o.call(b))return false;switch(f){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==
+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return false;for(var g=d.length;g--;)if(d[g]==a)return e[g]==b;d.push(a);e.push(b);g=0;var h=true;if(f=="[object Array]"){g=a.length;if(h=g==b.length)for(;g--;)if(!(h=y(a[g],b[g],d,e)))break}else{f=a.constructor;var i=b.constructor;if(f!==i&&!(c.isFunction(f)&&f instanceof f&&c.isFunction(i)&&i instanceof i))return false;for(var l in a)if(c.has(a,
l)){g++;if(!(h=c.has(b,l)&&y(a[l],b[l],d,e)))break}if(h){for(l in b)if(c.has(b,l)&&!g--)break;h=!g}}d.pop();e.pop();return h};c.isEqual=function(a,b){return y(a,b,[],[])};c.isEmpty=function(a){if(a==null)return true;if(c.isArray(a)||c.isString(a))return a.length===0;for(var b in a)if(c.has(a,b))return false;return true};c.isElement=function(a){return!!(a&&a.nodeType===1)};c.isArray=r||function(a){return o.call(a)=="[object Array]"};c.isObject=function(a){return a===Object(a)};k(["Arguments","Function",
"String","Number","Date","RegExp"],function(a){c["is"+a]=function(b){return o.call(b)=="[object "+a+"]"}});if(!c.isArguments(arguments))c.isArguments=function(a){return!!(a&&c.has(a,"callee"))};if(typeof/./!=="function")c.isFunction=function(a){return typeof a==="function"};c.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};c.isNaN=function(a){return c.isNumber(a)&&a!=+a};c.isBoolean=function(a){return a===true||a===false||o.call(a)=="[object Boolean]"};c.isNull=function(a){return a===
null};c.isUndefined=function(a){return a===void 0};c.has=function(a,b){return Q.call(a,b)};c.noConflict=function(){u._=P;return this};c.identity=function(a){return a};c.times=function(a,b,d){for(var e=Array(a),f=0;f<a;f++)e[f]=b.call(d,f);return e};c.random=function(a,b){if(b==null){b=a;a=0}return a+Math.floor(Math.random()*(b-a+1))};var p={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};p.unescape=c.invert(p.escape);var S={escape:new RegExp("["+c.keys(p.escape).join("")+
"]","g"),unescape:new RegExp("("+c.keys(p.unescape).join("|")+")","g")};c.each(["escape","unescape"],function(a){c[a]=function(b){if(b==null)return"";return(""+b).replace(S[a],function(d){return p[a][d]})}});c.result=function(a,b){if(a==null)return null;b=a[b];return c.isFunction(b)?b.call(a):b};c.mixin=function(a){k(c.functions(a),function(b){var d=c[b]=a[b];c.prototype[b]=function(){var e=[this._wrapped];v.apply(e,arguments);return z.call(this,d.apply(c,e))}})};var T=0;c.uniqueId=function(a){var b=
++T+"";return a?a+b:b};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;c.template=function(a,b,d){var e;d=c.defaults({},d,c.templateSettings);var f=new RegExp([(d.escape||A).source,(d.interpolate||A).source,(d.evaluate||A).source].join("|")+"|$","g"),g=0,h="__p+='";a.replace(f,function(l,n,M,N,O){h+=a.slice(g,O).replace(V,
function(W){return"\\"+U[W]});if(n)h+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'";if(M)h+="'+\n((__t=("+M+"))==null?'':__t)+\n'";if(N)h+="';\n"+N+"\n__p+='";g=O+l.length;return l});h+="';\n";d.variable||(h="with(obj||{}){\n"+h+"}\n");h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{e=new Function(d.variable||"obj","_",h)}catch(i){i.source=h;throw i;}if(b)return e(b,c);b=function(l){return e.call(this,l,c)};b.source="function("+
(d.variable||"obj")+"){\n"+h+"}";return b};c.chain=function(a){return c(a).chain()};var z=function(a){return this._chain?c(a).chain():a};c.mixin(c);k(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=m[a];c.prototype[a]=function(){var d=this._wrapped;b.apply(d,arguments);if((a=="shift"||a=="splice")&&d.length===0)delete d[0];return z.call(this,d)}});k(["concat","join","slice"],function(a){var b=m[a];c.prototype[a]=function(){return z.call(this,b.apply(this._wrapped,arguments))}});
c.extend(c.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);

(function(){var o=this,B=o.Backbone,m=[],C=m.push,t=m.slice,D=m.splice,h;h=typeof exports!=="undefined"?exports:(o.Backbone={});h.VERSION="0.9.10";var f=o._;if(!f&&typeof require!=="undefined")f=require("underscore");h.$=o.jQuery||o.Zepto||o.ender;h.noConflict=function(){o.Backbone=B;return this};h.emulateHTTP=false;h.emulateJSON=false;var u=/\s+/,q=function(a,b,c,d){if(!c)return true;if(typeof c==="object")for(var e in c)a[b].apply(a,[e,c[e]].concat(d));else if(u.test(c)){c=c.split(u);e=0;for(var g=
c.length;e<g;e++)a[b].apply(a,[c[e]].concat(d))}else return true},v=function(a,b){var c,d=-1,e=a.length;switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0]);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1]);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,b[0],b[1],b[2]);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}};m=h.Events={on:function(a,b,c){if(!(q(this,"on",a,[b,c])&&b))return this;
this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,ctx:c||this});return this},once:function(a,b,c){if(!(q(this,"once",a,[b,c])&&b))return this;var d=this,e=f.once(function(){d.off(a,e);b.apply(this,arguments)});e._callback=b;this.on(a,e,c);return this},off:function(a,b,c){var d,e,g,j,k,i,l,p;if(!this._events||!q(this,"off",a,[b,c]))return this;if(!a&&!b&&!c){this._events={};return this}j=a?[a]:f.keys(this._events);k=0;for(i=j.length;k<i;k++){a=j[k];
if(d=this._events[a]){g=[];if(b||c){l=0;for(p=d.length;l<p;l++){e=d[l];if(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)g.push(e)}}this._events[a]=g}}return this},trigger:function(a){if(!this._events)return this;var b=t.call(arguments,1);if(!q(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;c&&v(c,b);d&&v(d,arguments);return this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),e=a._listenerId||(a._listenerId=f.uniqueId("l"));d[e]=a;a.on(b,
typeof b==="object"?this:c,this);return this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a){a.off(b,typeof b==="object"?this:c,this);!b&&!c&&delete d[a._listenerId]}else{if(typeof b==="object")c=this;for(var e in d)d[e].off(b,c,this);this._listeners={}}return this}}};m.bind=m.on;m.unbind=m.off;f.extend(h,m);var r=h.Model=function(a,b){var c,d=a||{};this.cid=f.uniqueId("c");this.attributes={};if(b&&b.collection)this.collection=b.collection;if(b&&b.parse)d=this.parse(d,b)||{};if(c=
f.result(this,"defaults"))d=f.defaults({},d,c);this.set(d,b);this.changed={};this.initialize.apply(this,arguments)};f.extend(r.prototype,m,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(a,b,c){var d,e,g,j,k,i,l;if(a==null)return this;if(typeof a===
"object"){e=a;c=b}else(e={})[a]=b;c||(c={});if(!this._validate(e,c))return false;g=c.unset;j=c.silent;a=[];k=this._changing;this._changing=true;if(!k){this._previousAttributes=f.clone(this.attributes);this.changed={}}l=this.attributes;i=this._previousAttributes;if(this.idAttribute in e)this.id=e[this.idAttribute];for(d in e){b=e[d];f.isEqual(l[d],b)||a.push(d);if(f.isEqual(i[d],b))delete this.changed[d];else this.changed[d]=b;g?delete l[d]:(l[d]=b)}if(!j){if(a.length)this._pending=true;b=0;for(d=
a.length;b<d;b++)this.trigger("change:"+a[b],this,l[a[b]],c)}if(k)return this;if(!j)for(;this._pending;){this._pending=false;this.trigger("change",this,c)}this._changing=this._pending=false;return this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:true}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:true}))},hasChanged:function(a){if(a==null)return!f.isEmpty(this.changed);return f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?
f.clone(this.changed):false;var b,c=false,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)if(!f.isEqual(d[e],b=a[e]))(c||(c={}))[e]=b;return c},previous:function(a){if(a==null||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{};if(a.parse===void 0)a.parse=true;var b=a.success;a.success=function(c,d,e){if(!c.set(c.parse(d,e),e))return false;b&&
b(c,d,e)};return this.sync("read",this,a)},save:function(a,b,c){var d,e,g=this.attributes;if(a==null||typeof a==="object"){d=a;c=b}else(d={})[a]=b;if(d&&(!c||!c.wait)&&!this.set(d,c))return false;c=f.extend({validate:true},c);if(!this._validate(d,c))return false;if(d&&c.wait)this.attributes=f.extend({},g,d);if(c.parse===void 0)c.parse=true;e=c.success;c.success=function(j,k,i){j.attributes=g;var l=j.parse(k,i);if(i.wait)l=f.extend(d||{},l);if(f.isObject(l)&&!j.set(l,i))return false;e&&e(j,k,i)};a=
this.isNew()?"create":c.patch?"patch":"update";if(a==="patch")c.attrs=d;a=this.sync(a,this,c);if(d&&c.wait)this.attributes=g;return a},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(g,j,k){if(k.wait||g.isNew())d();c&&c(g,j,k)};if(this.isNew()){a.success(this,null,a);return false}var e=this.sync("delete",this,a);a.wait||d();return e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||w();
if(this.isNew())return a;return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return!this.validate||!this.validate(this.attributes,a)},_validate:function(a,b){if(!b.validate||!this.validate)return true;a=f.extend({},this.attributes,a);a=this.validationError=this.validate(a,b)||null;if(!a)return true;this.trigger("invalid",this,a,
b||{});return false}});var s=h.Collection=function(a,b){b||(b={});if(b.model)this.model=b.model;if(b.comparator!==void 0)this.comparator=b.comparator;this.models=[];this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,f.extend({silent:true},b))};f.extend(s.prototype,m,{model:r,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return h.sync.apply(this,arguments)},add:function(a,b){a=f.isArray(a)?a.slice():[a];b||(b={});var c,
d,e,g,j,k,i,l,p,x;i=[];l=b.at;p=this.comparator&&l==null&&b.sort!=false;x=f.isString(this.comparator)?this.comparator:null;c=0;for(d=a.length;c<d;c++)if(e=this._prepareModel(g=a[c],b))if(j=this.get(e)){if(b.merge){j.set(g===e?e.attributes:g,b);if(p&&!k&&j.hasChanged(x))k=true}}else{i.push(e);e.on("all",this._onModelEvent,this);this._byId[e.cid]=e;if(e.id!=null)this._byId[e.id]=e}else this.trigger("invalid",this,g,b);if(i.length){if(p)k=true;this.length+=i.length;l!=null?D.apply(this.models,[l,0].concat(i)):
C.apply(this.models,i)}k&&this.sort({silent:true});if(b.silent)return this;c=0;for(d=i.length;c<d;c++)(e=i[c]).trigger("add",e,this,b);k&&this.trigger("sort",this,b);return this},remove:function(a,b){a=f.isArray(a)?a.slice():[a];b||(b={});var c,d,e,g;c=0;for(d=a.length;c<d;c++)if(g=this.get(a[c])){delete this._byId[g.id];delete this._byId[g.cid];e=this.indexOf(g);this.models.splice(e,1);this.length--;if(!b.silent){b.index=e;g.trigger("remove",g,this,b)}this._removeReference(g)}return this},push:function(a,
b){a=this._prepareModel(a,b);this.add(a,f.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,f.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a!=null){this._idAttr||(this._idAttr=this.model.prototype.idAttribute);return this._byId[a.id||a.cid||a[this._idAttr]||a]}},at:function(a){return this.models[a]},
where:function(a){if(f.isEmpty(a))return[];return this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return false;return true})},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");a||(a={});if(f.isString(this.comparator)||this.comparator.length===1)this.models=this.sortBy(this.comparator,this);else this.models.sort(f.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return f.invoke(this.models,"get",
a)},update:function(a,b){b=f.extend({add:true,merge:true,remove:true},b);if(b.parse)a=this.parse(a,b);var c,d,e,g,j=[],k=[],i={};f.isArray(a)||(a=a?[a]:[]);if(b.add&&!b.remove)return this.add(a,b);d=0;for(e=a.length;d<e;d++){c=a[d];g=this.get(c);if(b.remove&&g)i[g.cid]=true;if(b.add&&!g||b.merge&&g)j.push(c)}if(b.remove){d=0;for(e=this.models.length;d<e;d++){c=this.models[d];i[c.cid]||k.push(c)}}k.length&&this.remove(k,b);j.length&&this.add(j,b);return this},reset:function(a,b){b||(b={});if(b.parse)a=
this.parse(a,b);for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models.slice();this._reset();a&&this.add(a,f.extend({silent:true},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?f.clone(a):{};if(a.parse===void 0)a.parse=true;var b=a.success;a.success=function(c,d,e){c[e.update?"update":"reset"](d,e);b&&b(c,d,e)};return this.sync("read",this,a)},create:function(a,b){b=b?f.clone(b):{};if(!(a=this._prepareModel(a,b)))return false;
b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(e,g,j){j.wait&&c.add(e,j);d&&d(e,g,j)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=0;this._byId={}},_prepareModel:function(a,b){if(a instanceof r){if(!a.collection)a.collection=this;return a}b||(b={});b.collection=this;var c=new this.model(a,b);if(!c._validate(a,b))return false;return c},_removeReference:function(a){this===
a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(!((a==="add"||a==="remove")&&c!==this)){a==="destroy"&&this.remove(b,d);if(b&&a==="change:"+b.idAttribute){delete this._byId[b.previous(b.idAttribute)];if(b.id!=null)this._byId[b.id]=b}this.trigger.apply(this,arguments)}},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=f.isFunction(b)?b:function(e){return e.get(b)};return f.sortedIndex(this.models,a,d,c)}});f.each(["forEach","each",
"map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(a){s.prototype[a]=function(){var b=t.call(arguments);b.unshift(this.models);return f[a].apply(f,b)}});f.each(["groupBy","countBy","sortBy"],function(a){s.prototype[a]=function(b,
c){var d=f.isFunction(b)?b:function(e){return e.get(b)};return f[a](this.models,d,c)}});var y=h.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,F=/(\(\?)?:\w+/g,G=/\*\w+/g,H=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(y.prototype,m,{initialize:function(){},route:function(a,b,c){f.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);h.history.route(a,f.bind(function(d){d=this._extractParameters(a,d);c&&c.apply(this,d);
this.trigger.apply(this,["route:"+b].concat(d));this.trigger("route",b,d);h.history.trigger("route",this,b,d)},this));return this},navigate:function(a,b){h.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes)for(var a,b=f.keys(this.routes);(a=b.pop())!=null;)this.route(a,this.routes[a])},_routeToRegExp:function(a){a=a.replace(H,"\\$&").replace(E,"(?:$1)?").replace(F,function(b,c){return c?b:"([^/]+)"}).replace(G,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,
b){return a.exec(b).slice(1)}});var n=h.History=function(){this.handlers=[];f.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}},z=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,J=/msie [\w.]+/,K=/\/$/;n.started=false;f.extend(n.prototype,m,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;b=this.root.replace(K,
"");a.indexOf(b)||(a=a.substr(b.length))}else a=this.getHash();return a.replace(z,"")},start:function(a){if(n.started)throw new Error("Backbone.history has already been started");n.started=true;this.options=f.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=document.documentMode;
b=J.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7);this.root=("/"+this.root+"/").replace(I,"/");if(b&&this._wantsHashChange){this.iframe=h.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(a)}if(this._hasPushState)h.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)h.$(window).on("hashchange",this.checkUrl);else if(this._wantsHashChange)this._checkUrlInterval=setInterval(this.checkUrl,this.interval);
this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&b&&a.hash){this.fragment=this.getHash().replace(z,"");this.history.replaceState({},document.title,this.root+this.fragment+a.search)}if(!this.options.silent)return this.loadUrl()},
stop:function(){h.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);n.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();if(a===this.fragment&&this.iframe)a=this.getFragment(this.getHash(this.iframe));if(a===this.fragment)return false;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);
return f.any(this.handlers,function(c){if(c.route.test(b)){c.callback(b);return true}})},navigate:function(a,b){if(!n.started)return false;if(!b||b===true)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange){this._updateHash(this.location,a,b.replace);if(this.iframe&&a!==this.getFragment(this.getHash(this.iframe))){b.replace||this.iframe.document.open().close();
this._updateHash(this.iframe.location,a,b.replace)}}else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){c=a.href.replace(/(javascript:|#).*$/,"");a.replace(c+"#"+b)}else a.hash="#"+b}});h.history=new n;var A=h.View=function(a){this.cid=f.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},L=/^(\S+)\s*(.*)$/,M=["model","collection","el","id","attributes","className","tagName","events"];
f.extend(A.prototype,m,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof h.$?a:h.$(a);this.el=this.$el[0];b!==false&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=f.result(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);
if(!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(L),e=d[1];d=d[2];c=f.bind(c,this);e+=".delegateEvents"+this.cid;d===""?this.$el.on(e,c):this.$el.on(e,d,c)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(a){if(this.options)a=f.extend({},f.result(this,"options"),a);f.extend(this,f.pick(a,M));this.options=a},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),false);else{var a=f.extend({},f.result(this,"attributes"));
if(this.id)a.id=f.result(this,"id");if(this.className)a["class"]=f.result(this,"className");this.setElement(h.$("<"+f.result(this,"tagName")+">").attr(a),false)}}});var N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};h.sync=function(a,b,c){var d=N[a];f.defaults(c||(c={}),{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var e={type:d,dataType:"json"};if(!c.url)e.url=f.result(b,"url")||w();if(c.data==null&&b&&(a==="create"||a==="update"||a==="patch")){e.contentType="application/json";
e.data=JSON.stringify(c.attrs||b.toJSON(c))}if(c.emulateJSON){e.contentType="application/x-www-form-urlencoded";e.data=e.data?{model:e.data}:{}}if(c.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){e.type="POST";if(c.emulateJSON)e.data._method=d;var g=c.beforeSend;c.beforeSend=function(i){i.setRequestHeader("X-HTTP-Method-Override",d);if(g)return g.apply(this,arguments)}}if(e.type!=="GET"&&!c.emulateJSON)e.processData=false;var j=c.success;c.success=function(i){j&&j(b,i,c);b.trigger("sync",b,
i,c)};var k=c.error;c.error=function(i){k&&k(b,i,c);b.trigger("error",b,i,c)};a=c.xhr=h.ajax(f.extend(e,c));b.trigger("request",b,a,c);return a};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};r.extend=s.extend=y.extend=A.extend=n.extend=function(a,b){var c=this,d;d=a&&f.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};f.extend(d,c,b);b=function(){this.constructor=d};b.prototype=c.prototype;d.prototype=new b;a&&f.extend(d.prototype,a);d.__super__=c.prototype;return d};
var w=function(){throw new Error('A "url" property or function must be specified');}}).call(this);

/*! jQuery UI - v1.8.22 - 2012-07-24
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.core.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;return!b.href||!g||f.nodeName.toLowerCase()!=="map"?!1:(h=a("img[usemap=#"+g+"]")[0],!!h&&d(h))}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(a.ui.version)return;a.extend(a.ui,{version:"1.8.22",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function h(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?g["inner"+d].call(this):this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?g["outer"+d].call(this,b):this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.curCSS||(a.curCSS=a.css),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!d||!a.element[0].parentNode)return;for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}})})(jQuery);;/*! jQuery UI - v1.8.22 - 2012-07-24
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.widget.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&e.charAt(0)==="_"?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b)return h=f,!1}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);;/*! jQuery UI - v1.8.22 - 2012-07-24
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.position.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.ui=a.ui||{};var c=/left|center|right/,d=/top|center|bottom/,e="center",f={},g=a.fn.position,h=a.fn.offset;a.fn.position=function(b){if(!b||!b.of)return g.apply(this,arguments);b=a.extend({},b);var h=a(b.of),i=h[0],j=(b.collision||"flip").split(" "),k=b.offset?b.offset.split(" "):[0,0],l,m,n;return i.nodeType===9?(l=h.width(),m=h.height(),n={top:0,left:0}):i.setTimeout?(l=h.width(),m=h.height(),n={top:h.scrollTop(),left:h.scrollLeft()}):i.preventDefault?(b.at="left top",l=m=0,n={top:b.of.pageY,left:b.of.pageX}):(l=h.outerWidth(),m=h.outerHeight(),n=h.offset()),a.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=c.test(a[0])?a.concat([e]):d.test(a[0])?[e].concat(a):[e,e]),a[0]=c.test(a[0])?a[0]:e,a[1]=d.test(a[1])?a[1]:e,b[this]=a}),j.length===1&&(j[1]=j[0]),k[0]=parseInt(k[0],10)||0,k.length===1&&(k[1]=k[0]),k[1]=parseInt(k[1],10)||0,b.at[0]==="right"?n.left+=l:b.at[0]===e&&(n.left+=l/2),b.at[1]==="bottom"?n.top+=m:b.at[1]===e&&(n.top+=m/2),n.left+=k[0],n.top+=k[1],this.each(function(){var c=a(this),d=c.outerWidth(),g=c.outerHeight(),h=parseInt(a.curCSS(this,"marginLeft",!0))||0,i=parseInt(a.curCSS(this,"marginTop",!0))||0,o=d+h+(parseInt(a.curCSS(this,"marginRight",!0))||0),p=g+i+(parseInt(a.curCSS(this,"marginBottom",!0))||0),q=a.extend({},n),r;b.my[0]==="right"?q.left-=d:b.my[0]===e&&(q.left-=d/2),b.my[1]==="bottom"?q.top-=g:b.my[1]===e&&(q.top-=g/2),f.fractions||(q.left=Math.round(q.left),q.top=Math.round(q.top)),r={left:q.left-h,top:q.top-i},a.each(["left","top"],function(c,e){a.ui.position[j[c]]&&a.ui.position[j[c]][e](q,{targetWidth:l,targetHeight:m,elemWidth:d,elemHeight:g,collisionPosition:r,collisionWidth:o,collisionHeight:p,offset:k,my:b.my,at:b.at})}),a.fn.bgiframe&&c.bgiframe(),c.offset(a.extend(q,{using:b.using}))})},a.ui.position={fit:{left:function(b,c){var d=a(window),e=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft();b.left=e>0?b.left-e:Math.max(b.left-c.collisionPosition.left,b.left)},top:function(b,c){var d=a(window),e=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop();b.top=e>0?b.top-e:Math.max(b.top-c.collisionPosition.top,b.top)}},flip:{left:function(b,c){if(c.at[0]===e)return;var d=a(window),f=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft(),g=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,h=c.at[0]==="left"?c.targetWidth:-c.targetWidth,i=-2*c.offset[0];b.left+=c.collisionPosition.left<0?g+h+i:f>0?g+h+i:0},top:function(b,c){if(c.at[1]===e)return;var d=a(window),f=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop(),g=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,h=c.at[1]==="top"?c.targetHeight:-c.targetHeight,i=-2*c.offset[1];b.top+=c.collisionPosition.top<0?g+h+i:f>0?g+h+i:0}}},a.offset.setOffset||(a.offset.setOffset=function(b,c){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),e=d.offset(),f=parseInt(a.curCSS(b,"top",!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,h={top:c.top-e.top+f,left:c.left-e.left+g};"using"in c?c.using.call(b,h):d.css(h)},a.fn.offset=function(b){var c=this[0];return!c||!c.ownerDocument?null:b?a.isFunction(b)?this.each(function(c){a(this).offset(b.call(this,c,a(this).offset()))}):this.each(function(){a.offset.setOffset(this,b)}):h.call(this)}),function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d,e,g,h,i;d=document.createElement(b?"div":"body"),g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},b&&a.extend(g,{position:"absolute",left:"-1000px",top:"-1000px"});for(var j in g)d.style[j]=g[j];d.appendChild(c),e=b||document.documentElement,e.insertBefore(d,e.firstChild),c.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",h=a(c).offset(function(a,b){return b}).offset(),d.innerHTML="",e.removeChild(d),i=h.top+h.left+(b?2e3:0),f.fractions=i>21&&i<22}()})(jQuery);;/*! jQuery UI - v1.8.22 - 2012-07-24
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.dialog.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c="ui-dialog ui-widget ui-widget-content ui-corner-all ",d={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},e={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},f=a.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0};a.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var b=this,d=b.options,e=d.title||"&#160;",f=a.ui.dialog.getTitleId(b.element),g=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass(c+d.dialogClass).css({zIndex:d.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(c){d.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(a){b.moveToTop(!1,a)}),h=b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(g),i=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(g),j=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){j.addClass("ui-state-hover")},function(){j.removeClass("ui-state-hover")}).focus(function(){j.addClass("ui-state-focus")}).blur(function(){j.removeClass("ui-state-focus")}).click(function(a){return b.close(a),!1}).appendTo(i),k=(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(d.closeText).appendTo(j),l=a("<span></span>").addClass("ui-dialog-title").attr("id",f).html(e).prependTo(i);a.isFunction(d.beforeclose)&&!a.isFunction(d.beforeClose)&&(d.beforeClose=d.beforeclose),i.find("*").add(i).disableSelection(),d.draggable&&a.fn.draggable&&b._makeDraggable(),d.resizable&&a.fn.resizable&&b._makeResizable(),b._createButtons(d.buttons),b._isOpen=!1,a.fn.bgiframe&&g.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var a=this;return a.overlay&&a.overlay.destroy(),a.uiDialog.hide(),a.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),a.uiDialog.remove(),a.originalTitle&&a.element.attr("title",a.originalTitle),a},widget:function(){return this.uiDialog},close:function(b){var c=this,d,e;if(!1===c._trigger("beforeClose",b))return;return c.overlay&&c.overlay.destroy(),c.uiDialog.unbind("keypress.ui-dialog"),c._isOpen=!1,c.options.hide?c.uiDialog.hide(c.options.hide,function(){c._trigger("close",b)}):(c.uiDialog.hide(),c._trigger("close",b)),a.ui.dialog.overlay.resize(),c.options.modal&&(d=0,a(".ui-dialog").each(function(){this!==c.uiDialog[0]&&(e=a(this).css("z-index"),isNaN(e)||(d=Math.max(d,e)))}),a.ui.dialog.maxZ=d),c},isOpen:function(){return this._isOpen},moveToTop:function(b,c){var d=this,e=d.options,f;return e.modal&&!b||!e.stack&&!e.modal?d._trigger("focus",c):(e.zIndex>a.ui.dialog.maxZ&&(a.ui.dialog.maxZ=e.zIndex),d.overlay&&(a.ui.dialog.maxZ+=1,d.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)),f={scrollTop:d.element.scrollTop(),scrollLeft:d.element.scrollLeft()},a.ui.dialog.maxZ+=1,d.uiDialog.css("z-index",a.ui.dialog.maxZ),d.element.attr(f),d._trigger("focus",c),d)},open:function(){if(this._isOpen)return;var b=this,c=b.options,d=b.uiDialog;return b.overlay=c.modal?new a.ui.dialog.overlay(b):null,b._size(),b._position(c.position),d.show(c.show),b.moveToTop(!0),c.modal&&d.bind("keydown.ui-dialog",function(b){if(b.keyCode!==a.ui.keyCode.TAB)return;var c=a(":tabbable",this),d=c.filter(":first"),e=c.filter(":last");if(b.target===e[0]&&!b.shiftKey)return d.focus(1),!1;if(b.target===d[0]&&b.shiftKey)return e.focus(1),!1}),a(b.element.find(":tabbable").get().concat(d.find(".ui-dialog-buttonpane :tabbable").get().concat(d.get()))).eq(0).focus(),b._isOpen=!0,b._trigger("open"),b},_createButtons:function(b){var c=this,d=!1,e=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),g=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);c.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof b=="object"&&b!==null&&a.each(b,function(){return!(d=!0)}),d&&(a.each(b,function(b,d){d=a.isFunction(d)?{click:d,text:b}:d;var e=a('<button type="button"></button>').click(function(){d.click.apply(c.element[0],arguments)}).appendTo(g);a.each(d,function(a,b){if(a==="click")return;a in f?e[a](b):e.attr(a,b)}),a.fn.button&&e.button()}),e.appendTo(c.uiDialog))},_makeDraggable:function(){function f(a){return{position:a.position,offset:a.offset}}var b=this,c=b.options,d=a(document),e;b.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,g){e=c.height==="auto"?"auto":a(this).height(),a(this).height(a(this).height()).addClass("ui-dialog-dragging"),b._trigger("dragStart",d,f(g))},drag:function(a,c){b._trigger("drag",a,f(c))},stop:function(g,h){c.position=[h.position.left-d.scrollLeft(),h.position.top-d.scrollTop()],a(this).removeClass("ui-dialog-dragging").height(e),b._trigger("dragStop",g,f(h)),a.ui.dialog.overlay.resize()}})},_makeResizable:function(c){function h(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}c=c===b?this.options.resizable:c;var d=this,e=d.options,f=d.uiDialog.css("position"),g=typeof c=="string"?c:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:d._minHeight(),handles:g,start:function(b,c){a(this).addClass("ui-dialog-resizing"),d._trigger("resizeStart",b,h(c))},resize:function(a,b){d._trigger("resize",a,h(b))},stop:function(b,c){a(this).removeClass("ui-dialog-resizing"),e.height=a(this).height(),e.width=a(this).width(),d._trigger("resizeStop",b,h(c)),a.ui.dialog.overlay.resize()}}).css("position",f).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return a.height==="auto"?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(b){var c=[],d=[0,0],e;if(b){if(typeof b=="string"||typeof b=="object"&&"0"in b)c=b.split?b.split(" "):[b[0],b[1]],c.length===1&&(c[1]=c[0]),a.each(["left","top"],function(a,b){+c[a]===c[a]&&(d[a]=c[a],c[a]=b)}),b={my:c.join(" "),at:c.join(" "),offset:d.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},b)),e||this.uiDialog.hide()},_setOptions:function(b){var c=this,f={},g=!1;a.each(b,function(a,b){c._setOption(a,b),a in d&&(g=!0),a in e&&(f[a]=b)}),g&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",f)},_setOption:function(b,d){var e=this,f=e.uiDialog;switch(b){case"beforeclose":b="beforeClose";break;case"buttons":e._createButtons(d);break;case"closeText":e.uiDialogTitlebarCloseText.text(""+d);break;case"dialogClass":f.removeClass(e.options.dialogClass).addClass(c+d);break;case"disabled":d?f.addClass("ui-dialog-disabled"):f.removeClass("ui-dialog-disabled");break;case"draggable":var g=f.is(":data(draggable)");g&&!d&&f.draggable("destroy"),!g&&d&&e._makeDraggable();break;case"position":e._position(d);break;case"resizable":var h=f.is(":data(resizable)");h&&!d&&f.resizable("destroy"),h&&typeof d=="string"&&f.resizable("option","handles",d),!h&&d!==!1&&e._makeResizable(d);break;case"title":a(".ui-dialog-title",e.uiDialogTitlebar).html(""+(d||"&#160;"))}a.Widget.prototype._setOption.apply(e,arguments)},_size:function(){var b=this.options,c,d,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),b.minWidth>b.width&&(b.width=b.minWidth),c=this.uiDialog.css({height:"auto",width:b.width}).height(),d=Math.max(0,b.minHeight-c);if(b.height==="auto")if(a.support.minHeight)this.element.css({minHeight:d,height:"auto"});else{this.uiDialog.show();var f=this.element.css("height","auto").height();e||this.uiDialog.hide(),this.element.height(Math.max(f,d))}else this.element.height(Math.max(b.height-c,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),a.extend(a.ui.dialog,{version:"1.8.22",uuid:0,maxZ:0,getTitleId:function(a){var b=a.attr("id");return b||(this.uuid+=1,b=this.uuid),"ui-dialog-title-"+b},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}}),a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(a){return a+".dialog-overlay"}).join(" "),create:function(b){this.instances.length===0&&(setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return!1})},1),a(document).bind("keydown.dialog-overlay",function(c){b.options.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}),a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize));var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return a.fn.bgiframe&&c.bgiframe(),this.instances.push(c),c},destroy:function(b){var c=a.inArray(b,this.instances);c!=-1&&this.oldInstances.push(this.instances.splice(c,1)[0]),this.instances.length===0&&a([document,window]).unbind(".dialog-overlay"),b.remove();var d=0;a.each(this.instances,function(){d=Math.max(d,this.css("z-index"))}),this.maxZ=d},height:function(){var b,c;return a.browser.msie&&a.browser.version<7?(b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),b<c?a(window).height()+"px":b+"px"):a(document).height()+"px"},width:function(){var b,c;return a.browser.msie?(b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),b<c?a(window).width()+"px":b+"px"):a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)}),b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}}),a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);;


/**
 * Share url on twitter.
 * in your html add a link similar to this:
 * where {{text}} & {{url}} will be the value you require
 * <a href="https://twitter.com/intent/tweet?text={{text}}&url={{url}}">some text</a>
 */
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");


var Config=function(e,f,d){init=function(){var a={},c=d("#build-and-price-config");if(c.length>0){a=JSON.parse(c.html());c="/servlet/rest/tools/"+a.toolType+"/"+a.site;var b=c+"/:pricezoneId/";a.buildandprice={urls:{modelListURL:b+"models",derivativeListURL:b+"model/:id/derivatives",packageListURL:b+"model/:id/packages",derivativeDetailURL:b+":path/:id",packageDetailURL:b+":path/:id",categoryListURL:b+":path/:id/categories",colorTrimListURL:b+":path/:id/colours-trims",engineListURL:b+"derivative/:id/engine",
shareURL:"/servlet/rest/tools/share/",viewPDFURL:"/servlet/rest/tools/share/pdf/",pricezoneListURL:c+"/pricezones",hotdealsURL:"/servlet/rest/hotdeals/buildandprice",driveawayURL:"/servlet/Satellite?pagename=DFY/Tools/CalculatePriceJSON&site=FOA&tool=buildandprice"}};c="/servlet/rest/tools/comparator/"+a.site;b=c+"/:pricezoneId/";a.comparator={urls:{modelListURL:b+"models",derivativeListURL:b+"model/:id/derivatives",compareURL:c+"/results/derivatives/",pricezoneListURL:c+"/pricezones"}}}else{a.buildandprice=
{};a.buildandprice.urls={};a.comparator={};a.comparator.urls={}}return a};return init()}(window,document,jQuery);

var Translator=function(a){var c={};a=a("#translations");if(a.length>0)c=a.embeddedData();return{translate:function(d){var b=c[d];if(b==null)b=d;return b}}}(jQuery);

var Constants={storage:{nameplateCollection:"nameplateCollection",packageCollection:"packageCollection",derivativeDetailsModel:"derivativeDetailModel",colorCollection:"colorCollection",categoryGrpCollection:"categoryGroupCollection",galleryCollection:"galleryCollection",pricezoneCollection:"pricezoneCollection",footerModel:"footerModel",headerCollection:"headerCollection",panelCollection:"panelCollection",headerModel:"headerModel",pathCollection:"pathCollection",derivativeCollection:"derivativeCollection",
hotdealCollection:"hotdealCollection"},state:{SELECT_NAMEPLATE:0,SELECT_PATH:1,SELECT_PACKAGE:2,SELECT_DERIVATIVE:2,SELECT_ENGINE:3,CUSTOMIZE_DERIVATIVE:4,SUMMARY:5,NO_STATE:-99},analytics:{colorTrim:"colour trim"},postcode:{hd:"hotDeals",ot:"other",non:"none"},view:{exterior:"exterior",interior:"interior"},attr:{feats:"features",catgs:"categories"},values:{standard:"Standard",optionPack:"Option Pack",mutuallyExclusiveOptions:"Mutually Exclusive Options"},header:{spa:Translator.translate("bpt-step-path"),
sm:Translator.translate("bpt-step-model"),sp:Translator.translate("bpt-step-package"),selectEngine:Translator.translate("bpt-step-engine"),selectColor:Translator.translate("bpt-step-color"),sc:Translator.translate("bpt-step-customize"),ss:Translator.translate("bpt-step-summary"),sl:Translator.translate("bpt-your-location"),c:Translator.translate("bpt-customize"),p:Translator.translate("bpt-path-sel")},cookie:{pzid:"priceZoneId"},bpt:{s1:Translator.translate("bpt-step1"),s2:Translator.translate("bpt-step2"),
s3:Translator.translate("bpt-step3"),s4:Translator.translate("bpt-step4"),ct:Translator.translate("bpt-colors-trims"),av:Translator.translate("bpt-all-vehicles"),ssm:Translator.translate("bpt-step-select-model"),pc:Translator.translate("bpt-postcode"),cp:Translator.translate("bpt-choose-package"),chp:Translator.translate("bpt-choose-path"),chm:Translator.translate("bpt-choose-model"),chooseEngine:Translator.translate("bpt-choose-engine"),czp:Translator.translate("bpt-customized-pkg"),sczp:Translator.translate("bpt-start-customised-package"),
summary:Translator.translate("bpt-summary"),ppi:Translator.translate("bpt-path-package-instruction"),byon:Translator.translate("bpt-build-your-own"),byot:Translator.translate("bpt-byo"),f:Translator.translate("bpt-from")+" ",pbyoi:Translator.translate("bpt-path-byo-instruction"),sv:Translator.translate("bpt-no-vehicle-aval"),cl:Translator.translate("bpt-select-vehicle-location"),czpk:Translator.translate("bpt-customize-package"),czm:Translator.translate("bpt-customize-model"),et:Translator.translate("bpt-error-title"),
close:Translator.translate("bpt-close"),noCostOption:Translator.translate("bpt-no-cost-option"),latestOffersInstructions:Translator.translate("bpt-latest-offer-inst"),errorCalcPrice:Translator.translate("bpt-error-calc-price"),postcodeMisMatch:Translator.translate("bpt-postcode-mismatch"),selectRegionToViewPrices:Translator.translate("bpt-select-region-to-view-prices"),regionNotSpecified:Translator.translate("bpt-region-not-specified"),yourRegionNotSpecified:Translator.translate("bpt-your-region-not-specified"),
mlp:Translator.translate("bpt-mlp"),rrp:Translator.translate("bpt-rrp"),featurePartOfOptionPack:Translator.translate("bpt-feature-partof-optionpack"),featurePartOfDependentFeature:Translator.translate("bpt-feature-partof-depenendent-feature"),featurePartOfMutualExclusive:Translator.translate("bpt-same-featuretype-selected"),derivativeSelect:Translator.translate("bpt-derivative-sel"),packageSelect:Translator.translate("bpt-package-sel"),errorProcessingData:Translator.translate("bpt-error-processing-data"),
showDisclaimer:Translator.translate("bpt-show-summary-disclaimer"),hideDisclaimer:Translator.translate("bpt-hide-summary-disclaimer")},priceSuffix:{colour:Translator.translate("btp-colour-price-suffix"),featureRRP:Translator.translate("btp-feature-rrp-price-suffix"),featureMLP:Translator.translate("btp-feature-mlp-price-suffix")},path:{pkg:"package",drv:"derivative",pth:"path",nxt:"next"},comparatorStorage:{nameplateCollection:"nameplateCollection",pricezoneCollection:"pricezoneCollection",derivativeCollection:"derivativeCollection",
comparisonChart:"comparisonChart",comparableDerivativeCollection:"comparableDerivativeCollection",nameplateContainer:"nameplateContainer"},ct:{limitReached:Translator.translate("ct-limit-reached")}},Util={cookie:{root:"build.n.price",expiry:14,save:function(a,b){$.cookie&&$.cookie(Util.cookie.root+a,b,{expires:14})},load:function(a){var b=null;if($.cookie)b=$.cookie(Util.cookie.root+a);return b},remove:function(a){$.cookie&&$.cookie(Util.cookie.root+a,null)}},log:function(a){SiteConf.dev&&console.log(a)},
dir:function(a){SiteConf.dev&&console.dir(a)}},ConfigUtil={isShortPath:function(){return Config.buildAndPriceType==="short"},showPostcodeSelect:function(){return Config.showPostcodeSelect&&!ConfigUtil.isShortPath()},usePolkPricing:function(a){return this.showPostcodeSelect()&&Constants.path.drv===a},showPrices:function(){return Config.showPrices===true},showNameplateSegments:function(){return Config.buildAndPriceShowVehicleSegments},showPricezones:function(){return Config.showPriceZoneSelect===true}};

var a;a=Backbone.Collection.prototype;a.selectable=function(){return true};a.clickable=function(){return false};a.supportsMultiSelect=function(){return false};a.select=function(b){if(this.selectable()){if(!this.supportsMultiSelect()){var c=this.where({selected:true});c!=null&&_.each(c,function(d){d.id!==b.id&&d.set("selected",false)})}b.set("selected",true);this.clickable()&&b.set("clicked",false);return true}return false};
a.deselectAll=function(){if(this.selectable()){var b=this.where({selected:true});if(b!=null){isClickable=this.clickable();_.each(b,function(c){c.set("selected",false);isClickable&&c.set("clicked",false)})}}};a.click=function(b){if(this.clickable()){var c=this.where({clicked:true});c!=null&&_.each(c,function(d){d.id!=b.id&&d.set("clicked",false)});b.set("clicked",true)}};a.selectById=function(b){var c=null;if(this.selectable())if((b=this.where({id:b}))&&b.length>0)this.select(c=b[0]);return c};
a.clickById=function(b){var c=null;if(this.clickable())if((b=this.where({id:b}))&&b.length>0)this.click(c=b[0]);return c};a.getSelected=function(){if(this.selectable()){var b=this.where({selected:true});if(b&&b!=null&&b.length>0)return this.supportsMultiSelect()?b:b[0]}return null};a.getClicked=function(){if(this.clickable()){var b=this.where({clicked:true});if(b&&b!=null&&b.length>0)return b[0]}return null};
a.unclick=function(b){if(this.clickable())if((b=this.where({clicked:true,id:b.get("id")}))&&b!=null){b[0].set("clicked",false);return true}return false};_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaulate:/\{\[(.+?)\]\}/g};Backbone.View.prototype.destroy=function(){this.remove();this.unbind();Events.unbind(null,this);if(this.children){_.each(this.children,function(b){b.destroy()});this.children=[]}};
Backbone.View.prototype.render=function(){var b=$(this.template(this.model.toJSON()));this.translate(b);$(this.el).html(b);return this};Backbone.View.prototype.translate=function(b){b||(b=$(this.el));Views.Helper.translateTextOnView(b)};Backbone.View.prototype.lazyload=function(b){$(b?b:"div.thumb-lazy").each(function(){var c=$(this),d=c.data("src"),e=new Image;e.onload=function(){c.html(e);e.alt=c.data("alt")};e.src=d})};

var Events=function(){var b={context:null};_.extend(b,Backbone.Events);return{eventList:{},bindToEvent:function(a,c,d,f){a.bind(c,function(e){b.trigger(d,e?e:f)},b.context)},fireEvent:function(a,c){b.trigger(a,c,b.context)},bind:function(a,c,d){b.on(a,c,d)},unbind:function(a,c){b.off(typeof a==="undefined"?null:a,null,c)},bindOnce:function(a,c,d){b.once(a,c,d)},eventBus:b}}();

Views={Buildandprice:{},Comparator:{},Helper:{translateTextOnView:function(a){a=a?a.find("span.bpt"):$("span.bpt");a.each(function(){var b=$(this);b.removeClass("bpt");b.text(Translator.translate(b.text()))})}}};

Events.eventList.buildandprice={view:{ChangeVehicleEvent:"ChangeVehicleEvent",PricezoneChangeRequestEvent:"PricezoneChangeRequestEvent",PathSelectedEvent:"PathSelectedEvent",DerivativeSelectedEvent:"DerivativeSelectedEvent",PackageSelectedEvent:"PackageSelectedEvent",SaveAsPDFEvent:"SaveAsPDFEvent",ShareConfigEvent:"ShareConfigEvent",TrimSelectedEvent:"TrimSelectedEvent",ColorChangedEvent:"ColorChangedEvent",ModelSelectedEvent:"ModelSelectedEvent",PricezoneSelectedEvent:"PricezoneSelectedEvent",ToggleViewEvent:"ToggleViewEvent",
RequestAQuoteEvent:"RequestAQuoteEvent",PresentPaymentEvent:"PresentPaymentEvent",TabChangeRequestEvent:"TabChangeRequestEvent",StepChangeRequestEvent:"StepChangeRequestEvent",StepChangeHeaderRequestEvent:"StepChangeHeaderRequestEvent",TabChangedEvent:"TabChangedEvent",FeatureSelectedEvent:"FeatureSelectedEvent",DerivativeSelectedEvent:"DerivativeSelectedEvent",NextOrientationEvent:"NextOrientationEvent",PrevOrientationEvent:"PrevOrientationEvent",StartOverEvent:"StartOverEvent",EngineTrasmissionSelectedEvent:"EngineTrasmissionSelectedEvent",
SortFeaturesByPriceEvent:"SortFeaturesByPriceEvent",SortFeaturesByNameEvent:"SortFeaturesByNameEvent",RegionPostcodeChangeRequestEvent:"RegionPostcodeChangeRequestEvent",HotDealSelectedEvent:"HotDealSelectedEvent",UpdateScrollBarEvent:"UpdateScrollBarEvent",SubTabChangedEvent:"SubTabChangedEvent",ViewAccessoryDetailsEvent:"ViewAccessoryDetailsEvent"},omniture:{RegionPostcodeChangedEvent:"Omniture:RegionPostcodeChangedEvent",PricezoneChangedEvent:"Omniture:PricezoneChangedEvent",StateChangedEvent:"Omniture:StateChangedEvent",
TabChangedEvent:"Omniture:TabChangedEvent",ViewAccessoryDetailsEvent:"Omniture:ViewAccessoryDetailsEvent",ColorSelectedEvent:"Omniture:ColorSelectedEvent",TrimSelectedEvent:"Omniture:TrimSelectedEvent",OrientationChangedEvent:"Omniture:OrientationChangedEvent",ShareLinkClickedEvent:"Omniture:ShareLinkClickedEvent",SaveAsPDFEvent:"Omniture:SaveAsPDFEvent"},model:{ShareLinkClickedEvent:{name:"ShareLinkClickedModelEvent",handler:function(a){Events.fireEvent(Events.eventList.buildandprice.omniture.ShareLinkClickedEvent,
{provider:a,storage:this.storage})}},OrientationChangedEvent:{name:"OrientationChangedModelEvent",handler:function(){Events.fireEvent(Events.eventList.buildandprice.omniture.OrientationChangedEvent,{storage:this.storage})}},SubTabChangedEvent:{name:"SubTabChangedModelEvent",handler:function(a){a=a.substring(a.indexOf("cat-")+4,a.length);this.storage.get(Constants.storage.categoryGrpCollection).getSelected().get("categories").selectByOrder(a);Events.fireEvent(Events.eventList.buildandprice.omniture.TabChangedEvent,
{storage:this.storage})}},ViewAccessoryDetailsEvent:{name:"ViewAccessoryDetailsModelEvent",handler:function(){Events.fireEvent(Events.eventList.buildandprice.omniture.ViewAccessoryDetailsEvent,{storage:this.storage})}},PricezoneSelectedEvent:{name:"PricezoneSelectedModelEvent",handler:function(a){var b=this.storage.get(Constants.storage.pricezoneCollection);this.storage.destroy();this.storage=new models.Storage;this.storage.set(Constants.storage.pricezoneCollection,b);this.userPref.purge();this.updatePricezoneForUserObject(a);
Events.fireEvent(Events.eventList.buildandprice.router.UpdatePricezoneEvent,a.get("name"));Events.fireEvent(Events.eventList.buildandprice.omniture.PricezoneChangedEvent,a.get("name"));Util.cookie.save(Constants.cookie.pzid,a.get("id"));this.navigate("reset",{trigger:true})}},PricezoneChangeRequestEvent:{name:"PricezoneChangeRequestModelEvent",handler:function(){var a=this;a.fetchPricezones(function(b){a.diplayRegionOverlayView(b)})}},RegionPostcodeChangeRequestEvent:{name:"RegionPostcodeChangeRequestModelEvent",
handler:function(a){a=a||false;if(ConfigUtil.showPostcodeSelect()){var b=this;ND.API.requestChangePriceBuildAndPrice({complete:function(c){if(typeof c!=="undefined"&&c!=null&&c.postcode){if(b.userPref.get("postcode")!==c.postcode||b.userPref.get("usage")!==c.usage){Events.fireEvent(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,c);Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,!ConfigUtil.showPrices());Events.fireEvent(Events.eventList.buildandprice.omniture.RegionPostcodeChangedEvent,
c);c=b.storage.get(Constants.storage.pricezoneCollection);b.storage.destroy();b.storage=new models.Storage;b.storage.set(Constants.storage.pricezoneCollection,c);b.navigate("reset",{trigger:true});b.userPref.purge();Events.fireEvent(Events.eventList.buildandprice.router.AskForPostcodeEvent,false)}}else Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,true)}},a)}}},TrimSelectedEvent:{name:"TrimSelectedModelEvent",handler:function(a){this.selectTrim(a.trim);Helper.getCurrentCarView(this.storage)==
Constants.view.interior?this.storage.get(Constants.storage.galleryCollection).toggleLayer(a.trim.get("id")):Events.fireEvent(Events.eventList.buildandprice.model.ToggleViewEvent.name,Constants.view.interior);false===a.isSystem&&Events.fireEvent(Events.eventList.buildandprice.omniture.TrimSelectedEvent,{storage:this.storage})}},ColorChangedEvent:{name:"ColorChangedModelEvent",handler:function(a){this.selectColor(a);Helper.getCurrentCarView(this.storage)==Constants.view.exterior?this.storage.get(Constants.storage.galleryCollection).toggleLayer(a.color.get("id")):
Events.fireEvent(Events.eventList.buildandprice.model.ToggleViewEvent.name,Constants.view.exterior);false===a.isSystem&&Events.fireEvent(Events.eventList.buildandprice.omniture.ColorSelectedEvent,{storage:this.storage})}},SaveAsPDFEvent:{name:"SaveAsPDFModelEvent",handler:function(){var a="?",b=null;_.each(["modelId","derivativeId","packageId","colourId","postcode","usage","priceZoneId","site","trimId","engineId","features"],function(d){b=this.userPref.get(d);if(b!==undefined&&b!=null)if(d!=="features"){a+=
d+"=";a+=b+"&"}else{a+="features=";a+=_.uniq(b).join(",")+"&"}},this);if(a.length>1&&a.charAt(a.length-1)==="&")a=a.substring(0,a.length-1);var c="",f;this.getSelectedPackageDerivative(this.storage,{pkgCallback:function(d){c=d.get("name");f=Constants.path.pkg},drvCallback:function(d){c=d.get("name");f=Constants.path.drv}});Events.fireEvent(Events.eventList.buildandprice.omniture.SaveAsPDFEvent,{storage:this.storage});window.open(Config.buildandprice.urls.viewPDFURL+c+a)}},ToggleViewEvent:{name:"ToggleViewModelEvent",
handler:function(a){this.storage.get(Constants.storage.derivativeDetailsModel).set("view",a);var b=this.storage.get(Constants.storage.galleryCollection),c=this.storage.get(Constants.storage.colorCollection).getSelected();if(c){if(a==Constants.view.exterior)b.toggleLayer(c.get("id"));else{a=c.get("trims").getSelected();b.toggleLayer(a.get("id"))}Events.fireEvent(Events.eventList.buildandprice.router.ActionTriggeredEvent,{action:"ViewChanged",value:Constants.view.exterior});(a=this.storage.get(Constants.storage.categoryGrpCollection).getSelectedFeatures())&&
a.length>0&&_.each(a,function(f){b.toggleLayer(f.get("id"))})}}},ShareConfigEvent:{name:"ShareConfigModelEvent",handler:function(){this.userPref.url=Config.buildandprice.urls.shareURL;Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);this.userPref.save().done(function(a){Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent);Events.fireEvent(Events.eventList.buildandprice.router.ShareReadyEvent,a.url)}).fail($.proxy(this.navToGenericErrorPage,this))}},PresentPaymentEvent:{name:"PresentPaymentModelEvent",
handler:function(){var a=this.storage.get(Constants.storage.nameplateCollection).getSelected(),b=$("#bp-payment-presenter-btn").data("url"),c=b.indexOf("?")===-1?"?":"&";a="m:"+a.get("id");b=b+c+"ctx="+encodeURIComponent(a);window.location.href=b}},RequestAQuoteEvent:{name:"RequestAQuoteModelEvent",handler:function(a){var b=this.storage.get(Constants.storage.colorCollection).getSelected(),c=b.get("trims").getSelected(),f=this.storage.get(Constants.storage.nameplateCollection).getSelected(),d=this.storage.get(Constants.storage.derivativeDetailsModel),
i="",j="",k="",l=this,h=this.userPref.get("featureObject"),m=[];this.getSelectedPackageDerivative(this.storage,{pkgCallback:function(){i=d.get("engineTransmission");j=d.get("engineId");k=d.get("id")},drvCallback:function(){var e=l.storage.get(Constants.storage.derivativeCollection).getSelected().get("engines").getSelected();i=e.get("name");j=e.get("id")}});var r={};if(h!=null&&h.models.length>0){_.each(h.models,function(e){m.push(e.get("name"))});var s=l.storage.get(Constants.storage.categoryGrpCollection);
_.each(s.models,function(e){e=e.get(Constants.attr.catgs);e!=null&&_.each(e.models,function(n){var o=n.get(Constants.attr.feats),p=[];o!=null&&_.each(h.models,function(q){o.get(q.id)!=null&&p.push(q.get("name"))});r[n.get("name")]=p.join(",")})})}var g={makeckscode:f.get("makeCode"),makeid:f.get("makeId"),makename:f.get("makeName"),modelckscode:f.get("modelCode"),modelid:f.get("id"),modelname:f.get("name"),pricezoneid:this.userPref.get("priceZoneId"),derivativeyear:d.get("year"),derivativeckscode:d.get("derivativeCode"),
derivativename:d.get("name"),enginename:i,engineid:j,colourname:b.get("name"),trimname:c.get("name"),colourid:b.get("id"),trimid:c.get("id"),features:this.userPref.get("features").join(","),featureNames:m.join(",")};b="m:"+g.modelid+";";if(k!=="")g.packageid=k;else{g.derivativeid=d.get("id");b+="d:"+g.derivativeid}c=this.userPref.get("postcode");if(ConfigUtil.showPostcodeSelect()&&c!==""){g.postcode=c;g.usage=this.userPref.get("usage")}$.each(g,function(e){$("#bp-rq-"+e).val(g[e])});c=this.userPref.get("site");
a=$(a);if(c&&c==="FMX"){c=a.attr("action");c+="&cat="+g.derivativeckscode+"&opc=Color Exterior - "+g.colourname+", Color Interior -"+g.trimname;a.attr("action",c)}a.attr("action",a.attr("action")+"&ctx="+b);a.submit()}},TabChangeRequestEvent:{name:"TabChangeRequestModelEvent",handler:function(a){var b=this.storage.get(Constants.storage.categoryGrpCollection).getSelected().get("order");a=a-b;if(a>0)Events.fireEvent(Events.eventList.buildandprice.router.NextTabEvent);else a<0&&Events.fireEvent(Events.eventList.buildandprice.router.PrevTabEvent);
this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE)}},StepChangeRequestEvent:{name:"StepChangeRequestModelEvent",handler:function(a){this.navigate(a,{trigger:true})}},StepChangeHeaderRequestEvent:{name:"StepChangeHeaderRequestModelEvent",handler:function(a){this.navigate(a.get("headerURL"),{trigger:true})}},TabChangedEvent:{name:"TabChangedModelEvent",handler:function(a){a=a.substring(a.indexOf("cat-group-")+10,a.length);this.storage.get(Constants.storage.categoryGrpCollection).selectByOrder(a);
Events.fireEvent(Events.eventList.buildandprice.omniture.TabChangedEvent,{storage:this.storage});this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE)}},FeatureSelectedEvent:{name:"FeatureSelectedModelEvent",handler:function(a){this.toggleFeaturesByType(a);this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE)}},ModelSelectedEvent:{name:"ModelSelectedModelEvent",handler:function(a){var b=this.storage.get(Constants.storage.nameplateCollection),c=b.getSelected();c&&c.get("id")!==a.get("id")&&this.clearStorageForStep(Constants.state.SELECT_NAMEPLATE);
b.select(a);this.updateUserPrice("model",a);this.navigate("#"+a.get("nameplateURL"),{trigger:true})}},PathSelectedEvent:{name:"PathSelectedModelEvent",handler:function(a){paths=this.storage.get(Constants.storage.pathCollection);var b=paths.getSelected();b!=null&&b.get("key")!==a.get("key")&&this.clearStorageForStep(Constants.state.SELECT_PATH);paths.select(a);a=a.get("pathURL");if(a.charAt(0)==="#")this.navigate(a,{trigger:true});else window.location=a}},PackageSelectedEvent:{name:"PackageSelectedModelEvent",
handler:function(a){var b=this.storage.get(Constants.storage.packageCollection),c=b.getSelected();c!=null&&c.get("id")!==a.get("id")&&this.clearStorageForStep(Constants.state.SELECT_PACKAGE);b.select(a);this.updateUserPrice("package",a);this.updateFooter(Constants.state.SELECT_PACKAGE)}},DerivativeSelectedEvent:{name:"DerivativeSelectedModelEvent",handler:function(a){var b=this.storage.get(Constants.storage.derivativeCollection),c=b.getSelected();c!=null&&c.get("id")!==a.get("id")&&this.clearStorageForStep(Constants.state.SELECT_DERIVATIVE);
b.select(a);this.updateUserPrice("derivative",a);this.displayEngineView(a)}},StartOverEvent:{name:"StartOverModelEvent",handler:function(){this.storage.destroy();this.storage=new models.Storage;this.userPref.purge();this.navigate("reset",{trigger:true})}},EngineTrasmissionSelectedEvent:{name:"EngineTrasmissionSelectedModelEvent",handler:function(a){this.storage.get(Constants.storage.derivativeCollection).getSelected().get("engines").select(a);this.updateUserPrice("engine",a);this.updateFooter(Constants.state.SELECT_ENGINE)}},
FeaturesSortCompletedEvent:"FeaturesSortCompletedModelEvent",RegionPostcodeChangedEvent:"RegionPostcodeChangedModelEvent",ShowArrowsEvent:"ShowArrawsModelEvent",HideArrowsEvent:"HideArrawsModelEvent",RegionPostcodeLoadedFromConfigEvent:"RegionPostcodeLoadedFromConfigModelEvent"},router:{ActionTriggeredEvent:"ActionTriggeredEvent",NextTabEvent:"NextTabEvent",PrevTabEvent:"PrevTabEvent",PDFReadyEvent:"PDFReadyEvent",ShareReadyEvent:"ShareReadyEvent",BlockUIEvent:"BlockUIEvent",UnblockUIEvent:"UnblockUIEvent",
UpdatePricezoneEvent:"UpdatePricezoneEvent",LoadCompleteEvent:"LoadCompleteEvent",EnginesLoadedEvent:"EnginesLoadedEvent",HidePricesEvent:"HidePricesEvent",HideHotDealPricesEvent:"HideHotDealPricesEvent",AskForPostcodeEvent:"AskForPostcodeEvent",ShowPricesLaterEvent:"ShowPricesLaterEvent"}};

var models=function(c,l,m,d,g){c={};c.UserPref=d.Model.extend({modelObject:null,derivativeObject:null,packageObject:null,colourObject:null,trimObject:null,engineObject:null,featuresObject:null,defaults:{site:"",priceZoneId:"",postcode:"",polkPrice:null,unformattedPolkPrice:null,usage:"",usageLabel:"",features:[]},modelId:null,derivativeId:null,packageId:null,tempPostcode:null,tempUsage:null,colourId:null,trimId:null,engineId:null,initialize:function(){Events.bind(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,
this.setRegionDetails,this)},purge:function(){this.set({packageObject:g,derivativeObject:g,engineObject:null,colourObject:null,trimObject:null,featuresObject:new collections.FeatureCollection,packageId:g,derivativeId:g,polkPrice:null,unformattedPolkPrice:null,engineId:null,colourId:null,trimId:null,features:[]})},setRegionDetails:function(a){this.set({postcode:a.postcode,usage:a.usage,usageLabel:a.usageLabel})},total:function(){var a=0;_.each(new Array("packageObject","colourObject","trimObject",
"engineObject"),function(b){if((b=this.get(b))&&b!=null)a+=parseFloat(b.get("price"))},this);_.each(this.get("featuresObject").models,function(b){a+=parseFloat(b.get("price"))});return a},totalOptionsForPOLK:function(){var a=0;_.each(new Array("colourObject","trimObject"),function(b){if((b=this.get(b))&&b!=null)a+=parseFloat(b.get("price"))},this);_.each(this.get("featuresObject").models,function(b){if(b.get("featuretype")!=="Accessory")a+=parseFloat(b.get("price"))});return a},totalWithPOLK:function(a){var b=
parseFloat(a);_.each(this.get("featuresObject").models,function(e){if(e.get("featuretype")==="Accessory")b+=parseFloat(e.get("price"))});return b},toJSON:function(){var a={};_.each(new Array("modelId","derivativeId","packageId","colourId","postcode","usage","priceZoneId","site","trimId","engineId","features"),function(b){a[b]=this.get(b)},this);return a},urlRoot:Config.buildandprice.urls.shareURL});c.ErrorModel=d.Model.extend({title:null,message:null,defaults:{showPricezone:true},initialize:function(){Events.bindToEvent(this,
Events.eventList.buildandprice.view.StartOverEvent,Events.eventList.buildandprice.model.StartOverEvent.name,this);Events.bindToEvent(this,Events.eventList.buildandprice.view.PricezoneChangeRequestEvent,Events.eventList.buildandprice.model.PricezoneChangeRequestEvent.name,this)}});c.PageTitleModel=d.Model.extend({title:"",defaults:{showLatestOffersBtn:false}});c.PriceZoneModel=d.Model.extend({id:null,name:null,priceFormat:null,defaults:{decimalSeparator:",",monetaryDecimalSeparator:",",groupingSeparator:",",
"default":false,pricesDisabled:false,selected:false}});c.DerivativeModel=d.Model.extend({id:null,name:"bp-derivative",modelCode:null,priceZoneId:null,nameAuthoring:null,derivativeURL:null,defaults:{thumbnailURL:"",imageURL:"",midResURL:"",engines:null,displayPrice:0,order:0,price:0,selected:false,hotDealUrl:"#"},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.DerivativeSelectedEvent,Events.eventList.buildandprice.model.DerivativeSelectedEvent.name,this)}});c.PackageModel=
c.DerivativeModel.extend({name:"bp-package",engineTransmission:null,engineId:null,initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.PackageSelectedEvent,Events.eventList.buildandprice.model.PackageSelectedEvent.name,this)}});c.Nameplate=d.Model.extend({category:null,id:null,imageURL:null,modelCode:null,name:null,nameplateURL:null,byoImageURL:null,modelYear:null,defaults:{makeCode:"",order:0,makeId:"",makeName:"Ford",displayPrice:0,thumbnailURL:"",pkgImageURL:"",hotDealUrl:null,
hotDealSmobUrl:null,analyticsCategory:"",analyticsName:"",price:0,selected:false},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.ModelSelectedEvent,Events.eventList.buildandprice.model.ModelSelectedEvent.name,this);this.set("nameplateURL",this.get("id"))}});c.NameplateCategory=d.Model.extend({name:null,defaults:{order:0,selected:false}});c.PathModel=d.Model.extend({name:null,title:null,instruction:null,imageURL:null,pathURL:null,key:null,defaults:{selected:false},
initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.PathSelectedEvent,Events.eventList.buildandprice.model.PathSelectedEvent.name,this)}});c.FeatureModel=d.Model.extend({accessoryId:null,bpdisplayorder:null,bpvalue:null,compdisplayorder:null,featureImage:null,featuretype:null,groupType:null,name:null,partNumber:null,derivativeId:null,pricezoneId:null,featureGroupAttributes:null,dependentFeaturesIds:null,defaults:{price:0,displayPrice:0,numImages:4,featureDetailUrl:Config.featureDetailUrl,
thumbnailUrl:"",disabled:false,dependentFeatureLockCount:0,note:null,className:null,isOptionPack:false,isMutuallyExclusive:false,hasDependentFeatures:false,spriteUrl:"",spriteMidResUrl:"",message:"",selected:false},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.FeatureSelectedEvent,Events.eventList.buildandprice.model.FeatureSelectedEvent.name)},parse:function(a){for(var b in this)if(b==="featureGroupAttributes"){var e=new collections.FeatureGroupAttributeCollection,
f=a[b];f!==g&&e.add(f,{parse:true});a[b]=e}return a}});c.CategoryGroupModel=d.Model.extend({name:null,categories:null,order:null,defaults:{containsFeatureGroup:false,categoryGrouping:"",analyticsName:null,analyticsStep:null,selected:false},parse:function(a){for(var b in this)if(b==="categories"){var e=new collections.CategoryCollection,f=a[b];f!==g&&e.add(f,{parse:true});a[b]=e}return a}});c.SortDirModel=d.Model.extend({defaults:{name:"",price:""}});c.CategoryModel=d.Model.extend({id:null,name:null,
derivativeId:null,pageURL:null,className:function(){return this.get("name").replace(" ","-")},features:null,defaults:{sortDir:new c.SortDirModel,selected:false,order:0,ASC:1,DESC:-1,analyticsName:null,analyticsStep:null},initialize:function(){this.bind(Events.eventList.buildandprice.view.SortFeaturesByPriceEvent,this.sortByPrice,this);this.bind(Events.eventList.buildandprice.view.SortFeaturesByNameEvent,this.sortByName,this)},sortByPrice:function(){var a=this.get("sortDir"),b=a.get("price"),e=this.get("DESC");
if(b===""||b==="sortdesc")e=this.get("ASC");a.set("price",this.getSortDir(e));a.set("name","");this.get("features").sortByPrice(e)},sortByName:function(){var a=this.get("sortDir"),b=a.get("name"),e=this.get("DESC");if(b===""||b==="sortdesc")e=this.get("ASC");a.set("name",this.getSortDir(e));a.set("price","");this.get("features").sortByName(e)},getSortDir:function(a){if(a===this.get("ASC"))return"sortasc";return"sortdesc"},parse:function(a){for(var b in this)if(b=="features"){var e=new collections.FeatureCollection,
f=a[b];f!==g&&e.add(f,{parse:true});a[b]=e}return a}});c.TrimModel=d.Model.extend({imageURL:null,bpvalue:null,note:null,name:null,id:null,defaults:{spriteUrl:"",thumbnailUrl:"",price:0,displayPrice:0,order:1,numImages:1,selected:false,isColour:false},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.TrimSelectedEvent,Events.eventList.buildandprice.model.TrimSelectedEvent.name,this)}});c.ColorModel=d.Model.extend({bpvalue:null,id:null,majorValue:null,name:null,note:null,
trims:null,defaults:{numImages:1,spriteUrl:"",thumbnailUrl:"",order:1,spriteMidResUrl:"",price:0,displayPrice:0,selected:false,isColour:true},parse:function(a){for(var b in this)if(b=="trims"){var e=new collections.TrimCollection,f=a[b];f!==g&&e.add(f,{parse:true});a[b]=e}return a},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.ColorChangedEvent,Events.eventList.buildandprice.model.ColorChangedEvent.name,this)}});c.FeatureGroupAttribute=d.Model.extend({featureName:null,
categoryName:null,id:null});c.EngineTransmission=d.Model.extend({bpdisplayorder:null,bpvalue:null,compdisplayorder:null,compvalue:null,detailpageid:null,featureContent:null,featureImage:null,featuretype:null,groupType:null,id:null,multiResImage:null,name:null,note:null,partNumber:null,specdisplayorder:null,specvalue:null,toolsdisplayflag:null,defaults:{price:0,priceDiff:0,displayPrice:0,hotDealUrl:"#",selected:false},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.EngineTrasmissionSelectedEvent,
Events.eventList.buildandprice.model.EngineTrasmissionSelectedEvent.name,this)}});c.HeaderModel=d.Model.extend({order:null,heading:null,step:null,headerURL:null,derivativeName:null,state:null,postcode:null,usageLabel:null,defaults:{showPricezoneSelect:true,enabled:false,isCurrent:false,visited:false},initialize:function(){Events.bind(Events.eventList.buildandprice.router.UpdatePricezoneEvent,this.updatePostcode,this);Events.bind(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,this.regionPostcodeChanged,
this);Events.bindToEvent(this,Events.eventList.buildandprice.view.PricezoneChangeRequestEvent,Events.eventList.buildandprice.model.PricezoneChangeRequestEvent.name,this);this.bind(Events.eventList.buildandprice.view.StepChangeRequestEvent,this.stepChangeRequest,this);Events.bindToEvent(this,Events.eventList.buildandprice.view.StepChangeHeaderRequestEvent,Events.eventList.buildandprice.model.StepChangeHeaderRequestEvent.name,this)},updatePostcode:function(a){this.set("postcode",a)},regionPostcodeChanged:function(a){a?
this.set({postcode:a.postcode,usage:a.usage,usageLabel:a.usageLabel}):this.set({postcode:"",usage:"",usageLabel:""})},stepChangeRequest:function(a){Events.fireEvent(Events.eventList.buildandprice.model.StepChangeRequestEvent.name,a)}});c.MobileHeaderModel=d.Model.extend({heading:null,step:null,nameplate:null,totalSteps:null,postcode:null,usageLabel:null,defaults:{showPricezoneSelect:true},initialize:function(){Events.bind(Events.eventList.buildandprice.router.UpdatePricezoneEvent,this.updatePostcode,
this);Events.bind(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,this.regionPostcodeChanged,this);Events.bindToEvent(this,Events.eventList.buildandprice.view.PricezoneChangeRequestEvent,Events.eventList.buildandprice.model.PricezoneChangeRequestEvent.name,this)},updatePostcode:function(a){this.set("postcode",a)},regionPostcodeChanged:function(a){a?this.set({postcode:a.postcode,usage:a.usage,usageLabel:a.usageLabel}):this.set({postcode:"",usage:"",usageLabel:""})}});c.FooterModel=
d.Model.extend({defaults:{price:0,priceZoneId:null,derivativeName:"",engine:"",transmission:"",nextButtonText:"",nextButtonURL:"",prevButtonText:"",prevButtonURL:"",prevEnabled:false,nextEnabled:false,vehicleThumbnailUrl:"",hasError:false,isPackage:false,postcodeHint:null,currentDate:function(){var a=new Date,b=a.getDate(),e=a.getMonth()+1;a=a.getFullYear();return b+"/"+e+"/"+a}()},initialize:function(){Events.bindToEvent(this,Events.eventList.buildandprice.view.SaveAsPDFEvent,Events.eventList.buildandprice.model.SaveAsPDFEvent.name);
Events.bindToEvent(this,Events.eventList.buildandprice.view.ShareConfigEvent,Events.eventList.buildandprice.model.ShareConfigEvent.name);this.bind(Events.eventList.buildandprice.view.TabChangeRequestEvent,this.tabChangeRequested,this);this.bind(Events.eventList.buildandprice.view.StepChangeRequestEvent,this.stepChangeRequest,this);Events.bindToEvent(this,Events.eventList.buildandprice.view.RequestAQuoteEvent,Events.eventList.buildandprice.model.RequestAQuoteEvent.name);typeof Events.eventList.buildandprice.model.PresentPaymentEvent!==
"undefined"&&Events.bindToEvent(this,Events.eventList.buildandprice.view.PresentPaymentEvent,Events.eventList.buildandprice.model.PresentPaymentEvent.name)},tabChangeRequested:function(a){Events.fireEvent(Events.eventList.buildandprice.model.TabChangeRequestEvent.name,a)},stepChangeRequest:function(a){Events.fireEvent(Events.eventList.buildandprice.model.StepChangeRequestEvent.name,a)},update:function(a,b,e,f,j,k,h,i){this.set({derivativeName:a,price:b,engine:e,nextEnabled:f,nextButtonURL:j,prevButtonURL:k});
h&&h!=null&&this.set("nextButtonText",h);i&&i!=null&&this.set("prevButtonText",i)},setNextButton:function(a,b){a==""&&this.set("nextEnabled",false);this.set("nextButtonURL",a);this.set("nextButtonText",b)},setPrevButton:function(a,b){a==""&&this.set("nextPrev",false);this.set("prevButtonURL",a);b&&this.set("prevButtonText",b)}});c.DerivativeDetailModel=d.Model.extend({id:null,imageURL:null,derivativeName:null,engineTransmission:null,name:null,summary:null,thumbnailURL:null,currentCategory:0,defaults:{price:0,
order:0,showVehicleDisclaimer:false,derivativeCode:"",hasNext:true,hasPrev:false,view:"exterior"},initialize:function(){this.currentCategory=0;this.url=this.urlRoot+this.get("id");Events.bindToEvent(this,Events.eventList.buildandprice.view.ToggleViewEvent,Events.eventList.buildandprice.model.ToggleViewEvent.name);Events.bindToEvent(this,Events.eventList.buildandprice.view.TabChangedEvent,Events.eventList.buildandprice.model.TabChangedEvent.name)},urlRoot:Config.buildandprice.urls.derivativeDetailURL});
c.GalleryModel=d.Model.extend({imageURL:null,className:"",defaults:{visible:false,layer:0,slideHeight:292,slideWidth:615,slideYpos:0,numImages:1,zIndex:1,spriteLength:615}});c.MobileGallery=d.Model.extend({imageURL:null,className:"",defaults:{visible:false,selected:false,layer:0,slideNumber:0,slideHeight:61,slideWidth:320,spriteLength:320,slideYpos:0,numMidResImages:1,zIndex:1}});c.GalleryWrapper=d.Model.extend({showArrows:false,gallery:null,initialize:function(){Events.bind(Events.eventList.buildandprice.model.HideArrowsEvent,
this.hideArrows,this);Events.bind(Events.eventList.buildandprice.model.ShowArrowsEvent,this.showArrows,this)},hideArrows:function(){this.set("showArrows",false)},showArrows:function(){this.set("showArrows",true)}});c.SummaryCategory=d.Model.extend({category:null,categoryTotal:null,features:null,defaults:{collapsed:false,order:0},collapse:function(){this.set("collapsed",true)},expand:function(){this.set("collapsed",false)}});c.SummaryFeature=d.Model.extend({name:null,featureGroups:null,defaults:{nameSuffix:null,
price:"",priceSuffix:null,pricePrefix:null,isChild:false}});c.HotDeal=d.Model.extend({id:null,nameplateId:null,derivativeId:null,defaults:{hotDealUrl:null,hotDealSmobUrl:null,derivativename:"",order:0,nameplatename:"",offerprice:0,displayPrice:0,pricedisclaimer:"",heroImageThumbnailUrl:"",imageURL:""}});c.HotDealContainer=d.Model.extend({hotdeals:null,latestOffersInstructions:null});c.Storage=d.Model.extend({derivativeDetailModel:null,categoryGroupCollection:null,pricezoneCollection:null,nameplateCollection:null,
headerCollection:null,derivativeCollection:null,packageCollection:null,colorCollection:null,hotDealCollection:null,pathCollection:null,footerModel:null,galleryCollection:null});return c}(window,document,jQuery,Backbone);

var collections=function(h,k,g){h={};h.PricezoneCollection=Backbone.Collection.extend({model:g.PriceZoneModel,url:Config.buildandprice.urls.pricezoneListURL,initialize:function(){this.bind(Events.eventList.buildandprice.view.PricezoneSelectedEvent,this.pricezoneSelected,this)},pricezoneSelected:function(a){a=this.selectById(a);Events.fireEvent(Events.eventList.buildandprice.model.PricezoneSelectedEvent.name,a)},comparator:function(a){return a.get("name")}});h.DerivativeModelCollection=Backbone.Collection.extend({model:g.DerivativeModel,
urlRoot:Config.buildandprice.urls.derivativeListURL,comparator:function(a){return parseInt(a.get("order"))}});h.PackageModelCollection=Backbone.Collection.extend({model:g.PackageModel,urlRoot:Config.buildandprice.urls.packageListURL,comparator:function(a){return parseInt(a.get("order"))}});h.NameplateCategoryCollection=Backbone.Collection.extend({model:g.NameplateCategory,nameplates:null});h.NameplateCollection=Backbone.Collection.extend({model:g.Nameplate,urlRoot:Config.buildandprice.urls.modelListURL,
initialize:function(){},comparator:function(a){return parseInt(a.get("order"))}});h.PathCollection=Backbone.Collection.extend({model:g.PathModel});h.FeatureCollection=Backbone.Collection.extend({model:g.FeatureModel,supportsMultiSelect:function(){return true},initialize:function(){this.dir=null},comparator:this.defaultComparator,defaultComparator:function(a){return a.get("bpdisplayorder")},priceComparator:function(a){return this.dir*a.get("price")},nameComparator:function(a,c){var b=0;a=a.get("name").toLowerCase();
c=c.get("name").toLowerCase();if(a>c)b=this.dir;else if(a<c)b=this.dir*-1;return b},sortByPrice:function(a){this.dir=a;this.comparator=this.priceComparator;this.sort();this.trigger(Events.eventList.buildandprice.model.FeaturesSortCompletedEvent)},sortByName:function(a){this.dir=a;this.comparator=this.nameComparator;this.sort();this.trigger(Events.eventList.buildandprice.model.FeaturesSortCompletedEvent)}});h.CategoryGroupCollection=Backbone.Collection.extend({model:g.CategoryGroupModel,selectByOrder:function(a){_.each(this.models,
function(c){c.set("selected",c.get("order")==a)})},selectCategoryById:function(a){for(var c=null,b=0;b<this.models.length;b++){var d=this.models[b].get("categories");if(d!=null&&d.length>0){c=d.selectById(a);if(c!=null)break}}return c},getSelectedFeatures:function(){var a=[],c=0;_.each(this.models,function(b){b=b.get("categories");b!=null&&b.length>0&&_.each(b.models,function(d){features=d.get("features");if(features!=null&&features.length>0)(features=features.where({selected:true}))&&features.length>
0&&_.each(features,function(e){a[c]=e;c++})})});return a},fetchFeatures:function(a){var c=[];_.each(this.models,function(b){b=b.get("categories");b!=null&&b.length>0&&_.each(b.models,function(d){d=d.get("features");d!=null&&d.length>0&&_.each(d.models,function(e){_.contains(a,e.get("id"))&&c.push(e)})})});return c},toggleFeatures:function(a,c,b){var d=[];_.each(this.models,function(e){e=e.get("categories");e!=null&&e.length>0&&_.each(e.models,function(f){f=f.get("features");f!=null&&f.length>0&&_.each(f.models,
function(i){if(_.contains(a,i.get("id"))){d.push(i);c!=null&&i.set("selected",c);var j=i.get("dependentFeatureLockCount");i.set("disabled",b?b:j>0)}})})});return d},comparator:function(a){return parseInt(a.get("order"))},urlRoot:Config.buildandprice.urls.categoryListURL});h.CategoryCollection=Backbone.Collection.extend({model:g.CategoryModel,selectByOrder:function(a){_.each(this.models,function(c){c.set("selected",c.get("order")==a,{silent:true})})},comparator:function(a){return parseInt(a.get("order"))},
urlRoot:Config.buildandprice.urls.categoryListURL});h.TrimCollection=Backbone.Collection.extend({model:g.TrimModel,comparator:function(a){return parseInt(a.get("order"))}});h.ColorCollection=Backbone.Collection.extend({model:g.ColorModel,selectTrim:function(a){(selectedColors=this.where({selected:true}))&&selectedColors.length>0&&selectedColors[0].get("trims").select(a)},comparator:function(a){return parseInt(a.get("order"))},urlRoot:Config.buildandprice.urls.colorTrimListURL});h.FeatureGroupAttributeCollection=
Backbone.Collection.extend({model:g.FeatureGroupAttribute});h.EngineTransmissionCollection=Backbone.Collection.extend({model:g.EngineTransmission,urlRoot:Config.buildandprice.urls.engineListURL});h.HeaderCollection=Backbone.Collection.extend({model:g.HeaderModel,selectable:function(){return false}});h.GalleryCollection=Backbone.Collection.extend({model:g.GalleryModel,initialize:function(){this.bind(Events.eventList.buildandprice.view.NextOrientationEvent,this.nextOrientation,this);this.bind(Events.eventList.buildandprice.view.PrevOrientationEvent,
this.prevOrientation,this);this.zIndex=10},selectable:function(){return false},nextOrientation:function(){this.changeOrientation(1);Events.fireEvent(Events.eventList.buildandprice.model.OrientationChangedEvent.name)},prevOrientation:function(){this.changeOrientation(-1);Events.fireEvent(Events.eventList.buildandprice.model.OrientationChangedEvent.name)},changeOrientation:function(a){var c=this.where({visible:true});c!=null&&c.length>0&&_.each(c,function(b){var d=b.get("spriteLength"),e=b.get("slideWidth"),
f=b.get("slideYpos")+a*e,i=Math.abs(f),j=b.get("slideNumber")+a;if(i>=d)f=0;else if(f>0)f=e-d;if(j>=b.get("numImages"))j=0;else if(j<0)j=b.get("numImages")-1;b.set({slideYpos:f,slideNumber:j})})},addBaseSprites:function(a,c){var b=this;b.addSprites(a,c,0);_.each(a.models,function(d){b.addSprites(d.get("trims"),"trim_",0)})},addAccessorySprites:function(a,c){this.addSprites(a,c,1)},addSprites:function(a,c,b){var d=this,e=(new g.GalleryModel({})).get("slideWidth");_.each(a.models,function(f){var i=
f.get("numImages"),j=f.get("spriteUrl");if(j&&j!=null&&j!="")d.add(new g.GalleryModel({id:f.get("id"),className:c+"_"+f.get("id"),imageURL:j,layer:b,slideNumber:0,numImages:i,spriteLength:e*(i==""?(i=1):i)}))})},toggleLayer:function(a,c){var b=this.get(a);if(b){a=b.get("visible");if(!(typeof c!=="undefined"&&a===c)){c=b.get("layer");var d=0,e=this.where({visible:true,layer:0});if(e&&e.length>0)d=e[0].get("slideYpos");b.set("slideYpos",b.get("spriteLength")>Math.abs(d)?d:0);if(c==1){a=!a;this.zIndex+=
1;b.set("zIndex",a?this.zIndex:1,{silent:true});b.set("visible",a);this.selectable()&&b.set("selected",a)}else if(!a){e=this.where({visible:true,layer:0});var f=this.selectable();e&&_.each(e,function(i){i.set("visible",false);f&&b.set("selected",false)});b.set("visible",!a);f&&b.set("selected",!a);b.get("numImages")<=1?Events.fireEvent(Events.eventList.buildandprice.model.HideArrowsEvent):Events.fireEvent(Events.eventList.buildandprice.model.ShowArrowsEvent)}}}}});h.MobileGallery=h.GalleryCollection.extend({model:g.MobileGallery,
addSprites:function(a,c,b){var d=this,e=(new g.MobileGallery({})).get("slideWidth");_.each(a.models,function(f){var i=f.get("numMidResImages"),j=f.get("spriteMidResUrl");if(j&&j!=null&&j!="")d.add(new g.MobileGallery({id:f.get("id"),className:c+"_"+f.get("id"),imageURL:j,layer:b,numImages:i,spriteLength:e*(i==""?(i=1):i)}))})}});h.SummaryCategoryCollection=Backbone.Collection.extend({model:g.SummaryCategory,selectable:function(){return false},comparator:function(a){return parseInt(a.get("order"))}});
h.SummaryFeatureCollection=Backbone.Collection.extend({model:g.SummaryFeature,selectable:function(){return false}});h.HotDealCollection=Backbone.Collection.extend({model:g.HotDeal,comparator:function(a){return parseInt(a.get("order"))},urlRoot:Config.buildandprice.urls.hotdealsURL});return h}(window,document,models,jQuery);

Views.Buildandprice=function(l,n,b,k){var d={};d.PricezoneOverlayView=Backbone.View.extend({initialize:function(){this.template=_.template(b("#bp-pricezone-template").html());this.optionsTemplate=_.template(b("#bp-pricezone-item-template").html());this.$el=b("#bp-dialog")},events:{"click .ok":"pricezoneSelected","click .cancel":"closeOverlay"},pricezoneSelected:function(a){a.preventDefault();a=b("#bpt-region-selector").val();this.collection.trigger(Events.eventList.buildandprice.view.PricezoneSelectedEvent,
a);this.closeOverlay()},closeOverlay:function(){this.$el.dialog("close")},render:function(){var a=this.$el,c=this,e=this.template();a.html(e);var f=a.find("#bpt-region-selector");_.each(this.collection.models,function(g){f.append(c.optionsTemplate(g.toJSON()))},this);return this},display:function(){this.render();d.Helper.openDialog(this.$el)}});d.PageTitleView=Backbone.View.extend({events:{"click #bp-scroll-view-hotdeals":"scrollToLatestOffers"},scrollToLatestOffers:function(a){a.preventDefault();
b(l).scrollTop(b("#bp-hotdeals").offset().top)},initialize:function(){this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)},display:function(){this.template=_.template(b("#bp-instructions-template").html());b("#bp-title").html(this.render().$el)}});d.ChangeVehicleHeaderView=Backbone.View.extend({tagName:"li",className:"first",initialize:function(){this.template=_.template(b("#bp-change-vehicle-header-item-template").html());this.model.bind("change",this.render,this)},
events:{"click #change-vehicle":"changeVehicle"},changeVehicle:function(){this.model.trigger(Events.eventList.buildandprice.view.ChangeVehicleEvent)}});d.PricezoneHeaderView=Backbone.View.extend({tagName:"li",className:"last",initialize:function(){this.template=_.template(b("#bp-postcode-header-item-template").html());this.model.bind("change:postcode change:usageLabel change:priceZoneId",this.render,this)},render:function(){var a=b(this.template(this.model.toJSON()));this.translate(a);b(this.el).html(a);
return this},events:{"click #change-postcode":"changePostcode"},changePostcode:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.PricezoneChangeRequestEvent)}});d.PostcodeHeaderView=d.PricezoneHeaderView.extend({changePostcode:function(a){a.preventDefault();Events.fireEvent(Events.eventList.buildandprice.view.RegionPostcodeChangeRequestEvent,true)}});d.HeaderListView=Backbone.View.extend({children:[],className:"buildmenu",render:function(){var a=0,c=this.$el,e=
this,f=b("<ul></ul>"),g=this.collection.length-1,h=this.collection.at(0).get("showPricezoneSelect");_.each(this.collection.models,function(i){var j=false;if(a==0){j=true;e.children[a]=new d.ChangeVehicleHeaderView({model:i})}else if(a<g){j=true;e.children[a]=new d.HeaderItemView({model:i})}else if(h===Constants.postcode.ot){j=true;e.children[a]=new d.PricezoneHeaderView({model:i})}else if(h===Constants.postcode.hd){j=true;e.children[a]=new d.PostcodeHeaderView({model:i})}if(j){f.append(e.children[a].render().$el);
a++}},this);c.html(f);return this},initialize:function(){this.collection.bind("destroy",this.destroy,this);this.template=_.template(b("#bp-header-list-item-template").html())},display:function(){b("#content").prepend(this.render().$el)}});d.ShortPathHeaderListView=d.HeaderListView.extend({className:"buildmenu shortpath"});d.HeaderItemView=Backbone.View.extend({tagName:"li",className:"num",initialize:function(){this.template=_.template(b("#bp-header-list-item-template").html());this.model.bind("change",
this.render,this)},events:{click:"stepClicked"},stepClicked:function(a){a.preventDefault();a=b(a.currentTarget);if(a.hasClass("disabled"))return false;else if(a.hasClass("cur"))return false;else this.model.trigger(Events.eventList.buildandprice.view.StepChangeHeaderRequestEvent,this.model)},updateData:function(){var a=this.model,c=a.get("enabled"),e=a.get("isCurrent");c=c?"num enabled":"num disabled";c+=e?" cur":"";b(this.el).attr("class",c).attr("data-href",a.get("headerURL"))},render:function(){var a=
b(this.template(this.model.toJSON()));b(this.el).html(a);this.updateData();return this}});d.FooterView=Backbone.View.extend({className:"buildbar",initialize:function(){this.template=_.template(b("#bp-footer-template").html());this.disclaimerTemplate=_.template(b("#bp-disclaimer-template").html());this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)},events:{"click #bp-next-nav":"buttonClicked","click #bp-see-disclaimer":"seeDisclaimer"},buttonClicked:function(a){a.preventDefault();
a=b(a.currentTarget);if(!a.hasClass("disabled")){a=a.attr("href");if(a.indexOf("cat-group-")>=0){a=a.substring(a.indexOf("cat-group-")+10,a.length);this.model.trigger(Events.eventList.buildandprice.view.TabChangeRequestEvent,a)}else this.model.trigger(Events.eventList.buildandprice.view.StepChangeRequestEvent,a)}},seeDisclaimer:function(a){a.preventDefault();d.Helper.injectContentOpenDialog(this.disclaimerTemplate())},display:function(){b("#content").find("#select-nameplate").append(this.render().$el)}});
d.BackButtonView=Backbone.View.extend({events:{"click #bp-back-nav":"buttonClicked"},initialize:function(){this.template=_.template(b("#bp-backbutton-template").html());this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)},buttonClicked:function(a){var c=b(a.currentTarget).attr("href");if(c.indexOf("cat-group-")>=0){a.preventDefault();a=c.substring(c.indexOf("cat-group-")+10,c.length);this.model.trigger(Events.eventList.buildandprice.view.TabChangeRequestEvent,a)}},
display:function(){b("#bp-back-button").html(this.render().$el)}});d.NameplateHeaderListView=Backbone.View.extend({className:"location",initialize:function(){this.template=_.template(b("#bp-nameplate-header-template").html());this.model.bind("change",this.render,this)},events:{"click #change-postcode":"changePostcode"},changePostcode:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.PricezoneChangeRequestEvent)},display:function(){b(".heading-bar").append(this.render().$el)}});
d.FOANameplateHeaderListView=d.NameplateHeaderListView.extend({changePostcode:function(a){a.preventDefault();Events.fireEvent(Events.eventList.buildandprice.view.RegionPostcodeChangeRequestEvent,true)}});d.NameplateCagetoryListView=Backbone.View.extend({children:[],id:"bp-select-model-container",render:function(){var a=this.$el,c=this;a.html(this.template());var e=b("<ul></ul>"),f=b('<div class="derivatives buildview"></div>');_.each(this.collection.models,function(g){var h=b('<div class="row"></div>'),
i=g.get("nameplates").models,j=0;_.each(i,function(m){c.children[j]=new d.NameplateItemView({model:m});h.append(c.children[j++].render().$el)});e.append(this.categoryTemplate(g.toJSON()));f.append(h)},this);a.find(".buildselect").append(e);a.find(".buildlist").append(f);return this},initialize:function(){this.template=_.template(b("#bp-nameplate-list-template").html());this.categoryTemplate=_.template(b("#bp-nameplate-category-item").html());this.collection.bind("reset",this.render,this)},display:function(){b("#select-nameplate").html(this.render().$el);
this.lazyload();ND.BuildList.create()}});d.NameplateListView=Backbone.View.extend({children:[],id:"bp-select-model-container",className:"derivatives buildview",render:function(){var a=0,c=this.$el,e=this,f=this.template();c.html(f);var g=c.find(".buildlist");_.each(this.collection.models,function(h){e.children[a]=new d.NameplateItemView({model:h});g.append(e.children[a].render().$el);a++},this);return this},initialize:function(){this.template=_.template(b("#bp-nameplate-list-template").html());this.collection.bind("reset",
this.render,this)},display:function(){b("#select-nameplate").html(this.render().$el);this.lazyload()}});d.NameplateItemView=Backbone.View.extend({tagName:"div",events:{"click .bp-nameplate-list-item":"modelSelected"},modelSelected:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.ModelSelectedEvent,this.model)},initialize:function(){this.template=_.template(b("#bp-nameplate-list-item-template").html());this.model.bind("change",this.toggleClass,this);this.model.bind("destroy",
this.destroy,this)},toggleClass:function(){b(this.el).toggleClass("cur",this.model.get("selected"))}});d.SelectPathListView=Backbone.View.extend({tagName:"ul",children:[],className:"switch",render:function(){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){e.children[a]=new d.SelectPathItemView({model:f,className:a==0?"first":"last"});c.append(e.children[a].render().$el);a++},this);return this},initialize:function(){},display:function(){b("#select-nameplate").html(this.render().$el)}});
d.SelectPathItemView=Backbone.View.extend({tagName:"li",initialize:function(){this.template=_.template(b("#bp-path-list-item-template").html())},events:{"click .bp-path-item":"pathSelected"},pathSelected:function(){this.model.trigger(Events.eventList.buildandprice.view.PathSelectedEvent,this.model)}});d.NoVehiclesView=Backbone.View.extend({className:"customize fixed-height-hack",initialize:function(){this.template=_.template(b("#bp-no-vehicles-template").html())},events:{"click #bp-start-over":"startOver",
"click #bp-change-region":"changeRegionRequested"},startOver:function(){this.model.trigger(Events.eventList.buildandprice.view.StartOverEvent)},changeRegionRequested:function(){this.model.trigger(Events.eventList.buildandprice.view.PricezoneChangeRequestEvent)},display:function(){b("#select-nameplate").html(this.render().$el)}});d.SelectDerivativeListView=Backbone.View.extend({children:[],id:"bp-select-derivative-container",className:"featurecarousel-wrapper buildmodel",render:function(){var a=0,
c=this.$el;c.html(this.template());var e=c.find("#bp-featurecarousel-ul"),f=this;_.each(this.collection.models,function(g){f.children[a]=new d.SelectDerivativeItemView({model:g});e.append(f.children[a].render().$el);a++},this);return this},initialize:function(){this.template=_.template(b("#bp-derivative-list-template").html())},display:function(){b("#select-nameplate").html(this.render().$el);b.fn.buildComparatorCarousel("#bp-select-derivative-container");this.lazyload()}});d.SelectDerivativeItemView=
Backbone.View.extend({tagName:"li",className:"bp-derivative-list-item",events:{"click .bp-derivative-list-item":"derivativeSelected","click .details-button":"viewHotDealOffer"},derivativeSelected:function(a){a.preventDefault();d.Helper.closeEngineDialog(a,true);this.model.trigger(Events.eventList.buildandprice.view.DerivativeSelectedEvent,this.model)},viewHotDealOffer:function(a){var c=this.model.get("hotDealUrl");if(c==="#"||c==="")a.preventDefault()},initialize:function(){this.template=_.template(b("#bp-derivative-list-item-template").html());
this.hotDealTemplate=_.template(b("#bp-derivative-list-item-hotdeal-template").html());this.model.bind("change:selected",this.toggleClass,this);this.model.bind("change:hotDealUrl",this.addHotDealUrl,this);this.model.bind("destroy",this.destroy,this)},render:function(){var a=this.template(this.model.toJSON());b(this.el).toggleClass("cur",this.model.get("selected")).html(a);this.addHotDealUrl();return this},addHotDealUrl:function(){b(this.el).append(this.hotDealTemplate({hotDealUrl:this.model.get("hotDealUrl")}))},
toggleClass:function(){b(this.el).toggleClass("cur",this.model.get("selected"))}});d.SelectPackageListView=d.SelectDerivativeListView.extend({render:function(){var a=0,c=this.$el,e=this.template();c.html(e);var f=c.find("#bp-featurecarousel-ul"),g=this;_.each(this.collection.models,function(h){g.children[a]=new d.SelectPackageItemView({model:h});f.append(g.children[a].render().$el);a++},this);return this}});d.SelectPackageItemView=Backbone.View.extend({tagName:"li",className:"bp-package-list-item",
events:{"click .bp-package-list-item":"packageSelected","click .details-button":"viewPackageDetailsSelected"},packageSelected:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.PackageSelectedEvent,this.model)},viewPackageDetailsSelected:function(a){d.Helper.openOverlay(a)},initialize:function(){this.template=_.template(b("#bp-package-list-item-template").html());this.model.bind("change",function(){this.toggleClass();this.translate()},this);this.model.bind("destroy",
this.destroy,this)},render:function(){var a=this.template(this.model.toJSON());b(this.el).toggleClass("cur",this.model.get("selected")).html(a);return this},toggleClass:function(){b(this.el).toggleClass("cur",this.model.get("selected"))}});d.SummaryView=Backbone.View.extend({events:{"click .see-included":"seeWhatsIncluded","click #bp-save-as-pdf":"saveAsPDF","click #bp-share-config":"shareConfig","click #bp-request-quote-btn":"requestAQuote","click #bp-payment-presenter-btn":"presentPayment","click #bp-postcode-overlay-warning-close":"closePostcodeWarningOverlay",
"click .loan-calculator-overlay":"openLoanCalculatorOverlay"},openLoanCalculatorOverlay:function(a){a.preventDefault();b(a.target).loanCalculatorOverlay({price:this.model.get("unformattedPolkPrice"),url:b(a.target).attr("data-url"),location:this.model.get("locationValue"),priceformatter:ND.PriceFormatter})},closePostcodeWarningOverlay:function(){b(".disclaimerpanel").addClass("hidden")},seeWhatsIncluded:function(a){a.preventDefault();d.Helper.openOverlay(a)},saveAsPDF:function(a){a.preventDefault();
this.model.trigger(Events.eventList.buildandprice.view.SaveAsPDFEvent)},requestAQuote:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.RequestAQuoteEvent,"#bp-request-quote-form")},presentPayment:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.PresentPaymentEvent,"#bp-payment-presenter-form")},shareConfig:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.ShareConfigEvent)},initialize:function(){this.template=
_.template(b("#bp-summary-template").html());this.dialogTemplate=_.template(b("#bp-share-dialog-template").html());this.model.bind("destroy",this.destroy,this);this.model.bind("change",this.render,this);Events.bind(Events.eventList.buildandprice.router.PDFReadyEvent,this.displayPDF,this);Events.bind(Events.eventList.buildandprice.router.ShareReadyEvent,this.displayDialog,this)},display:function(){b("#select-nameplate").html(this.render().$el)},displayDialog:function(a){d.Helper.injectContentOpenDialog(b(this.dialogTemplate({url:a,
encodedUrl:encodeURIComponent(a)})));b("#bpt-share-url").on("click",function(){b(this).select()});b(".bp-share-via").on("click",function(){var c=b(this).attr("data-provider");Events.fireEvent(Events.eventList.buildandprice.view.ShareLinkClickedEvent,c)})}});d.PriceCategoryBreakdownListView=Backbone.View.extend({tagName:"ul",children:[],events:{"click .toggle":"toggleBreakdown"},toggleBreakdown:function(a){b(a.currentTarget).parents("li").toggleClass("collapsed")},initialize:function(){this.template=
_.template(b("#bp-summary-price-breakdown-list-template").html());this.model.bind("destroy",this.destroy,this)},render:function(){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){var g=this.template(f.toJSON());c.append(g);var h=c.find("#summary-breakdown-item-"+f.get("order"));_.each(f.get("features").models,function(i){e.children[a]=new d.PriceFeatureBreakdownListItemView({model:i});h.append(e.children[a].render().$el);a++})},this);return this},display:function(){b("#bp-summary-price-breakdown").html(this.render().$el);
b(".accordion").each(function(){d.Helper.createScrollPane(b(this))})}});d.PriceFeatureBreakdownListItemView=Backbone.View.extend({tagName:"li",initialize:function(){this.template=_.template(b("#bp-summary-price-breakdown-list-item-template").html());this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)},render:function(){var a=b(this.template(this.model.toJSON()));b(this.el).toggleClass("child-node",this.model.get("isChild")).html(a);return this}});d.TrimListView=
Backbone.View.extend({tagName:"ul",id:"trim-list",className:"choice",children:[],render:function(){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){e.children[a]=new d.TrimItemView({model:f});c.append(e.children[a].render().$el);a++},this);return this},display:function(){b("#trim-items").html(this.render().$el);b.fn.tooltip(function(a){a.itemheight>100&&alert("hiu")})}});d.TrimItemView=Backbone.View.extend({tagName:"li",events:{"click .trim-item":"trimChanged"},render:function(){var a=
this.model.toJSON(),c=this.template(a),e=this.$el;e.html(c);this.toggleSelected();e.append(this.tooltipTemplate(a));return this},initialize:function(){this.nameTemplate=_.template(b("#bp-trim-list-template").html());this.template=_.template(b("#bp-trim-list-item-template").html());this.tooltipTemplate=_.template(b("#bp-tooltip-template").html());this.model.bind("change",this.toggleSelected,this);this.model.bind("destroy",this.destroy,this);ND.Utils!==k&&ND.Utils.isTouchDevice()===true&&b(this.el).on("mouseover",
".trim-item",b.proxy(this.trimChanged,this))},toggleSelected:function(){var a=this.model.get("selected");b(this.el).toggleClass("cur",a);a===true&&b("#trim-name").html(this.nameTemplate({selected:a,name:this.model.get("name")}))},destroy:function(){b(this.el).unbind();b(this.el).remove()},trimChanged:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.TrimSelectedEvent,{trim:this.model,isSystem:false})}});d.ColorListView=Backbone.View.extend({className:"tab-colours",
children:[],events:{},render:function(){var a=0,c=this.$el;c.html(this.template());var e=c.find("#color-list"),f=c.find("#color-name");_.each(this.collection.models,function(g){this.children[a]=new d.ColorItemView({model:g,colorNameDiv:f,template:this.colorItemTemplate,tooltipTemplate:this.tooltipTemplate,nameTemplate:this.nameTemplate});e.append(this.children[a].render().$el);a++},this);return this},initialize:function(a){this.template=_.template(b("#bp-color-list-template").html());this.colorItemTemplate=
_.template(b("#bp-color-list-item-template").html());this.tooltipTemplate=_.template(b("#bp-tooltip-template").html());this.nameTemplate=_.template(b("#bp-color-name-template").html());this.parent=a.parent},display:function(){b(this.parent).html(this.render().$el);b.fn.tooltip()}});d.ColorItemView=Backbone.View.extend({tagName:"li",events:{"click .color-item":"colorChanged"},colorChanged:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.ColorChangedEvent,{color:this.model,
isSystem:false})},render:function(){var a=this.model.toJSON(),c=this.template(a),e=b(this.el);e.html(c);this.toggleSelected();e.append(this.tooltipTemplate(a));return this},toggleSelected:function(){var a=this.model.get("selected");b(this.el).toggleClass("cur",a);a===true&&this.$colorNameDiv.html(this.nameTemplate({selected:a,name:this.model.get("name")}))},initialize:function(a){this.model.bind("change:selected",this.toggleSelected,this);this.model.bind("destroy",this.destroy,this);this.$colorNameDiv=
a.colorNameDiv;this.template=a.template;this.nameTemplate=a.nameTemplate;this.tooltipTemplate=a.tooltipTemplate;ND.Utils!==k&&ND.Utils.isTouchDevice()===true&&b(this.el).on("mouseover",".color-item",b.proxy(this.colorChanged,this))}});d.GalleryImageView=Backbone.View.extend({render:function(){var a=this.template(this.model.toJSON()),c=b(this.el);c.html(a);a=c.children(".vehicle-sprite");if(this.model.get("layer")==1){a.css("opacity",0);a.animate({opacity:1},1200)}else{a.css("opacity",0.4);a.animate({opacity:1},
800)}return this},initialize:function(){this.template=_.template(b("#bp-gallery-image-item-template").html());this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)}});d.GalleryView=Backbone.View.extend({children:[],events:{"click #gallery-next":"next","click #gallery-prev":"prev"},next:function(a){a.preventDefault();this.collection.trigger(Events.eventList.buildandprice.view.NextOrientationEvent)},prev:function(a){a.preventDefault();this.collection.trigger(Events.eventList.buildandprice.view.PrevOrientationEvent)},
render:function(){b(this.el).html(this.template());return this},renderChildren:function(){var a=b(this.el).find("#gallery-content"),c=0,e=false;_.each(this.collection.models,function(f){if(c===0)e=f.get("numImages")>1;this.children[c]=new d.GalleryImageView({model:f});a.append(this.children[c].render().$el);c++},this);e===true&&d.Helper.displayGalleryCueMessage();return this},initialize:function(){this.template=_.template(b("#bp-gallery-template").html());this.collection.bind("destroy",this.destroy,
this);Events.bind(Events.eventList.buildandprice.model.ShowArrowsEvent,this.enableNextPrevArrows,this);Events.bind(Events.eventList.buildandprice.model.HideArrowsEvent,this.disableNextPrevArrows,this)},enableNextPrevArrows:function(){b("#gallery-next").removeClass("hidden");b("#gallery-prev").removeClass("hidden")},disableNextPrevArrows:function(){b("#gallery-next").addClass("hidden");b("#gallery-prev").addClass("hidden")},display:function(){b("#gallery").prepend(this.render().$el).append(this.renderChildren().$el)}});
d.CategoryGroupHeaderListView=Backbone.View.extend({children:[],tagName:"ul",render:function(){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){if(typeof f.get("hideInBuildPrice")==="undefined"){e.children[a]=new d.CategoryGroupHeaderItemView({model:f});c.append(e.children[a].render().$el)}a++},this);return this},initialize:function(){},display:function(){b("#tab-groups").prepend(this.render().$el)}});d.CategoryGroupHeaderItemView=Backbone.View.extend({tagName:"li",initialize:function(){this.template=
_.template(b("#bp-cat-group-header-item-template").html());this.model.bind("destroy",this.destroy,this)}});d.CategoryGroupBodyListView=Backbone.View.extend({children:[],scrollbars:[],render:function(){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){e.children[a]=new d.CategoryGroupBodyItemView({id:e.idPrefix+f.get("order"),model:f});c.append(e.children[a].render().$el);a++},this);return this},initialize:function(){this.idPrefix="cat-group-";this.$el=b("#tab-groups");Events.bind(Events.eventList.buildandprice.view.UpdateScrollBarEvent,
this.updateScrollbar,this)},updateScrollbar:function(){_.each(this.scrollbars,function(a){a.is(":visible")&&d.Helper.updateScrollPane(a)})},display:function(){this.render();var a=this;b("div.scrollbar-wrapper").each(function(){a.scrollbars.push(d.Helper.createScrollPane(b(this)))});_.each(this.collection.models,function(c){c=c.get("categories");c!=null&&c.length>1&&b("#tabs-accessories").tabs({select:a.tabChanged})})},tabChanged:function(a,c){Events.fireEvent(Events.eventList.buildandprice.view.SubTabChangedEvent,
c.panel.id)},destroy:function(){this.scrollbars=[];Backbone.View.prototype.destroy.call(this)}});d.CategoryGroupBodyItemView=Backbone.View.extend({children:[],render:function(){var a=0,c=this.$el,e=this.model.get("categories");if(typeof this.model.get("hideInBuildPrice")==="undefined")if(e!=null){var f=this.model.get("containsFeatureGroup")?"factorypanel":"";f=b('<div id="tabs-accessories" class="'+f+'"></div>');var g=this.model.get("order");this.children[a]=new d.CategoryListView({parent:this.parentPrefix+
g,collection:e});f.append(this.children[a].render().$el);a++;var h=b('<div class="accessory-tab-content"></div>');_.each(e.models,function(i){this.children[a]=new d.FeatureListView({id:this.idPrefix+i.get("order"),model:i});h.append(this.children[a].render().$el);a++},this);f.append(h);c.html(f)}return this},initialize:function(){this.model.bind("destroy",this.destroy,this);this.parentPrefix="#cat-group-";this.idPrefix="cat-"}});d.CategoryListView=Backbone.View.extend({tagName:"ul",children:[],categoryCount:0,
render:function(){this.categoryCount=this.collection.length;if(this.categoryCount>1){var a=0,c=this.$el,e=this;_.each(this.collection.models,function(f){e.children[a]=new d.CategoryHeaderItemView({className:a==0?"first":a==e.categoryCount-1?"last":"",model:f});c.append(e.children[a].render().$el);a++},this)}return this},initialize:function(a){this.parent=a.parent}});d.CategoryHeaderItemView=Backbone.View.extend({tagName:"li",initialize:function(){this.template=_.template(b("#bp-category-list-item-template").html());
this.model.bind("change",this.render,this);this.model.bind("destroy",this.destroy,this)}});d.FeatureListView=Backbone.View.extend({children:[],className:"bp-feature-list",events:{"click .bp-sort-price":"sortByPrice","click .bp-sort-name":"sortByName"},sortByName:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.SortFeaturesByNameEvent)},sortByPrice:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.SortFeaturesByPriceEvent)},render:function(){var a=
this.$el,c=this.model.get("sortDir");a.append(this.template({nameSortDir:c.get("name"),priceSortDir:c.get("price")}));c=b('<div class="scrollbar-wrapper"></div>');var e=b('<ul class="accessories-list"></ul>');this.renderFeatures(e);c.html(e);a.append(c);return this},renderFeatures:function(a){var c=this.model.get("features"),e=0;a.empty();this.reset();_.each(c.models,function(f){this.children[e]=new d.FeatureItemView({model:f});a.append(this.children[e].render().$el);e++},this)},initialize:function(){this.template=
_.template(b("#bp-feature-list-template").html());this.model.get("features").bind(Events.eventList.buildandprice.model.FeaturesSortCompletedEvent,this.updateList,this)},updateList:function(){var a=this.$el;a.find(".bp-sort-options").remove();var c=this.model.get("sortDir");a.prepend(this.template({nameSortDir:c.get("name"),priceSortDir:c.get("price")}));this.renderFeatures(a.find("ul.accessories-list"))},reset:function(){_.each(this.children,function(a){a.destroy()},this);this.children=[]}});d.FeatureItemView=
Backbone.View.extend({className:"feature",tagName:"li",events:{"click .selection":"featureSelected","click .message > a":"viewFeatureDetails","click .expand-collapse":"expandCollapse","mouseenter .bp-tooltip-link":"tooltipHoverOn","mouseleave .bp-tooltip-link":"tooltipHoverOff"},featureSelected:function(a){a.preventDefault();if(!this.model.get("disabled")){this.model.trigger(Events.eventList.buildandprice.view.FeatureSelectedEvent,this.model);if(this.model.get("selected"))this.model.get("spriteUrl")!=
""?d.Helper.displayFeatureVisualisedMessage(this.$visualiseMsg,this.$notVisualiseMsg):d.Helper.displayFeatureVisualisedMessage(this.$notVisualiseMsg,this.$visualiseMsg)}},expandCollapse:function(a){a.preventDefault();a=b(a.target);var c=a.parent().siblings("ul.bp-feature-group"),e=c.hasClass("expanded");c.toggleClass("expanded",!e).toggleClass("hidden",e);a.attr("class",e?"spsplus":"spstoggle");Events.fireEvent(Events.eventList.buildandprice.view.UpdateScrollBarEvent)},tooltipHoverOn:function(){if(!this.model.get("disabled")){b("#bp-feature-tooltip-p").text(this.model.get("note"));
b("#bp-feature-tooltip").show()}},tooltipHoverOff:function(){b("#bp-feature-tooltip").hide()},viewFeatureDetails:function(a){if(!this.model.get("disabled")){Events.fireEvent(Events.eventList.buildandprice.view.ViewAccessoryDetailsEvent);d.Helper.openOverlay(a)}},initialize:function(){this.template=_.template(b("#bp-feature-list-item-template").html());this.messageTemplate=_.template(b("#bp-feature-message-template").html());this.model.bind("change:selected change:disabled",this.toggleClass,this);
this.model.bind("change:message",this.updateMessage,this);this.model.bind("destroy",this.destroy,this);this.$visualiseMsg=b("#bp-visualise-msg");this.$notVisualiseMsg=b("#bp-no-visualise-msg")},toggleClass:function(){var a=b(this.el);a.toggleClass("active",this.model.get("selected")).toggleClass("disabled",this.model.get("disabled"));return a},updateMessage:function(){var a=b(this.el);a.find("div.message").remove();a.append(this.messageTemplate(this.model.toJSON()));Events.fireEvent(Events.eventList.buildandprice.view.UpdateScrollBarEvent)},
render:function(){var a=this.model.toJSON(),c=this.toggleClass().html(this.template(a)),e=this.model.get("featureGroupAttributes");if(this.model.get("isOptionPack")&&e&&e!=null&&e.length>0){var f=b('<ul class="bp-feature-group hidden"></ul>');_.each(e.models,function(g){f.append("<li>"+g.get("featureName")+"</li>")},this);c.find("div.info").append(f)}else c.append(this.messageTemplate(a));return this}});d.EngineTransmissionListView=Backbone.View.extend({children:[],render:function(){var a=0,c=this.$el;
c.html(this.template());var e=c.find(".derivative-list"),f=this;_.each(this.collection.models,function(g){f.children[a]=new d.EngineTransmissionItemView({model:g});e.append(f.children[a].render().$el);a++},this);return this},initialize:function(){this.template=_.template(b("#bp-engine-list-template").html())},display:function(){b("#bp-engine-overlay").html(this.render().$el);d.Helper.openEngineDialog(this.collection.size())}});d.EngineTransmissionItemView=Backbone.View.extend({tagName:"li",events:{"click .selection, .info":"engineChanged"},
engineChanged:function(){this.model.trigger(Events.eventList.buildandprice.view.EngineTrasmissionSelectedEvent)},initialize:function(){this.template=_.template(b("#bp-engine-list-item-template").html());this.model.bind("change:selected",this.toggleClass,this);this.model.bind("destroy",this.destroy,this)},render:function(){var a=b(this.template(this.model.toJSON()));this.$el.toggleClass("active",this.model.get("selected"));this.$el.html(a);return this},toggleClass:function(){this.$el.toggleClass("active",
this.model.get("selected"))}});d.DerivativeDetailView=Backbone.View.extend({children:[],numTabs:0,$tabs:null,tabAnimator:null,initialize:function(){this.template=_.template(b("#bp-derivative-detail-template").html());this.carViewTemplate=_.template(b("#bp-interior-exterior-switch-template").html());this.model.bind("change",this.renderCarView,this);this.model.bind(Events.eventList.buildandprice.router.LoadCompleteEvent,this.initTabs,this);Events.bind(Events.eventList.buildandprice.router.NextTabEvent,
this.nextTab,this);Events.bind(Events.eventList.buildandprice.router.PrevTabEvent,this.prevTab,this);this.tabAnimator=this.$tabs=null},events:{"click #interior-exterior":"toggleInteriorExteriorView","click #bp-overlay-close":"closeVehicleOverlay","click #bp-overlay-disclaimer":"showVehicleDisclaimerOverlay"},closeVehicleOverlay:function(){b(".disclaimerpanel").addClass("hidden")},showVehicleDisclaimerOverlay:function(a){a.preventDefault();this.model.get("showVehicleDisclaimer")&&b(".disclaimerpanel").removeClass("hidden")},
toggleInteriorExteriorView:function(a){a.preventDefault();this.model.trigger(Events.eventList.buildandprice.view.ToggleViewEvent,b(a.currentTarget).attr("data-view"))},nextTab:function(){this.selectTab(+1)},prevTab:function(){this.selectTab(-1)},selectTab:function(a){var c=this.$tabs.tabs("option","selected");c+a>=0&&c+a<this.numTabs&&this.$tabs.tabs("option","selected",c+a)},renderCarView:function(){var a=this.carViewTemplate(this.model.toJSON()),c=b("#switch-car-view");c.html(a);this.translate(c);
return this},render:function(){var a=this.template(this.model.toJSON());b(this.el).html(a);return this.renderCarView()},display:function(){b("#select-nameplate").html(this.render().$el);b.fn.tooltip()},displayChildView:function(a){this.children[this.children.length]=a;a.display()},initTabs:function(){var a=this;this.$tabs=b("#tab-groups");this.$tabs.tabs({select:b.proxy(a.tabChanged,a)});this.tabAnimator=new d.TabAnimator(this.$tabs);this.numTabs=this.$tabs.tabs("length");this.renderCarView()},tabChanged:function(a,
c){this.model.trigger(Events.eventList.buildandprice.view.TabChangedEvent,c.panel.id);this.tabAnimator.moveIndicator(c.index)}});d.ErrorView=Backbone.View.extend({className:"customize fixed-height-hack",initialize:function(){this.template=_.template(b("#bp-error-template").html())},events:{"click #bp-start-over":"startOver"},startOver:function(){this.model.trigger(Events.eventList.buildandprice.view.StartOverEvent)},display:function(){b("#select-nameplate").html(this.render().$el)}});d.HotDealsView=
Backbone.View.extend({className:"latestoffer",children:[],initialize:function(){this.template=_.template(b("#bp-hotdeal-list-template").html())},render:function(){var a=0,c=this.$el;c.html(this.template({title:this.model.get("latestOffersInstructions")}));var e=c.find("#bp-hotdeal-featurecarousel-ul"),f=this;c=this.model.get("hotdeals");_.each(c.models,function(g){f.children[a]=new d.HotDealItemView({model:g});e.append(f.children[a].render().$el);a++},this);return this},display:function(){b("#bp-hotdeals").html(this.render().$el);
b.fn.buildComparatorCarousel("#bp-hotdeal-featurecarousel");this.lazyload()}});d.HotDealItemView=Backbone.View.extend({tagName:"li",className:"bp-hotdeal-list-item",initialize:function(){this.template=_.template(b("#bp-hotdeal-list-item-template").html())}});d.ViewManager=function(){var a=null,c=null,e=[],f=false;showPricesLater=false;independantViews=[];loader=null;blockUI=function(){if(loader==null){loader=ND.loadmask();loader.show()}};unblockUI=function(){if(loader!=null){loader.hide();loader=
null}};setAskForPostcode=function(g){f=g};hideShowPrices=function(g){b("#content").toggleClass("bp-hide-prices",g)};hideShowHotDealPrices=function(){b("#bp-hotdeals").addClass("bp-hide-hotdeal-prices")};setShowPricesLater=function(){showPricesLater=true;Events.unbind(Events.eventList.buildandprice.router.ShowPricesLaterEvent,this)};return{initialise:function(){Events.bind(Events.eventList.buildandprice.router.BlockUIEvent,blockUI,this);Events.bind(Events.eventList.buildandprice.router.UnblockUIEvent,
unblockUI,this);Events.bind(Events.eventList.buildandprice.router.HidePricesEvent,hideShowPrices,this);Events.bind(Events.eventList.buildandprice.router.HideHotDealPricesEvent,hideShowHotDealPrices,this);Events.bind(Events.eventList.buildandprice.router.AskForPostcodeEvent,setAskForPostcode,this);Events.bind(Events.eventList.buildandprice.router.ShowPricesLaterEvent,setShowPricesLater,this)},displayTitleView:function(g){a=new d.PageTitleView({model:g});a.display();Views.Helper.translateTextOnView()},
displayParentView:function(g,h,i){this.destroy();c=new g({model:h,collection:h,parent:i});c.display();Views.Helper.translateTextOnView();if(f===true){Events.fireEvent(Events.eventList.buildandprice.view.RegionPostcodeChangeRequestEvent,true);f=false}else showPricesLater===true&&hideShowPrices(false);return c},displayChildView:function(g,h,i){g=new g({model:h,collection:h,parent:i});e.push(g);g.display();Views.Helper.translateTextOnView();return g},displayIndependantView:function(g,h,i){if(independantViews[g]===
k){h=new h({model:i,collection:i});h.display();Views.Helper.translateTextOnView();independantViews[g]=h}else{h=independantViews[g];h.display()}return h},removeIndependantView:function(g){if(independantViews[g]!==k){independantViews[g].destroy();delete independantViews[g]}},destroy:function(){if(c){c.destroy();for(var g=0;e.length;g++)e.shift().destroy();a!=null&&a.destroy();e=[]}}}};d.Helper={engineDialogStack:[],openOverlay:function(a){a.preventDefault();b.publish("overlay.launch",{url:a.currentTarget.href,
positionType:"window",name:"bpt-package-whats-included"})},createScrollPane:function(a){return a.jScrollPane({showArrows:true,verticalTrackHeight:100,verticalGutter:5}).css("padding-bottom","10px")},updateScrollPane:function(a){(a=a.data("jsp"))&&a.reinitialise()},injectContentOpenDialog:function(a){var c=b("#bp-dialog");c.html(a);Views.Helper.translateTextOnView(c);this.openDialog("#bp-dialog")},openDialog:function(a){b(a).dialog({modal:true,width:600,closeText:Constants.bpt.close,dialogClass:"bp-dialog-container",
closeOnEscape:false,resizable:false});b(".ui-widget-overlay").css({position:"fixed",top:0})},openEngineDialog:function(a){$selector=b(".derivative-overlay");$selector.length>0&&$selector.dialog({position:{my:"left top",at:"right top",of:b(".items .cur"),offset:"5 -12",collision:"flip"},dialogClass:"no-close",closeText:"",width:355,draggable:false,closeOnEscape:true,modal:false,resizable:false,open:function(){$selector.toggleClass("bp-hide-prices",b("#content").hasClass("bp-hide-prices"));if(a>3){$selector.find(".derivative-list").css("height",
"260px");d.Helper.createScrollPane($selector.find(".derivative-list"))}b("body").bind("click",d.Helper.closeEngineDialog)}})},closeEngineDialog:function(a,c){var e=b(".derivative-overlay");if(e.length>0)if(c===true)d.Helper.destroyEngineDialog(e);else{a=b(a.target);e.dialog("isOpen")&&!a.closest(".ui-dialog").length&&a.parents(".bp-derivative-list-item").length==0&&d.Helper.destroyEngineDialog(e)}},destroyEngineDialog:function(a){b("body").unbind("click",d.Helper.closeEngineDialog);a.dialog("destroy").remove()},
displayGalleryCueMessage:function(){var a=b("#bp-rotate-msg");a.length>0&&a.fadeIn("fast").delay(1500).fadeOut(1E3,function(){a.addClass("hidden")})},displayFeatureVisualisedMessage:function(a,c){c.stop(true,true).hide();a.stop(true,true).fadeIn("fast").delay(800).fadeOut("slow")}};d.TabAnimator=function(a){var c=a.find("ul.ui-tabs-nav").first();navListChildren=c.children();var e=function(f,g){var h=navListChildren.eq(f);f=h.offset().left-a.offset().left;h=h.width();c.animate({"background-position":(f+
h/2>>0)-152+(g?g:0)+"px 34px"},"fast")};e(0,95);return{moveIndicator:e}};return d}(window,document,jQuery);

var BPAnalytics=Backbone.Model.extend({defatuls:{region:null},initialize:function(){if(ConfigUtil.showPricezones()){Events.bind(Events.eventList.buildandprice.router.UpdatePricezoneEvent,this.storeCurrentPricezone,this);Events.bind(Events.eventList.buildandprice.omniture.PricezoneChangedEvent,this.regionChanged,this)}if(ConfigUtil.showPostcodeSelect()){Events.bind(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,this.storeCurrentRegion,this);Events.bind(Events.eventList.buildandprice.model.RegionPostcodeLoadedFromConfigEvent,
this.storeCurrentRegion,this);Events.bind(Events.eventList.buildandprice.omniture.RegionPostcodeChangedEvent,this.regionChanged,this)}Events.bind(Events.eventList.buildandprice.omniture.StateChangedEvent,this.trackOmniturePage,this);Events.bind(Events.eventList.buildandprice.omniture.TabChangedEvent,this.tabChanged,this);Events.bind(Events.eventList.buildandprice.omniture.ViewAccessoryDetailsEvent,this.accessoryDetailViewed,this);Events.bind(Events.eventList.buildandprice.omniture.ShareLinkClickedEvent,
this.shareLinkClicked,this);Events.bind(Events.eventList.buildandprice.omniture.SaveAsPDFEvent,this.saveAsPDFClicked,this)},storeCurrentRegion:function(a){this.set("region",a.postcode)},storeCurrentPricezone:function(a){this.set("region",a)},setupParams:function(a,b){b={type:b};this.resetOmnitureVars();this.setPath(a);return b},saveAsPDFClicked:function(a){var b=this.setupParams(a,"d");b.pname=_da.pname+":4"+a.path+"summary";b.link=b.title=this.constructShareLink(a)+"pdf";b.onclicks="build:pdf";this.setupNameplateVars(a);
$.publish("/analytics/link/",b)},shareLinkClicked:function(a){var b=this.setupParams(a,"e");b.pname=_da.pname+":4"+a.path+"summary";b.link=b.title=this.constructShareLink(a)+"share";b.onclicks="build:share:"+a.provider;this.setupNameplateVars(a);$.publish("/analytics/link/",b)},constructShareLink:function(a){return _da.pname+a.path+(a.path===":"+Constants.path.pkg+":"?"":"vehicle summary:")},regionChanged:function(){var a={type:"o"};this.resetOmnitureVars();a.link=a.title=_da.pname+":0a:model:postal code";
a.onclicks="postal code";a.pname=_da.pname+":0:model:postal code";$.publish("/analytics/link/",a)},tabChanged:function(a){this.resetOmnitureVars();this.setupRegionVars();this.constructTabPagename(a);if(typeof a.state!=="undefined"){Events.unbind(Events.eventList.buildandprice.omniture.OrientationChangedEvent,this);Events.bindOnce(Events.eventList.buildandprice.omniture.OrientationChangedEvent,this.vehicleOrientationChanged,this);if(a.isColorTrimTab){Events.unbind(Events.eventList.buildandprice.omniture.ColorSelectedEvent,
this);Events.bindOnce(Events.eventList.buildandprice.omniture.ColorSelectedEvent,this.colorChanged,this);Events.unbind(Events.eventList.buildandprice.omniture.TrimSelectedEvent,this);Events.bindOnce(Events.eventList.buildandprice.omniture.TrimSelectedEvent,this.trimChanged,this)}this.setupOmnitureVars(a);ND.analyticsTag.trackOmnitureSinglePageApp()}},colorChanged:function(a){this.resetOmnitureVars();var b=this.setupParams(a,"o");b.pname=_da.pname+":3a"+a.path+"colour trim";b.link=b.title=_da.pname+
a.path+"colour trim:ext";b.onclicks=_da.pname+":colorizer:ext";this.setupNameplateVars(a);$.publish("/analytics/link/",b)},trimChanged:function(a){this.resetOmnitureVars();var b=this.setupParams(a,"o");_da.region=undefined;b.pname=_da.pname+":3a"+a.path+"colour trim";b.link=b.title=_da.pname+a.path+"colour trim:int";b.onclicks=_da.pname+":colorizer:int";this.setupNameplateVars(a);$.publish("/analytics/link/",b)},accessoryDetailViewed:function(a){var b={type:"o"};this.resetOmnitureVars();this.constructTabPagename(a);
b.pname=a.state+a.stepName;b.link=b.title="vehicle:accessories:pop up:detail";b.onclicks="accessories: detail popup";typeof a.state!=="undefined"&&$.publish("/analytics/link/",b)},vehicleOrientationChanged:function(a){var b={type:"o"};this.resetOmnitureVars();this.constructTabPagename(a);if(typeof a.state==="undefined"){a.state="3";a.stepName="exterior"}b.pname=_da.pname+":"+a.state+a.stepName;b.link=b.title=_da.pname+a.stepNameNoAnalyticsStep+":360";b.onclicks=_da.pname+":360";this.setupNameplateVars(a);
$.publish("/analytics/link/",b)},resetOmnitureVars:function(){_da.tool=_da.der=_da.nameplate=_da.events=_da.region=undefined;_da.funnel.stepname=undefined},setupRegionVars:function(){if(this.get("region")!=null)_da.region=this.get("region")},setupOmnitureVars:function(a){_da.funnel.stepname=a.state+a.stepName;this.setupNameplateVars(a);if(typeof a.events!=="undefined"&&a.events!=null)_da.events=a.events.split(",")},setupNameplateVars:function(a){if(typeof a.storage!=="undefined"){a=a.storage.get(Constants.storage.nameplateCollection).getSelected();
if(typeof a!=="undefined"&&a!=null)_da.nameplate={name:a.get("analyticsName")||a.get("name"),year:a.get("modelYear"),id:a.get("id"),cat:a.get("analyticsCategory")||a.get("category")}}},validateAndSetPrice:function(a){_da.der.price=a!=null&&a!==""&&_.isNumber(a)?parseInt(a,10):undefined},trackOmniturePage:function(a){var b,d;this.resetOmnitureVars();this.setupRegionVars();switch(a.state){case Constants.state.SELECT_NAMEPLATE:b=":model:select";a.state="0";break;case Constants.state.SELECT_PATH:b=":package or full";
a.state="1";break;case Constants.state.SELECT_PACKAGE:case Constants.state.SELECT_DERIVATIVE:a.state="2";if(a.path===Constants.path.pkg)b=":package:select";else if(a.path===Constants.path.drv)b=":full:derivative";_da.tool={name:"event: bp start"};d="event6,event43";break;case Constants.state.CUSTOMIZE_DERIVATIVE:this.tabChanged(a);return;case Constants.state.SUMMARY:a.state="4";if(a.path===Constants.path.pkg)b=":package";else if(a.path===Constants.path.drv)b=":full";b+=":summary";_da.tool={name:"event: bp finished"};
d="event2,event43";_da.der={};var c=a.storage.get(Constants.storage.colorCollection).getSelected();_da.der.colour=c.get("id");_da.der.trim=c.get("trims").getSelected().get("id");var e=[],g=[],h=[];c=a.userPref.get("featuresObject");c!=null&&c.length>0&&_.each(c.models,function(f){if(f.get("groupType")==="Option Pack")h.push(f.get("id"));else f.get("featuretype")!=="Accessory"?e.push(f.get("id")):g.push(f.get("id"))});_da.der.optionpacks=h.length>0?h.join(","):undefined;_da.der.features=g.length>0?
g.join(","):undefined;_da.der.options=e.length>0?e.join(","):undefined;if(a.path===Constants.path.pkg){c=a.storage.get(Constants.storage.packageCollection).getSelected();_da.der.name=c.get("name")+c.get("engineTransmission");_da.der.engine=c.get("engineId")}else if(a.path===Constants.path.drv){c=a.storage.get(Constants.storage.derivativeCollection).getSelected();var i=c.get("engines").getSelected();_da.der.name=c.get("name")+i.get("name");_da.der.engine=i.get("id")}if(ConfigUtil.usePolkPricing(a.path)){c=
a.userPref.get("unformattedPolkPrice");this.validateAndSetPrice(c)}else if(ConfigUtil.showPrices()){c=a.userPref.total();this.validateAndSetPrice(c)}break;default:}a.stepName=b;a.events=d;this.setupOmnitureVars(a);ND.analyticsTag.trackOmnitureSinglePageApp()},constructTabPagename:function(a){var b=a.storage.get(Constants.storage.categoryGrpCollection).getSelected(),d=null,c=null,e=b.get("categories");if(typeof e!=="undefined"&&e!=null&&e.length>0){b=e.getSelected()==null?e.at(0):e.getSelected();d=
b.get("analyticsName");c=b.get("analyticsStep")}else if(b.id===1){d=b.get("analyticsName");c=b.get("analyticsStep")}if(d!=null&&c!=null){this.setPath(a);a.state="3";a.isColorTrimTab=d===Constants.analytics.colorTrim;a.stepName=c+a.path+d;a.stepNameNoAnalyticsStep=a.path+d}},setPath:function(a){var b=Constants.path.pkg,d=a.storage.get(Constants.storage.pathCollection);ConfigUtil.isShortPath()||(b=d.getSelected().get("key"));if(b===Constants.path.pkg)b=":package:";else if(b===Constants.path.drv)b=":full:";
a.path=b}});

var Helper={getUsageLabelFromLabel:function(a){switch(a){case "p":return"Personal";case "b":return"Commercial"}return""},hasPreExistingLocalStorageData:function(){for(storageName in localStorageNames)if((new LocalStorage(localStorageNames[storageName])).isEmpty())return false;return true},buildURL:function(a,b,c,d,e){a=a.replace(":pricezoneId",b).replace(":id",c).replace(":path",d);if(ConfigUtil.showPostcodeSelect()&&(e||0)){b=e.get("postcode");if(b!==undefined&&b!=null&&b!="")a+="?postcode="+b+"&usage="+
e.get("usage")}return a},buildNameplateCategoriesFromNameplates:function(a,b){categories=_.uniq(a.pluck("category"));var c=0;_.each(categories,function(d){var e=new models.NameplateCategory({name:d,order:c}),g=new collections.NameplateCollection;_.each(a.models,function(f){f.set("displayPrice",ND.PriceFormatter.format(f.get("price")));if(d==f.get("category")){Helper.buildDecisionPageUrl(f);g.add(f)}});e.set("nameplates",g);b.add(e);c++});b.add(new models.NameplateCategory({name:Constants.bpt.av,order:c,
nameplates:a,selected:true}))},buildDecisionPageUrls:function(a){_.each(a.models,function(b){Helper.buildDecisionPageUrl(b);b.set("displayPrice",ND.PriceFormatter.format(b.get("price")))})},buildDecisionPageUrl:function(a){a.set("nameplateURL",a.get("id")+"/"+Constants.path.nxt)},constructStepUrl:function(a){var b="";switch(a.step){case Constants.state.SELECT_PATH:b="#"+a.modelId+"/path";break;case Constants.state.SELECT_PACKAGE:case Constants.state.SELECT_DERIVATIVE:b="#"+a.modelId+"/"+a.path;break;
case Constants.state.CUSTOMIZE_DERIVATIVE:b="#"+a.modelId+"/customize/"+a.path+"/"+a.derivativeId;break;case Constants.state.SUMMARY:b="#"+a.modelId+"/summary/"+a.path+"/"+a.derivativeId;break}return b},initialisePriceFormatter:function(a){ND.PriceFormatter.initialise({data:a.get("priceFormat"),formatString:a.get("currencySymbol"),centsSeparator:a.get("monetaryDecimalSeparator"),thousandsSeparator:a.get("groupingSeparator")})},processPricezone:function(a){var b=Util.cookie.load(Constants.cookie.pzid);
b=a.get(b?b:this.userPref.get("priceZoneId"));if(!b)b=(b=a.where({"default":"true"}))&&b.length>0?b[0]:a.at(0);a.select(b);Helper.initialisePriceFormatter(b);this.storage.set(Constants.storage.pricezoneCollection,a);this.updatePricezoneForUserObject(b)},postProcessDerivatives:function(a){showPostcode=ConfigUtil.showPostcodeSelect();var b=this.getPricezoneId();_.each(a.models,function(c){c.set("displayPrice",showPostcode?null:ND.PriceFormatter.format(c.get("price")));c.set("priceZoneId",b)})},postProcessPackages:function(a){var b=
this.getPricezoneId();_.each(a.models,function(c){c.set("displayPrice",ND.PriceFormatter.format(c.get("price")));c.set("priceZoneId",b)})},postProcessColorTrims:function(a){var b=Constants.bpt.mlp+" ";_.each(a.models,function(c){var d=c.get("price");c.set("displayPrice",d!=0?b+ND.PriceFormatter.format(d):Constants.bpt.noCostOption);if(c=c.get("trims")){var e;_.each(c.models,function(g){e=g.get("price");g.set("displayPrice",e!=0?b+ND.PriceFormatter.format(e):Constants.bpt.noCostOption)})}})},postProcessHotDeals:function(a,
b){_.each(a.models,function(c){var d=c.get("derivativeId");b.get(d)!=null&&b.get(d).set("hotDealUrl",c.get("hotDealUrl"));c.set("displayPrice",ND.PriceFormatter.format(c.get("offerprice")))},this)},postProcessEngines:function(a){var b=_.min(a.pluck("price"),function(c){return parseFloat(c)});_.each(a.models,function(c){c.get("featuretype")===Constants.values.standard&&a.select(c);var d=c.get("price")-b,e=d===0?Constants.bpt.noCostOption:ND.PriceFormatter.format(d.toString());c.set("displayPrice",
e);c.set("priceDiff",d)})},postProcessCategoryGroups:function(a,b,c,d,e){var g=2;_.each(a.models,function(f){f=f.get(Constants.attr.catgs);f!=null&&_.each(f.models,function(i){b=new models.SummaryCategory({category:i.get("name")});c=new collections.SummaryFeatureCollection;i=i.get(Constants.attr.feats);var k=false,j,h,m,n=0;i!=null&&_.each(i.models,function(l){if(_.contains(e,l.get("id"))){k=true;j=parseFloat(l.get("price"));n+=j;h=l.get("isOptionPack")===true;c.add(new models.SummaryFeature({name:l.get("name"),
nameSuffix:h?Constants.priceSuffix.featureMLP:Constants.priceSuffix.featureRRP,price:ND.PriceFormatter.format(j.toString()),pricePrefix:h?Constants.bpt.mlp:"",priceSuffix:h?Constants.priceSuffix.featureMLP:""}));if(h){m=l.get("featureGroupAttributes");m!=null&&m.length>0&&_.each(m.models,function(o){c.add(new models.SummaryFeature({name:o.get("featureName"),isChild:true}))})}}});if(k){b.set(Constants.attr.feats,c);b.set("categoryTotal",ND.PriceFormatter.format(n.toString()));b.set("order",g);d.add(b);
g++}})})},constructHeader:function(a,b){var c=Helper.getNameplateName.call(this,a),d=new collections.HeaderCollection,e=[Constants.state.NO_STATE,Constants.state.SELECT_PATH,Constants.state.SELECT_PACKAGE,Constants.state.CUSTOMIZE_DERIVATIVE,Constants.state.SUMMARY,Constants.state.NO_STATE],g=b&&b!=null&&b===Constants.path.pkg?Constants.header.sp:Constants.header.sm,f=[c,Constants.header.spa,g,Constants.header.sc,Constants.header.ss,Constants.header.sl],i=[Constants.bpt.ssm,Constants.bpt.s1,Constants.bpt.s2,
Constants.bpt.s3,Constants.bpt.s4,Constants.bpt.pc],k=[true,false,false,false,false,false];if(ConfigUtil.isShortPath()){f=[c,Constants.header.sp,Constants.header.sc,Constants.header.ss,Constants.header.sl];i=[Constants.bpt.ssm,Constants.bpt.s1,Constants.bpt.s2,Constants.bpt.s3,Constants.bpt.pc];k=[true,false,false,false,false];e=[Constants.state.NO_STATE,Constants.state.SELECT_PACKAGE,Constants.state.CUSTOMIZE_DERIVATIVE,Constants.state.SUMMARY,Constants.state.NO_STATE]}else if(!Helper.showPathStep()){f=
[c,g,Constants.header.sc,Constants.header.ss,Constants.header.sl];i=[Constants.bpt.ssm,Constants.bpt.s1,Constants.bpt.s2,Constants.bpt.s3,Constants.bpt.pc];k=[true,false,false,false,false];e=[Constants.state.NO_STATE,Constants.state.SELECT_PACKAGE,Constants.state.CUSTOMIZE_DERIVATIVE,Constants.state.SUMMARY,Constants.state.NO_STATE]}g=c="";if(ConfigUtil.showPostcodeSelect()){c=this.userPref.get("postcode");g=this.userPref.get("usageLabel")}else if(ConfigUtil.showPricezones()){c=this.storage.get(Constants.storage.pricezoneCollection).getSelected().get("name");
g=""}var j=Constants.postcode.non;if(ConfigUtil.showPostcodeSelect())j=Constants.postcode.hd;else if(ConfigUtil.showPricezones())j=Constants.postcode.ot;for(var h=0;h<f.length;h++)d.add(new models.HeaderModel({order:h,heading:f[h],step:i[h],state:e[h],headerURL:Helper.constructStepUrl.call(this,{step:e[h],path:b,modelId:a}),showPricezoneSelect:j,postcode:h===f.length-1?c:"",usageLabel:h===f.length-1?g:"",enabled:k[h]}));return d},postProcessVehicleOptionsCollection:function(a,b,c){a.add(new models.CategoryGroupModel({id:1,
name:Constants.bpt.ct,categoryGrouping:Constants.bpt.ct,order:0,analyticsName:Constants.analytics.colorTrim,analyticsStep:"a"}));var d=0;_.each(a.models,function(e){e.set("derivativeId",c);e.set("order",d);e=e.get("categories");e!=null&&_.each(e.models,function(g){if(g!=null){g=g.get("features");g!=null&&_.each(g.models,function(f){f.set("derivativeId",c);f.set("displayPrice",ND.PriceFormatter.format(f.get("price")));f.set("pricezoneId",b)})}});d++})},getNameplateName:function(a){var b=this.storage.get(Constants.storage.nameplateCollection),
c=b.getSelected(),d="";if(c&&c!=null)d=c.get("name");else if(a&&a!=null){c=b.selectById(a);d=c.get("name")}return d},getCurrentCarView:function(a){return a.get(Constants.storage.derivativeDetailsModel).get("view")},showPathStep:function(){return Config.site.toLowerCase()!=="fnz"}};

(function(z,C,m,q,s,u,A){var D=Backbone.Router.extend({storage:null,user:null,price:null,routes:{":modelId/customize/:path/:derivativeId":"navToCustomizeDerivativePage",":modelId/summary/:path/:derivativeId":"navToSummaryPage","load/:uuid":"loadConfigAndNavToSummaryPage",":modelId/next":"navToDecisionPage",error:"navToErrorPage",reset:"navToResetPage"},initialize:function(){this.configureRoutes();this.storage=new q.Storage;this.userPref=new q.UserPref({featuresObject:new s.FeatureCollection});this.registerEventListeners();
this.viewManager=m.ViewManager();this.viewManager.initialise();this.setupOnError();if(!ConfigUtil.showPrices()){Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,true);Events.fireEvent(Events.eventList.buildandprice.router.HideHotDealPricesEvent)}},setupOnError:function(){var a=this;z.onerror=function(){a.navigate("",{trigger:true});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)}},configureRoutes:function(){this.route("","navToNameplatesPage");if(ConfigUtil.isShortPath()){this.route(":modelId/"+
Constants.path.pkg,"navToPackagesPage");this.route(":modelId/"+Constants.path.pkg+"/select/:pkgId","navToSelectPackagePage")}else{this.route(":modelId/"+Constants.path.pth,"navToPathsPage");this.route(":modelId/"+Constants.path.pkg,"navToPackagesPage");this.route(":modelId/"+Constants.path.drv,"navToDerivativesPage");this.route(":modelId/"+Constants.path.drv+"/select/:drvId","navToSelectDrivativePage")}},registerEventListeners:function(){Events.eventBus.context=this;if(ConfigUtil.showPricezones()){Events.bind(Events.eventList.buildandprice.model.PricezoneSelectedEvent.name,
Events.eventList.buildandprice.model.PricezoneSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.PricezoneChangeRequestEvent.name,Events.eventList.buildandprice.model.PricezoneChangeRequestEvent.handler,this)}Events.bind(Events.eventList.buildandprice.model.StartOverEvent.name,Events.eventList.buildandprice.model.StartOverEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.ToggleViewEvent.name,Events.eventList.buildandprice.model.ToggleViewEvent.handler,
this);Events.bind(Events.eventList.buildandprice.model.TabChangedEvent.name,Events.eventList.buildandprice.model.TabChangedEvent.handler,this);Events.bind(Events.eventList.buildandprice.view.SubTabChangedEvent,Events.eventList.buildandprice.model.SubTabChangedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.PathSelectedEvent.name,Events.eventList.buildandprice.model.PathSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.TabChangeRequestEvent.name,Events.eventList.buildandprice.model.TabChangeRequestEvent.handler,
this);Events.bind(Events.eventList.buildandprice.model.StepChangeRequestEvent.name,Events.eventList.buildandprice.model.StepChangeRequestEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.StepChangeHeaderRequestEvent.name,Events.eventList.buildandprice.model.StepChangeHeaderRequestEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.SaveAsPDFEvent.name,Events.eventList.buildandprice.model.SaveAsPDFEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.ShareConfigEvent.name,
Events.eventList.buildandprice.model.ShareConfigEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.PackageSelectedEvent.name,Events.eventList.buildandprice.model.PackageSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.DerivativeSelectedEvent.name,Events.eventList.buildandprice.model.DerivativeSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.ModelSelectedEvent.name,Events.eventList.buildandprice.model.ModelSelectedEvent.handler,
this);Events.bind(Events.eventList.buildandprice.model.FeatureSelectedEvent.name,Events.eventList.buildandprice.model.FeatureSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.TrimSelectedEvent.name,Events.eventList.buildandprice.model.TrimSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.ColorChangedEvent.name,Events.eventList.buildandprice.model.ColorChangedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.EngineTrasmissionSelectedEvent.name,
Events.eventList.buildandprice.model.EngineTrasmissionSelectedEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.RequestAQuoteEvent.name,Events.eventList.buildandprice.model.RequestAQuoteEvent.handler,this);Events.eventList.buildandprice.model.PresentPaymentEvent.name&&Events.bind(Events.eventList.buildandprice.model.PresentPaymentEvent.name,Events.eventList.buildandprice.model.PresentPaymentEvent.handler,this);Events.bind(Events.eventList.buildandprice.view.ShareLinkClickedEvent,
Events.eventList.buildandprice.model.ShareLinkClickedEvent.handler,this);Events.bind(Events.eventList.buildandprice.view.ViewAccessoryDetailsEvent,Events.eventList.buildandprice.model.ViewAccessoryDetailsEvent.handler,this);ConfigUtil.showPostcodeSelect()&&Events.bind(Events.eventList.buildandprice.view.RegionPostcodeChangeRequestEvent,Events.eventList.buildandprice.model.RegionPostcodeChangeRequestEvent.handler,this);Events.bind(Events.eventList.buildandprice.model.OrientationChangedEvent.name,Events.eventList.buildandprice.model.OrientationChangedEvent.handler,
this)},navToGenericErrorPage:function(){this.navigate("#error",{trigger:true});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)},navToResetPage:function(){this.navigate("",{trigger:true,replace:true})},navToNameplatesPage:function(){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var a=this;this.fetchPricezonesAndNameplates(function(b){var c;if(b&&b.length>0){if(ConfigUtil.showNameplateSegments()){var d=new s.NameplateCategoryCollection;Helper.buildNameplateCategoriesFromNameplates(b,
d);c=m.NameplateCagetoryListView;b=d}else{Helper.buildDecisionPageUrls(b);c=m.NameplateListView}this.viewManager.displayParentView(c,b);if(ConfigUtil.showPostcodeSelect())a.viewManager.displayChildView(m.FOANameplateHeaderListView,new q.HeaderModel({headerURL:"#",state:Constants.state.NO_STATE,postcode:this.userPref.get("postcode"),usageLabel:this.userPref.get("usageLabel"),enabled:true}));else if(ConfigUtil.showPricezones()){b=a.storage.get(Constants.storage.pricezoneCollection).getSelected();a.viewManager.displayChildView(m.NameplateHeaderListView,
new q.HeaderModel({headerURL:"#",state:Constants.state.NO_STATE,postcode:b?b.get("name"):"",usageLabel:"",enabled:true}))}}ConfigUtil.showPostcodeSelect()&&this.removeHotDealsView();Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,{state:Constants.state.SELECT_NAMEPLATE,storage:a.storage});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)})},navToDecisionPage:function(a){a="#"+a+"/";a+=ConfigUtil.isShortPath()?Constants.path.pkg:Helper.showPathStep()?
Constants.path.pth:Constants.path.drv;this.navigate(a,{trigger:true,replace:true})},navToPathsPage:function(a){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var b=this;this.fetchPricezonesNameplatesAndPaths(function(c){b.viewManager.displayParentView(m.SelectPathListView,c);b.viewManager.displayTitleView(new q.PageTitleModel({title:Constants.bpt.chp}));b.displayHeadersView(a);b.updateHeader(Constants.state.SELECT_PATH,Helper.constructStepUrl.call(b,{step:Constants.state.SELECT_PATH,
modelId:a}));Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,{state:Constants.state.SELECT_PATH,storage:b.storage});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent);ConfigUtil.showPostcodeSelect()&&b.removeHotDealsView()},a)},navToDerivativesPage:function(a,b){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var c=this;this.fetchPricezonesNameplatesAndPaths(function(){var d=new s.DerivativeModelCollection;d.url=Helper.buildURL(d.urlRoot,
c.getPricezoneId(),a,Constants.path.drv,c.userPref);c.fetchModel(Constants.storage.derivativeCollection,d,function(e){if(e!==A&&e.length>0){Helper.postProcessDerivatives.call(c,e);c.viewManager.displayParentView(m.SelectDerivativeListView,e);c.viewManager.displayTitleView(new q.PageTitleModel({title:Constants.bpt.chm,showLatestOffersBtn:ConfigUtil.showPostcodeSelect()}));c.displayHeadersView(a,Constants.path.drv);c.updateHeader(Constants.state.SELECT_DERIVATIVE,Helper.constructStepUrl.call(c,{step:Constants.state.SELECT_DERIVATIVE,
path:Constants.path.drv,modelId:a}),Constants.header.sm);c.displayFooterView({path:Constants.path.drv,modelId:a,step:Constants.state.SELECT_DERIVATIVE});c.updateFooter(Constants.state.SELECT_ENGINE);c.selectDerivative(e,b);ConfigUtil.showPostcodeSelect()&&c.displayHotDealsView(a)}else c.displayNoContentView(a,Constants.path.drv);Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,{state:Constants.state.SELECT_DERIVATIVE,path:Constants.path.drv,storage:c.storage});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)})},
a,Constants.path.drv)},navToSelectDrivativePage:function(a,b){this.navToDerivativesPage(a,b)},selectDerivative:function(a,b){if(b&&b!=null){a=a.get(b);Events.fireEvent(Events.eventList.buildandprice.model.DerivativeSelectedEvent.name,a)}},navToPackagesPage:function(a,b){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var c=this;this.fetchPricezonesNameplatesAndPaths(function(){var d=new s.PackageModelCollection;d.url=Helper.buildURL(d.urlRoot,c.getPricezoneId(),a,Constants.path.pkg);
c.fetchModel(Constants.storage.packageCollection,d,function(e){if(e!==A&&e.length>0){Helper.postProcessPackages.call(c,e);c.viewManager.displayParentView(m.SelectPackageListView,e);c.viewManager.displayTitleView(new q.PageTitleModel({title:Constants.bpt.cp}));c.displayHeadersView(a,Constants.path.pkg);c.updateHeader(Constants.state.SELECT_PACKAGE,Helper.constructStepUrl.call(c,{step:Constants.state.SELECT_PACKAGE,path:Constants.path.pkg,modelId:a}),ConfigUtil.isShortPath()?A:Constants.header.sp);
c.displayFooterView({path:Constants.path.pkg,modelId:a,step:Constants.state.SELECT_PACKAGE});c.selectPackage(e,b);c.updateFooter(Constants.state.SELECT_PACKAGE)}else c.displayNoContentView(a,Constants.path.pkg);Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,{state:Constants.state.SELECT_PACKAGE,path:Constants.path.pkg,storage:c.storage});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent);ConfigUtil.showPostcodeSelect()&&c.removeHotDealsView()})},a,Constants.path.pkg)},
navToSelectPackagePage:function(a,b){this.navToPackagesPage(a,b)},selectPackage:function(a,b){if(b&&b!=null){a=a.get(b);Events.fireEvent(Events.eventList.buildandprice.model.PackageSelectedEvent.name,a)}},navToCustomizeDerivativePage:function(a,b,c){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var d=this;this.postProcessDerivativeDetails(a,b,c,function(){d.clearStorageForStep.call(d,Constants.state.CUSTOMIZE_DERIVATIVE)},function(){d.displayDerivativeDetailView(a,b,c);Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,
{state:Constants.state.CUSTOMIZE_DERIVATIVE,path:b,storage:d.storage});Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)})},navToSummaryPage:function(a,b,c,d,e){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);d=typeof d!=="undefined"?d:false;e=typeof e!=="undefined"?e:false;var h=this.storage.get(Constants.storage.footerModel);if(typeof h==="undefined"||h==null)h=this.createFooter({path:b,derivativeId:c,step:Constants.state.SUMMARY});if(ConfigUtil.usePolkPricing(b)){var f=
this.userPref.get("tempPostcode"),g=this.userPref.get("tempUsage"),i=this.userPref.get("postcode"),o=this.userPref.get("usage");if(f!=i||g!=o){var l=Constants.bpt.postcodeMisMatch;l=typeof f==="undefined"||f==null||typeof g==="undefined"||g==null||f===""||g===""?l.replace(/%1/g,Constants.bpt.regionNotSpecified).replace(/%2/g,""):l.replace(/%1/g,f).replace(/%2/g,Helper.getUsageLabelFromLabel(g));l=typeof i==="undefined"||typeof o==="undefined"||i==null||o==null||i===""?l.replace(/%3/g,Constants.bpt.yourRegionNotSpecified).replace(/%4/g,
""):l.replace(/%3/g,i).replace(/%4/g,Helper.getUsageLabelFromLabel(o));h.set("postcodeHint",l)}typeof f==="undefined"&&h.set("postcodeHint",null);i=this.userPref.toJSON();f=typeof f!=="undefined"?f:null;g=typeof g!=="undefined"?g:null;i={postcode:i.postcode,usage:i.usage,options:this.userPref.totalOptionsForPOLK(),engineid:i.engineId,derivatives:new Array(i.derivativeId)};if(f!=null&&g!=null){i.postcode=f;i.usage=g}this.userPref.unset("tempPostcode");this.userPref.unset("tempUsage");var k=this;if(i.postcode!=
null&&i.postcode!==""&&i.usage!=null&&i.usage!=="")u.ajax({dataType:"json",url:Config.buildandprice.urls.driveawayURL+"&data="+JSON.stringify(i),success:function(n){if(n.error===false){if(n.derivatives&&n.derivatives.length>0){n=k.userPref.totalWithPOLK(n.derivatives[0].price);k.userPref.set("unformattedPolkPrice",n);k.userPref.set("polkPrice",ND.PriceFormatter.format(n.toString()));h.set("hasError",false)}}else{h.set("hasError",true);k.userPref.set("unformattedPolkPrice",null);k.userPref.set("polkPrice",
n.errorMessage)}k.displaySummaryView(a,b,c,h,d,e)},error:function(){h.set("hasError",true);k.userPref.set("polkPrice",Constants.bpt.errorCalcPrice);k.userPref.set("unformattedPolkPrice",null);k.displaySummaryView(a,b,c,h,d,e)}});else{h.set("hasError",true);k.userPref.set("polkPrice",Constants.bpt.selectRegionToViewPrices);k.userPref.set("unformattedPolkPrice",null);this.displaySummaryView(a,b,c,h,d,e)}}else this.displaySummaryView(a,b,c,h,d,e)},navToErrorPage:function(){this.viewManager.displayParentView(m.ErrorView,
new q.ErrorModel);this.viewManager.displayTitleView(new q.PageTitleModel({title:Constants.bpt.et}));ConfigUtil.showPostcodeSelect()&&this.removeHotDealsView()},loadConfigAndNavToSummaryPage:function(a){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);var b=this;this.userPref.url=this.userPref.urlRoot+a;var c=false,d=false;u.when(b.userPref.fetch()).done(function(){b.fetchPricezones(function(e){var h=e.get(b.userPref.get("priceZoneId"));if(typeof h==="undefined"||h==null)h=(h=e.where({"default":"true"}))&&
h.length>0?h[0]:e.at(0);e.select(h);Helper.initialisePriceFormatter(h);b.storage.set(Constants.storage.pricezoneCollection,e);b.updatePricezoneForUserObject(h);var f=h.get("id");Events.fireEvent(Events.eventList.buildandprice.router.UpdatePricezoneEvent,h.get("name"));e=b.userPref.get("derivativeId");ConfigUtil.showPostcodeSelect()&&typeof e!=="undefined"&&e!=null&&ND.API.requestCookieValuesBuildAndPrice({complete:function(g){var i=b.userPref.get("postcode"),o=b.userPref.get("usage");if(typeof g!==
"undefined"&&g!=null&&g.postcode){b.userPref.set({tempPostcode:i,tempUsage:o,postcode:g.postcode,usage:g.usage,usageLabel:g.usageLabel});d=true}else{b.userPref.set({tempPostcode:i,tempUsage:o,postcode:"",usage:""});c=true}typeof i==="undefined"||i==null||i===""?Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,true):Events.fireEvent(Events.eventList.buildandprice.model.RegionPostcodeLoadedFromConfigEvent,{postcode:i})}});e=new s.NameplateCollection;e.url=Helper.buildURL(e.urlRoot,
b.getPricezoneId(),null,null,b.userPref);b.fetchModel(Constants.storage.nameplateCollection,e,function(g){var i=b.userPref.get("modelId"),o=g.get(i);if(typeof o!=="undefined"&&o!=null){g.select(o);var l=null,k=Constants.path.pkg;if(ConfigUtil.isShortPath()||typeof b.userPref.get("packageId")!=="undefined"){b.createPaths(k,o,i);g=new s.PackageModelCollection;g.url=Helper.buildURL(g.urlRoot,f,i,k);b.fetchModel(Constants.storage.packageCollection,g,function(n){l=b.userPref.get("packageId");n=n.selectById(l);
if(typeof n!=="undefined"&&n!=null){b.updateUserPrice("package",n);b.loadDerivativeDetails(f,i,k,l,c,d)}else b.navToGenericErrorPage()})}else{k=Constants.path.drv;b.createPaths(k,o,i);g=new s.DerivativeModelCollection;g.url=Helper.buildURL(g.urlRoot,f,i,k,b.userPref);b.fetchModel(Constants.storage.derivativeCollection,g,function(n){l=b.userPref.get("derivativeId");var w=n.selectById(l);if(typeof w!=="undefined"&&w!=null){b.updateUserPrice("derivative",w);var j=new s.EngineTransmissionCollection;j.url=
Helper.buildURL(j.urlRoot,f,l,"",b.userPref);u.when(j.fetch()).then(function(){Helper.postProcessEngines(j);var t=j.selectById(b.userPref.get("engineId"));if(typeof t!=="undefined"&&t!=null){w.set("engines",j);b.updateUserPrice("engine",t);b.loadDerivativeDetails(f,i,k,l,c,d)}else b.navToGenericErrorPage()})}else b.navToGenericErrorPage()})}}else b.navToGenericErrorPage()})})}).fail(u.proxy(b.navToGenericErrorPage,b))},postProcessDerivativeDetails:function(a,b,c,d,e){var h=this.storage.get(Constants.storage.derivativeDetailsModel),
f=this.storage.get(Constants.storage.galleryCollection),g=this.storage.get(Constants.storage.categoryGrpCollection),i=this.storage.get(Constants.storage.colorCollection);typeof this.storage.get(Constants.storage.footerModel)==="undefined"&&this.createFooter({path:b,derivativeId:c,step:Constants.state.CUSTOMIZE_DERIVATIVE});if(h!=null&&f!=null&&g!=null&&i!=null&&c==h.get("id"))typeof e!=="undefined"&&e.call(l);else{var o=this.getPricezoneId();h=new q.DerivativeDetailModel({id:c});h.url=Helper.buildURL(h.urlRoot,
o,c,b);i=new s.ColorCollection;i.url=Helper.buildURL(i.urlRoot,o,c,b);g=new s.CategoryGroupCollection;g.url=Helper.buildURL(g.urlRoot,o,c,b);f=new s.GalleryCollection;typeof d!=="undefined"&&d.call(l);var l=this;u.when(g.fetch(),this.deferredFetchAndPersist(Constants.storage.derivativeDetailsModel,h),this.deferredFetchAndPersist(Constants.storage.colorCollection,i)).then(function(){Helper.postProcessColorTrims(i);f.addBaseSprites(i,"color");_.each(g.models,function(k){var n=k.get(Constants.attr.catgs),
w=false;n!=null&&_.each(n.models,function(j){var t=j.get(Constants.attr.feats);if(t&&t!=null){if((j=t.where({groupType:Constants.values.mutuallyExclusiveOptions}))&&j!=null){t.remove(j);_.each(j,function(p){p=p.get("featureGroupAttributes");if(p!=null&&p.length>0){var x=p.pluck("id");_.each(x,function(r){var y=t.get(r);if(y!=null){var v=new s.FeatureGroupAttributeCollection;r=_.without(x,r);_.each(r,function(B){v.add(new q.FeatureGroupAttribute({id:B}))});y.set({featureGroupAttributes:v,isMutuallyExclusive:true})}})}})}f.addAccessorySprites(t,
"feature");(j=t.where({groupType:Constants.values.optionPack}))&&j!=null&&_.each(j,function(p){p.set({featureDetailUrl:"#",isOptionPack:true});p=p.get("featureGroupAttributes");if(p!=null&&p.length>0)w=true});(j=t.reject(function(p){return p.get("dependentFeaturesIds")==null}))&&j!=null&&_.each(j,function(p){p.get("isMutuallyExclusive")&&alert("Unsupported publishing setup!! A mutually exclusive feature cannot have dependent features");p.set("hasDependentFeatures",true);p.set("dependentFeaturesIds",
p.get("dependentFeaturesIds").split(","))})}});w&&k.set("containsFeatureGroup",w)});l.getSelectedPackageDerivative(l.storage,{pkgCallback:function(k){l.updateUserPrice("engine",new q.EngineTransmission({id:h.get("engineId")}));k.set("engineId",h.get("engineId"),{silent:true})}});Helper.postProcessVehicleOptionsCollection(g,o,c);l.storage.set(Constants.storage.categoryGrpCollection,g);l.storage.set(Constants.storage.galleryCollection,f);typeof e!=="undefined"&&e.call(l)})}},loadDerivativeDetails:function(a,
b,c,d,e,h){var f=this;this.postProcessDerivativeDetails(b,c,d,A,function(){var g=f.userPref.get("colourId"),i=f.storage.get(Constants.storage.colorCollection);g=i.get(g);if(typeof g!=="undefined"&&g!=null){i.select(g);f.updateUserPrice("colour",g);i=f.userPref.get("trimId");if((g=g.get("trims"))&&g.length>0){if((i=g.get(i))&&i!=null){g.select(i);f.updateUserPrice("trim",i);i=f.userPref.get(Constants.attr.feats);if(typeof i!=="undefined"&&i!=null&&i.length>0){i=f.storage.get(Constants.storage.categoryGrpCollection).fetchFeatures(i);
_.each(i,function(o){f.toggleFeaturesByType(o)})}ConfigUtil.showPostcodeSelect()&&f.displayHotDealsView(b);f.navToSummaryPage(b,c,d,e,h);f.navigate(Helper.constructStepUrl.call(f,{step:Constants.state.SUMMARY,modelId:b,path:c,derivativeId:d}),{replace:true,trigger:false})}}else f.navToGenericErrorPage()}else f.navToGenericErrorPage()})},displayNoContentView:function(a,b){this.viewManager.displayParentView(m.NoVehiclesView,new q.ErrorModel({title:Constants.bpt.sv,message:Constants.bpt.cl,showPricezone:ConfigUtil.showPricezones()}));
this.displayHeadersView(a,b);this.updateHeader(Constants.state.SELECT_PACKAGE,Helper.constructStepUrl.call(self,{step:Constants.state.SELECT_PACKAGE,path:b,modelId:a}))},displayHeadersView:function(a,b){var c=this.storage.get(Constants.storage.headerCollection);if(!c&&c==null){c=Helper.constructHeader.call(this,a,b);this.storage.set(Constants.storage.headerCollection,c)}ConfigUtil.isShortPath()?this.viewManager.displayChildView(m.ShortPathHeaderListView,c):this.viewManager.displayChildView(m.HeaderListView,
c)},toggleFeaturesByType:function(a){if(a.get("isOptionPack"))this.toggleOptionPackSelection(a,false);else if(a.get("isMutuallyExclusive"))this.toggleMutuallyExclusiveFeatureSelection(a,false);else a.get("hasDependentFeatures")?this.toggleDependentFeatureSelection(a,false):this.toggleFeatureSelection(a)},updateHeader:function(a,b,c){var d=this.storage.get(Constants.storage.headerCollection),e=true,h=Helper.getNameplateName.call(this);_.each(d.models,function(f){var g=f.get("state");if(e===true&&0===
f.get("order")&&h!==f.get("heading")){f.set("heading",h);e=false}isCurrentState=g==a;f.set("enabled",g<=a||f.get("visited"));f.set("isCurrent",isCurrentState);if(isCurrentState){f.set("visited",true);f.set("headerURL",b);c!==A&&f.set("heading",c)}})},unvisitHeaders:function(a){var b=this.storage.get(Constants.storage.headerCollection);_.each(b.models,function(c){c.set({visited:c.get("state")<=a,enabled:c.get("state")<=a})})},createFooter:function(a){var b=this.storage.get(Constants.storage.footerModel);
if(!b){b=new q.FooterModel;a.step+=1;b.setNextButton(Helper.constructStepUrl.call(this,a),Constants.header.c);a.step-=2;b.setPrevButton(Helper.constructStepUrl.call(this,a),Constants.header.p);this.storage.set(Constants.storage.footerModel,b)}return b},displayFooterView:function(a){var b=this.createFooter(a);this.viewManager.displayChildView(m.FooterView,b);if(!ConfigUtil.isShortPath()&&a.step>=Constants.state.SELECT_PACKAGE||ConfigUtil.isShortPath()&&a.step>Constants.state.SELECT_PACKAGE)this.viewManager.displayChildView(m.BackButtonView,
b)},displayHotDealsView:function(a){var b=this.storage.get(Constants.storage.hotdealCollection);if(typeof b==="undefined"||b==null||b.url.indexOf(a)<0){b=new s.HotDealCollection;b.url=b.urlRoot+"/"+Config.site+"/"+a;a=this.userPref.get("postcode");if(a!="")b.url+="/"+a;var c=this;u.when(c.deferredFetchAndPersist(Constants.storage.hotdealCollection,b)).then(function(){Helper.postProcessHotDeals(b,c.storage.get(Constants.storage.derivativeCollection));c.buildHotDealContainer(b)})}else this.buildHotDealContainer(b)},
buildHotDealContainer:function(a){var b=_.uniq(a.pluck("nameplatename"));b=Constants.bpt.latestOffersInstructions.replace("%1",b.sort().join(", "));a=new q.HotDealContainer({latestOffersInstructions:b,hotdeals:a});this.viewManager.displayIndependantView("HotDealsView",m.HotDealsView,a)},displaySummaryView:function(a,b,c,d,e,h){d.set("id",c);d.set("priceZoneId",this.getPricezoneId());d.set("isPackage",b===Constants.path.pkg);var f=this.storage.get(Constants.storage.colorCollection).getSelected();d.set("vehicleThumbnailUrl",
f.get("thumbnailUrl"));d.set("unformattedPolkPrice",this.userPref.get("unformattedPolkPrice"));d.set("locationValue",this.userPref.get("postcode")+" "+this.userPref.get("usageLabel"));var g=this.storage.get(Constants.storage.nameplateCollection).getSelected().get("id");this.viewManager.displayParentView(m.SummaryView,d);this.displayHeadersView(g,b);this.updateHeader(Constants.state.CUSTOMIZE_DERIVATIVE,Helper.constructStepUrl.call(this,{step:Constants.state.CUSTOMIZE_DERIVATIVE,modelId:a,path:b,derivativeId:c}));
this.updateHeader(Constants.state.SUMMARY,Helper.constructStepUrl.call(this,{step:Constants.state.SUMMARY,modelId:a,path:b,derivativeId:c}));this.viewManager.displayTitleView(new q.PageTitleModel({title:null,showLatestOffersBtn:ConfigUtil.showPostcodeSelect()&&b!==Constants.path.pkg}));this.viewManager.displayChildView(m.BackButtonView,d);this.updateFooter(Constants.state.SUMMARY);a=new s.SummaryCategoryCollection;c=this.storage.get(Constants.storage.categoryGrpCollection);d=f.get("trims").getSelected();
g=parseFloat(f.get("price"))+parseFloat(d.get("price"));g=new q.SummaryCategory({category:Constants.bpt.ct,categoryTotal:ND.PriceFormatter.format(g.toString()),order:1});var i=new s.SummaryFeatureCollection;i.add(new q.SummaryFeature({name:f.get("name"),price:ND.PriceFormatter.format(f.get("price")),nameSuffix:Constants.priceSuffix.colour}));i.add(new q.SummaryFeature({name:d.get("name"),price:ND.PriceFormatter.format(d.get("price"))}));g.set(Constants.attr.feats,i);a.add(g);Helper.postProcessCategoryGroups(c,
g,i,a,this.userPref.get(Constants.attr.feats));this.viewManager.displayChildView(m.PriceCategoryBreakdownListView,a);Events.fireEvent(Events.eventList.buildandprice.omniture.StateChangedEvent,{state:Constants.state.SUMMARY,path:b,storage:this.storage,userPref:this.userPref});e&&ConfigUtil.showPostcodeSelect()&&Events.fireEvent(Events.eventList.buildandprice.router.AskForPostcodeEvent,true);h&&ConfigUtil.showPrices()&&Events.fireEvent(Events.eventList.buildandprice.router.ShowPricesLaterEvent);Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)},
removeHotDealsView:function(){this.viewManager.removeIndependantView("HotDealsView")},fetchPricezonesAndNameplates:function(a,b){var c=this;ConfigUtil.showPostcodeSelect()?ND.API.requestCookieValuesBuildAndPrice({complete:function(d){typeof d==="undefined"||d==null||d.postcode==null||d.postcode===""?ND.API.requestChangePriceBuildAndPrice({complete:function(e){c.processRegionPostcode(e,false,a,b)}},false):c.processRegionPostcode(d,true,a,b)}}):c.loadPricezones.call(c,a,b)},processRegionPostcode:function(a,
b,c,d){if(b){Events.fireEvent(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,a);Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,!ConfigUtil.showPrices())}else if(a&&a.postcode){if(this.userPref.get("postcode")!==a.postcode||this.userPref.get("usage")!==a.usage){Events.fireEvent(Events.eventList.buildandprice.omniture.RegionPostcodeChangedEvent,a);Events.fireEvent(Events.eventList.buildandprice.model.RegionPostcodeChangedEvent,a);Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,
!ConfigUtil.showPrices())}}else Events.fireEvent(Events.eventList.buildandprice.router.HidePricesEvent,true);this.loadPricezones.call(this,c,d)},loadPricezones:function(a,b){var c=this;this.fetchPricezones(function(d){u.proxy(Helper.processPricezone,c)(d);ConfigUtil.showPricezones()&&Events.fireEvent(Events.eventList.buildandprice.router.UpdatePricezoneEvent,d.getSelected().get("name"));d=new s.NameplateCollection;d.url=Helper.buildURL(d.urlRoot,c.getPricezoneId(),null,null,c.userPref);c.fetchModel(Constants.storage.nameplateCollection,
d,function(e){if(b){var h=e.get(b);e.select(h);c.updateUserPrice("model",h)}a.call(c,e)})})},fetchPricezonesNameplatesAndPaths:function(a,b,c){var d=this;this.fetchPricezonesAndNameplates(function(e){e=e.getSelected();e=d.createPaths(c,e,b);u.proxy(a,d)(e)},b)},createPaths:function(a,b,c){var d=this.storage.get(Constants.storage.pathCollection),e=new s.PathCollection,h=b.get("name"),f=b.get("hotDealUrl");f=new q.PathModel({key:Constants.path.pkg,imageURL:b.get("pkgImageURL"),pathURL:f!=null?f:Helper.constructStepUrl.call(this,
{step:Constants.state.SELECT_PACKAGE,path:Constants.path.pkg,modelId:c}),name:Constants.bpt.czp,title:Constants.bpt.sczp,instruction:Constants.bpt.ppi.replace("%1",h)});b=new q.PathModel({key:Constants.path.drv,imageURL:b.get("byoImageURL"),pathURL:Helper.constructStepUrl.call(this,{step:Constants.state.SELECT_DERIVATIVE,path:Constants.path.drv,modelId:c}),name:Constants.bpt.byon,title:Constants.bpt.byot,instruction:Constants.bpt.pbyoi.replace("%1",h)});e.add(f);e.add(b);if(typeof a==="undefined"&&
d!=null){a=d.getSelected();if(a!=null){if(a.get("key")===f.get("key"))a=f;else if(a.get("key")===b.get("key"))a=b;e.select(a)}}else if(typeof a!=="undefined"&&a!=null){if(a===f.get("key"))a=f;else if(a===b.get("key"))a=b;e.select(a)}this.storage.set(Constants.storage.pathCollection,e);return e},fetchPricezones:function(a){this.fetchModel(Constants.storage.pricezoneCollection,new s.PricezoneCollection,a)},displayEngineView:function(a){var b=a.get("engines");if(b===null){Events.fireEvent(Events.eventList.buildandprice.router.BlockUIEvent);
var c=new s.EngineTransmissionCollection;c.url=Helper.buildURL(c.urlRoot,this.getPricezoneId(),a.id,"",this.userPref);var d=this;u.when(c.fetch()).then(function(){Helper.postProcessEngines(c);d.updateUserPrice("engine",c.getSelected());a.set("engines",c);d.viewManager.displayChildView(m.EngineTransmissionListView,c);d.updateFooter(Constants.state.SELECT_ENGINE);Events.fireEvent(Events.eventList.buildandprice.router.UnblockUIEvent)}).fail(u.proxy(d.navToGenericErrorPage,d))}else{this.viewManager.displayChildView(m.EngineTransmissionListView,
b);this.updateFooter(Constants.state.SELECT_ENGINE)}},displayDerivativeDetailView:function(a,b,c){var d=this.storage.get(Constants.storage.derivativeDetailsModel),e=this.storage.get(Constants.storage.galleryCollection),h=this.storage.get(Constants.storage.categoryGrpCollection),f=this.storage.get(Constants.storage.colorCollection);d.set("showVehicleDisclaimer",ConfigUtil.showPostcodeSelect()&&b!==Constants.path.pkg);var g=this.viewManager.displayParentView(m.DerivativeDetailView,d);g.displayChildView(new m.CategoryGroupHeaderListView({collection:h}));
g.displayChildView(new m.GalleryView({collection:e}));g.displayChildView(new m.CategoryGroupBodyListView({collection:h}));h.select(h.at(0));g.displayChildView(new m.ColorListView({parent:"#cat-group-0",collection:f}));e=f.getSelected();if(!e||e==null)e=f.at(0);Events.fireEvent(Events.eventList.buildandprice.model.ColorChangedEvent.name,{color:e,isSystem:true});d.trigger(Events.eventList.buildandprice.router.LoadCompleteEvent);this.viewManager.displayTitleView(new q.PageTitleModel({title:b===Constants.path.pkg?
Constants.bpt.czpk:Constants.bpt.czm,showLatestOffersBtn:ConfigUtil.showPostcodeSelect()&&b!==Constants.path.pkg}));this.displayHeadersView(null,b);this.updateHeader(Constants.state.CUSTOMIZE_DERIVATIVE,Helper.constructStepUrl.call(this,{step:Constants.state.CUSTOMIZE_DERIVATIVE,path:b,derivativeId:c,modelId:a}));this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE);this.displayFooterView({path:b,derivativeId:c,step:Constants.state.CUSTOMIZE_DERIVATIVE})},diplayRegionOverlayView:function(a){this.viewManager.displayIndependantView("PricezoneView",
m.PricezoneOverlayView,a)},updateUserPrice:function(a,b){if(a!="features"){this.userPref.set(a+"Object",b);this.userPref.set(a+"Id",b.get("id"))}else this.updateUserPriceFeatures(b)},updateUserPriceFeatures:function(a,b){b=typeof b!=="undefined"?b:a.get("selected");var c=this.userPref.get(Constants.attr.feats+"Object");if(b){if(c.get(a.get("id"))==null){c.add(a);this.userPref.get(Constants.attr.feats).push(a.get("id"))}}else{b=this.userPref.get(Constants.attr.feats);c.remove(a);a=_.indexOf(b,a.get("id"));
if(a>=0){b.splice(a,1);this.userPref.set(Constants.attr.feats,b)}}this.userPref.set(Constants.attr.feats+"Object",c)},updatePricezoneForUserObject:function(a){this.userPref.set("priceZoneId",a.get("id"));this.userPref.set("site",Config.site)},getPricezoneId:function(){var a=this.userPref.get("priceZoneId");if(!a||a==null)a=Config.priceZoneId;return a},deferredFetchAndPersist:function(a,b){var c=u.Deferred(),d=this;u.when(b.fetch()).done(function(){d.storage.set(a,b);c.resolve()}).fail(u.proxy(d.navToGenericErrorPage,
d));return c.promise()},fetchModel:function(a,b,c){var d=this,e=d.storage.get(a);!e||e==null||e.url!=b.url?u.when(b.fetch()).done(function(){d.storage.set(a,b);c(b)}).fail(u.proxy(d.navToGenericErrorPage,d)):c(e)},updateFooter:function(a){var b=this.storage.get(Constants.storage.footerModel),c=this.storage.get(Constants.storage.nameplateCollection),d=null,e=ND.PriceFormatter.format("0"),h;this.getSelectedPackageDerivative(this.storage,{pkgCallback:function(){h=Constants.path.pkg},drvCallback:function(v){d=
v.get("engines");h=Constants.path.drv}});e=ND.PriceFormatter.format(this.userPref.total().toString());var f=null,g="",i="",o=false,l="",k,n=c.getSelected().get("id");switch(a){case Constants.state.SELECT_ENGINE:if(d&&d!=null){f=d.getSelected();if(o=f!=null)g=f.get("name")}case Constants.state.SELECT_DERIVATIVE:case Constants.state.SELECT_PACKAGE:var w=this;this.getSelectedPackageDerivative(this.storage,{pkgCallback:function(v){i=Helper.constructStepUrl.call(w,{step:Constants.state.CUSTOMIZE_DERIVATIVE,
path:Constants.path.pkg,derivativeId:v.get("id"),modelId:n});g=v.get("engineTransmission");o=true;e=Constants.bpt.f+v.get("displayPrice");l=v.get("name")},drvCallback:function(v){i=Helper.constructStepUrl.call(w,{step:Constants.state.CUSTOMIZE_DERIVATIVE,path:Constants.path.drv,derivativeId:v.get("id"),modelId:n});l=v.get("name");e=o?Constants.bpt.f+ND.PriceFormatter.format(f.get("price").toString()):Constants.bpt.f+v.get("displayPrice")}});var j=c=null;if(!ConfigUtil.isShortPath()){c="bpt-path-sel";
j=Helper.constructStepUrl.call(w,{step:Constants.state.SELECT_PATH,modelId:n})}b.update(l,e,g,o,i,j,Constants.header.c,c);break;case Constants.state.CUSTOMIZE_DERIVATIVE:case Constants.state.SUMMARY:var t,p=false,x=c=null,r=j=null;k=Constants.path.pkg;x="bpt-package-sel";this.getSelectedPackageDerivative(this.storage,{pkgCallback:function(v){p=true;t=v;g=t.get("engineTransmission")},drvCallback:function(v){k=Constants.path.drv;var B=d.getSelected();p=B!=null;t=v;x="bpt-derivative-sel";g=p?B.get("name"):
""}});r=this.storage.get(Constants.storage.categoryGrpCollection);if(a===Constants.state.CUSTOMIZE_DERIVATIVE){a=parseInt(r.getSelected().get("order"));var y=j=null;if(a+1<r.length){j=a+1;if(r.at(j).get("hideInBuildPrice")=="Yes")if(typeof r.at(j+1)!=="undefined"){c=r.at(j+1).get("categoryGrouping");j="cat-group-"+(j+1)}else{j=Helper.constructStepUrl.call(this,{step:Constants.state.SUMMARY,path:k,derivativeId:t.get("id"),modelId:n});c="bpt-summary"}else{c=r.at(j).get("categoryGrouping");j="cat-group-"+
j}}else{j=Helper.constructStepUrl.call(this,{step:Constants.state.SUMMARY,path:k,derivativeId:t.get("id"),modelId:n});c="bpt-summary"}if(a-1>=0){y=a-1;if(r.at(y).get("hideInBuildPrice")=="Yes"){x=r.at(y-1).get("categoryGrouping");r="cat-group-"+(y-1)}else{x=r.at(y).get("categoryGrouping");r="cat-group-"+y}}else r=Helper.constructStepUrl.call(this,{step:Constants.state.SELECT_PACKAGE,path:k,modelId:n})}else{x=r.at(0).get("categoryGrouping");r=Helper.constructStepUrl.call(this,{step:Constants.state.CUSTOMIZE_DERIVATIVE,
path:k,derivativeId:t.get("id"),modelId:n});if(ConfigUtil.showPostcodeSelect()&&Constants.path.drv===h)e=this.userPref.get("polkPrice")}b.update(t.get("name"),e,g,p,j,r,c,x);break;case Constants.state.SELECT_PATH:break;default:}},selectTrim:function(a){this.storage.get(Constants.storage.colorCollection).selectTrim(a);this.updateUserPrice("trim",a);this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE)},selectColor:function(a){var b=this.storage.get(Constants.storage.colorCollection);(new m.TrimListView({collection:a.color.get("trims")})).display();
b.select(a.color);b=a.color.get("trims").getSelected();if(typeof b==="undefined"||b==null)b=a.color.get("trims").at(0);this.updateUserPrice("colour",a.color);Events.fireEvent(Events.eventList.buildandprice.model.TrimSelectedEvent.name,{trim:b,isSystem:true});this.updateFooter(Constants.state.CUSTOMIZE_DERIVATIVE)},toggleOptionPackSelection:function(a,b,c){var d;if(b){if(typeof c!=="undefined")d=c}else{d=!a.get("selected");a.set("selected",d);this.updateUserPriceFeatures(a);this.updateFeatureInGallery(a,
false)}b=a.get("featureGroupAttributes");if(b!=null&&b.length>0){var e=this.storage.get(Constants.storage.categoryGrpCollection),h=d?Constants.bpt.featurePartOfOptionPack:"";b=e.toggleFeatures(b.pluck("id"),null,d);_.each(b,function(f){var g=!d&&f.get("selected");this.updateUserPriceFeatures(f,g);this.updateFeatureInGallery(f,d?false:f.get("selected"));f.set("message",h);if(f.get("isMutuallyExclusive"))this.toggleMutuallyExclusiveFeatureSelection(f,true,d||f.get("selected"));else if(f.get("hasDependentFeatures"))this.toggleDependentFeatureSelection(f,
true,d||f.get("selected"),d)},this)}if(a.get("hasDependentFeatures")){b=a.get("dependentFeaturesIds");if(b!=null&&b.length>0){e=this.storage.get(Constants.storage.categoryGrpCollection);b=e.fetchFeatures(b);h=d?Constants.bpt.featurePartOfDependentFeature:"";_.each(b,function(f){if(f.get("isOptionPack")){var g=e.toggleFeatures(new Array(f.get("id")),null,d);_.each(g,function(i){this.updateUserPriceFeatures(f,d);this.updateFeatureInGallery(f,d);f.set("message",h);if(!d&&i.get("selected")){i.set("selected",
false,{silent:true});this.toggleOptionPackSelection(i,false)}else this.toggleOptionPackSelection(i,true,d)},this)}else z.alert("Unsupported publishing configuration: Dependent Features of Option pack"+a.get("id")+" Can only be other option packs, "+f.get("id")+" is not an option pack")},this)}}},toggleDependentFeatureSelection:function(a,b,c,d){var e;if(b){if(typeof isSelectedByParent!=="undefined")e=c}else{e=!a.get("selected");a.set("selected",e);this.updateUserPriceFeatures(a,e);this.updateFeatureInGallery(a,
e);d=e}a=a.get("dependentFeaturesIds");if(a!=null&&a.length>0){b=this.storage.get(Constants.storage.categoryGrpCollection);var h=b.fetchFeatures(a);_.each(h,function(f){f.set("dependentFeatureLockCount",f.get("dependentFeatureLockCount")+(d?1:-1));f.set("message",!c&&f.get("dependentFeatureLockCount")===0?"":Constants.bpt.featurePartOfDependentFeature)});h=b.toggleFeatures(a,null,e);_.each(h,function(f){f.get("hasDependentFeatures")&&z.alert("Unsupported publishing configuration: Feature "+f.get("id")+
" is a dependent features. Cascading dependent features are not supported.");this.updateUserPriceFeatures(f,e||f.get("selected"));this.updateFeatureInGallery(f,e||f.get("selected"))},this)}},toggleMutuallyExclusiveFeatureSelection:function(a,b,c){var d;if(b){if(typeof c!=="undefined")d=c}else{d=!a.get("selected");a.set("selected",d);this.updateUserPriceFeatures(a,d);this.updateFeatureInGallery(a,d)}!c&&!b&&d&&a.set("message","");a=a.get("featureGroupAttributes");if(a!=null&&a.length>0){a=this.storage.get(Constants.storage.categoryGrpCollection).toggleFeatures(a.pluck("id"),
null,d);c=d?Constants.bpt.featurePartOfMutualExclusive:"";for(var e,h=0;h<a.length;h++){e=a[h];if(b&&!d&&e.get("selected")){e.set("selected",false,{silent:true});this.toggleMutuallyExclusiveFeatureSelection(e,false);return}this.updateUserPriceFeatures(e,false);this.updateFeatureInGallery(e,false);if(e.get("hasDependentFeatures"))z.alert("Unsupported publishing configuration: Feature "+e.get("id")+" is mutually exclusive and has dependent features. This tool does not support this combination.");else e.get("isOptionPack")&&
z.alert("Unsupported publishing configuration: Feature "+e.get("id")+" is mutually exclusive and is an option pack. This tool does not support this combination.");e.set("message",c)}}},toggleFeatureSelection:function(a){a.set({selected:!a.get("selected"),message:""});this.updateUserPriceFeatures(a);this.updateFeatureInGallery(a)},updateFeatureInGallery:function(a,b){if(Helper.getCurrentCarView(this.storage)!==Constants.view.exterior){if(a.get("spriteUrl")!=""&&(typeof b!=="undefined"?b:true))Events.fireEvent(Events.eventList.buildandprice.model.ToggleViewEvent.name,
Constants.view.exterior)}else this.storage.get(Constants.storage.galleryCollection).toggleLayer(a.get("id"),b)},clearStorageForStep:function(a){switch(a){case Constants.state.SELECT_NAMEPLATE:this.unvisitHeaders(a);this.userPref.purge();break;case Constants.state.SELECT_PATH:a=this.storage;a.set(Constants.storage.derivativeDetailsModel,null);a.set(Constants.storage.categoryGrpCollection,null);a.set(Constants.storage.headerCollection,null);a.set(Constants.storage.derivativeCollection,null);a.set(Constants.storage.packageCollection,
null);a.set(Constants.storage.colorCollection,null);a.set(Constants.storage.footerModel,null);a.set(Constants.storage.galleryCollection,null);this.userPref.purge();break;case Constants.state.SELECT_DERIVATIVE:case Constants.state.SELECT_PACKAGE:this.unvisitHeaders(a);break;case Constants.state.CUSTOMIZE_DERIVATIVE:this.userPref.set({featuresObject:new s.FeatureCollection,features:[]});break}},getSelectedPackageDerivative:function(a,b){var c=drvPath=false,d,e,h=a.get(Constants.storage.packageCollection);
if(ConfigUtil.isShortPath()){d=h.getSelected();c=d!=null}else{var f=a.get(Constants.storage.pathCollection).getSelected();if(typeof f!=="undefined"&&f!=null)if(f.get("key")===Constants.path.pkg){d=h?h.getSelected():null;c=d!=null}else{e=(a=a.get(Constants.storage.derivativeCollection))?a.getSelected():null;drvPath=e!=null}}if(typeof b!=="undefined")if(c&&typeof b.pkgCallback!=="undefined")b.pkgCallback.call(null,d);else drvPath&&typeof b.drvCallback!=="undefined"&&b.drvCallback.call(null,e)}});u(C).ready(function(){if(u("body").hasClass("shoppingtool")){z.BuildAndPriceApp=
new D;ND.analyticsTag.isSinglePageAppOmnitureConfigured()&&new BPAnalytics;Backbone.history.start()}})})(window,document,Views.Buildandprice,models,collections,jQuery);

Events.eventList.comparator={view:{NameplateClickedEvent:"NameplateSelectedEvent",DerivativeSelectedEvent:"DerivativeSelectedEvent",AddVehicleRequestEvent:"AddVehicleRequestEvent",DerivativeSelectionCancelledEvent:"DerivativeSelectionCancelledEvent",DerivativeSelectionCompletedEvent:"DerivativeSelectionCompletedEvent",RemoveDerivativeRequestEvent:"RemoveDerivativeRequestEvent",ExpandTableEvent:"ExpandTableEvent",CollapseTableEvent:"CollapseTableEvent",StartOverEvent:"StartOverEvent",PrintLinkClickedEvent:"PrintLinkClickedEvent"},
omniture:{PrintLinkClickedEvent:"Omniture:PrintLinkClickedEvent",ComparatorStartedEvent:"Omniture:ComparatorStartedEvent",CompareDerivativesEvent:"Omniture:CompareDerivativesEvent",NameplateSelectedEvent:"Omniture:NameplateSelectedEvent",DerivativeSelectedEvent:"Omniture:DerivativeSelectedEvent"},router:{PrintLinkClickedEvent:{name:"PrintLinkClickedModelEvent",handler:function(){Events.fireEvent(Events.eventList.comparator.omniture.PrintLinkClickedEvent)}},NameplateClickedEvent:{name:"NameplateClickedModelEvent",
handler:function(a){this.storage.get(Constants.comparatorStorage.nameplateCollection).click(a);this.navigateToDerivativesPage(a.get("id"))}},DerivativeSelectedEvent:{name:"DerivativeSelectedModelEvent",handler:function(a){this.toggleDerivativeSelection(a)}},DerivativeSelectionCompletedEvent:{name:"DerivativeSelectionCompletedModelEvent",handler:function(){this.navToComparePage()}},DerivativeRemovalRequestedEvent:{name:"DerivativeRemovalRequestedModelEvent",handler:function(a){this.toggleDerivativeSelection(a);
this.navToComparePage()}},AddVehicleRequestEvent:{name:"AddVehicleRequestModelEvent",handler:function(){var a=this.storage.get(Constants.comparatorStorage.comparisonChart).get("derivatives");if(a==null||a.length<4)this.navToNameplatesPage()}},StartOverEvent:{name:"StartOverModelEvent",handler:function(){var a=this.storage.get(Constants.comparatorStorage.comparisonChart);if(a!=null&&a.get("derivatives")!=null){a.get("derivatives").reset();a.get("categories").reset();a.get("tables").reset();a.set({startOver:false,
canAdd:true,hasKeyFeature:false,derivativeIds:[]})}this.storage.get(Constants.comparatorStorage.nameplateContainer).set({vehicleCount:0,errorMessage:"",enabled:false});a=this.storage.get(Constants.comparatorStorage.nameplateCollection);_.each(a.models,function(b){var c=b.get("derivatives");if(c&&c!=null){c.deselectAll();b.set("selected",false);b.set("clicked",false)}});Events.fireEvent(Events.eventList.comparator.view.DerivativeSelectionCancelledEvent);this.navToNameplatesPage()}},BlockUIEvent:"BlockUIEvent",
UnblockUIEvent:"UnblockUIEvent",TableLoadCompletedEvent:"TableLoadCompletedEvent",DerivativeListUpdatedEvent:"DerivativeListUpdatedEvent",DerivativesChangedEvent:"DerivativesChangedEvent"}};

var CAnalytics=Backbone.Model.extend({defaults:{nameplates:[],derivatives:[]},initialize:function(){Events.bind(Events.eventList.comparator.omniture.NameplateSelectedEvent,this.nameplateSelected,this);Events.bind(Events.eventList.comparator.omniture.DerivativeSelectedEvent,this.derivativeSelected,this);Events.bind(Events.eventList.comparator.router.StartOverEvent.name,this.startOver,this);Events.bind(Events.eventList.comparator.view.StartOverEvent,this.startOver,this);Events.bind(Events.eventList.comparator.omniture.ComparatorStartedEvent,
this.comparatorStarted,this);Events.bind(Events.eventList.comparator.omniture.CompareDerivativesEvent,this.compareDerivatives,this);Events.bind(Events.eventList.comparator.omniture.PrintLinkClickedEvent,this.printLinkClicked,this)},findEntity:function(a,b){var c=0,d=-1;_.find(b,function(e){if(e.get("id")===a.get("id")){d=c;return true}else{c++;return false}});return d},nameplateSelected:function(a){this.entitySelected(a,this.get("nameplates"))},derivativeSelected:function(a){this.entitySelected(a,
this.get("derivatives"))},entitySelected:function(a,b){if(a.get("selected"))if(b.length>0&&this.findEntity(a,b)===-1)b.push(a);else b.length===0&&b.push(a);else{a=this.findEntity(a,b);a>=0&&b.splice(a,1)}},startOver:function(){this.set("nameplates",[]);this.set("derivatives",[])},comparatorStarted:function(){this.trackOmnitureAction({action:"ComparatorStarted"})},compareDerivatives:function(){this.trackOmnitureAction({action:"CompareDerivatives"})},printLinkClicked:function(){this.trackOmnitureAction({action:"PrintLinkClicked"})},
resetOmnitureVars:function(){_da.tool=_da.der=_da.nameplate=_da.events=_da.region=undefined;_da.funnel.stepname=undefined},setupOmnitureVars:function(a){_da.funnel.stepname=a.stepName;if(true!==a.dontAddNamplates){var b=this.get("nameplates");if(b!=null&&b.length>0){b=b[0];_da.nameplate={name:b.get("analyticsName")||b.get("name"),year:b.get("modelYear"),id:b.get("id"),cat:b.get("analyticsCategory")||b.get("category")}}if(typeof a.der!=="undefined")_da.der=a.der;if(typeof a.events!=="undefined"&&a.events!=
null)_da.events=a.events.split(",")}},trackOmnitureAction:function(a){this.resetOmnitureVars();switch(a.action){case "ComparatorStarted":a.stepName="";a.dontAddNamplates=true;this.trackOmniture(a);break;case "CompareDerivatives":a.stepName="summary";var b=this.get("derivatives")[0];a.der={name:b.get("name")};a.events="event12,event43";this.trackOmniture(a);break;case "PrintLinkClicked":b={type:"o"};b.pname=_da.pname+":summary";b.link=b.title="compare:summary:print";b.onclicks="print compare";this.setupOmnitureVars(a);
$.publish("/analytics/link/",b);break}},trackOmniture:function(a){this.setupOmnitureVars(a);ND.analyticsTag.trackOmnitureSinglePageApp()}});

var ComparatorModels=function(a,f,g,b){a={};a.ErrorModel=b.Model.extend({title:null,message:null,defaults:{showPricezone:true},initialize:function(){Events.bindToEvent(this,Events.eventList.comparator.view.StartOverEvent,Events.eventList.comparator.model.StartOverEvent.name,this);Events.bindToEvent(this,Events.eventList.comparator.view.PricezoneChangeRequestEvent,Events.eventList.comparator.model.PricezoneChangeRequestEvent.name,this)}});a.PriceZoneModel=b.Model.extend({id:null,name:null,priceFormat:null,
defaults:{"default":false,pricesDisabled:false,selected:false}});a.NameplateContainer=b.Model.extend({defaults:{errorMessage:"",vehicleCount:0,enabled:false},nameplates:null});a.Nameplate=b.Model.extend({category:null,id:null,imageURL:null,modelCode:null,name:null,order:null,nameplateURL:null,byoImageURL:null,modelYear:null,packageImageURL:null,defaults:{makeCode:"",makeId:"",makeName:"Ford",displayPrice:0,thumbnailURL:"",count:"",price:0,selected:false,clicked:false},derivatives:null,initialize:function(){Events.bindToEvent(this,
Events.eventList.comparator.view.NameplateClickedEvent,Events.eventList.comparator.router.NameplateClickedEvent.name,this)}});a.Derivative=b.Model.extend({id:null,name:"c-derivative",modelCode:null,priceZoneId:null,nameAuthoring:null,defaults:{thumbnailURL:"",imageURL:"",displayPrice:0,order:0,price:0,selected:false},initialize:function(){Events.bindToEvent(this,Events.eventList.comparator.view.DerivativeSelectedEvent,Events.eventList.comparator.router.DerivativeSelectedEvent.name,this)}});a.ComparisonChart=
b.Model.extend({derivatives:null,categories:null,tables:null,urlRoot:Config.comparator.urls.compareURL,defaults:{hasKeyFeature:false,derivativeIds:[],startOver:false,canAdd:true},getDerivativeCount:function(){return this.derivativeIds&&this.derivativeIds!=null?this.derivativeIds.length:0},parse:function(d){for(var c in this){var e=null;if(c=="categories")e=new ComparatorCollections.ComparableCategories;else if(c=="derivatives")e=new ComparatorCollections.ComparableDerivatives;if(e!=null){e.add(d[c],
{parse:true});d[c]=e}}return d}});a.Table=b.Model.extend({defaults:{title:"",order:0,isOpen:false},rows:null});a.Row=b.Model.extend({header:null,columns:null,defaults:{order:0,hasNote:false,noteCounter:0,note:null}});a.Column=b.Model.extend({derivativeId:null,defaults:{value:""}});a.ComparableDerivative=b.Model.extend({derivativeId:null,name:null,defaults:{thumbnailURL:"",displayPrice:0,nameplateId:"",summary:"",order:0,price:0},categories:null,parse:function(d){for(var c in this)if(c=="categories"){var e=
new ComparatorCollections.ComparableCategories;e.add(d[c],{parse:true});d[c]=e}return d}});a.ComparableCategory=b.Model.extend({name:null,features:null,parse:function(d){for(var c in this)if(c=="features"){var e=new ComparatorCollections.ComparableFeatures;e.add(d[c],{parse:true});d[c]=e}return d}});a.ComparableFeature=b.Model.extend({name:null,defualts:{value:""},noteAssigned:null,note:null});a.Storage=b.Model.extend({pricezoneCollection:null,nameplateCollection:null,comparisonChart:null,nameplateContainer:null});
return a}(window,document,jQuery,Backbone);

var ComparatorCollections=function(a,d,b){a={};a.Pricezones=Backbone.Collection.extend({model:b.PriceZoneModel,urlRoot:Config.comparator.urls.pricezoneListURL,initialize:function(){this.bind(Events.eventList.comparator.view.PricezoneSelectedEvent,this.pricezoneSelected,this)},pricezoneSelected:function(c){c=this.selectById(c);Events.fireEvent(Events.eventList.comparator.model.PricezoneSelectedEvent.name,c)},comparator:function(c){return c.get("name")}});a.Nameplates=Backbone.Collection.extend({model:b.Nameplate,
urlRoot:Config.comparator.urls.modelListURL,supportsMultiSelect:function(){return true},clickable:function(){return true},comparator:function(c){return parseInt(c.get("order"))}});a.Derivatives=Backbone.Collection.extend({model:b.Derivative,urlRoot:Config.comparator.urls.derivativeListURL,supportsMultiSelect:function(){return true},comparator:function(c){return parseInt(c.get("order"))}});a.ComparableDerivatives=Backbone.Collection.extend({model:b.ComparableDerivative});a.ComparableCategories=Backbone.Collection.extend({model:b.ComparableCategory});
a.Tables=Backbone.Collection.extend({model:b.Table});a.Rows=Backbone.Collection.extend({model:b.Row});a.Columns=Backbone.Collection.extend({model:b.Column});a.ComparableFeatures=Backbone.Collection.extend({model:b.ComparableFeature});return a}(window,document,ComparatorModels,jQuery);

Views.Comparator=function(h,j,b,i){var e={};e.NameplateNavigationView=Backbone.View.extend({className:"comparatortips",initialize:function(){this.template=_.template(b("#c-nameplate-nav-template").html());this.model.bind("change",this.render,this);Events.bind(Events.eventList.comparator.view.DerivativeSelectionCompletedEvent,this.hide,this);Events.bind(Events.eventList.comparator.view.DerivativeSelectionCancelledEvent,this.hide,this)},events:{"click #c-compare-close":"close","click #c-compare":"compareClicked"},
compareClicked:function(a){a.preventDefault();if(b(a.target).hasClass("enabled"))Events.fireEvent(Events.eventList.comparator.view.DerivativeSelectionCompletedEvent);else return false},close:function(a){a.preventDefault();Events.fireEvent(Events.eventList.comparator.view.DerivativeSelectionCancelledEvent)},show:function(){var a=this.$el;a.hasClass("hidden")&&a.removeClass("hidden")},hide:function(){var a=this.$el;a.hasClass("hidden")||a.addClass("hidden")},display:function(){b("#c-select-nameplate-container").hasClass("c-empty")?
b("#c-select-nameplate-container").removeClass("c-empty").prepend(this.render().$el):this.show()}});e.NameplateListView=Backbone.View.extend({children:[],id:"c-select-nameplate-container",className:"bpc_model_select c-empty",render:function(){var a=0,c=this.$el;c.html(this.template());var d=c.find("#c-featurecarousel-ul"),f=this;_.each(this.collection.models,function(g){f.children[a]=new e.NameplateItemView({model:g});d.append(f.children[a].render().$el);a++},this);if(this.children.length===3)d.addClass("bpc_3_models");
else this.children.length===4&&d.addClass("bpc_4_models");return this},initialize:function(){this.template=_.template(b("#c-nameplate-list-template").html());Events.bind(Events.eventList.comparator.view.DerivativeSelectionCompletedEvent,this.hide,this);Events.bind(Events.eventList.comparator.view.DerivativeSelectionCancelledEvent,this.hide,this)},show:function(){var a=this.$el;a.hasClass("hidden")&&a.removeClass("hidden")},hide:function(){var a=this.$el;a.hasClass("hidden")||a.addClass("hidden");
b("#tables .expandactols").size()&&b(".print_icon").show();a.hasClass("bpc_model_select")&&b(".overlay-wrap").length>0&&b(".overlay-wrap").remove()},create:function(){if(this.children&&this.children.length>0){_.each(this.children,function(c){c.destroy()});this.children=[];this.$el.empty()}b("#comparator-select-nameplate").html(this.render().$el).removeClass("c-empty");var a=b("#common-config").embeddedData().site;a&&a.indexOf("LCN")===-1&&b.fn.buildComparatorCarousel("#c-nameplate-carousel");this.lazyload()},
display:function(){b("#comparator-select-nameplate").hasClass("c-empty")?this.create():this.show();var a=b("body");a.hasClass("lincoln_comparator")&&this.loadOverlayMask();b(".print_icon").hide()},loadOverlayMask:function(){b("body").append('<div class="overlay-wrap"></div>');var a=b(".overlay-wrap");a.on("click",function(){a.remove();b(".bpc_model_select").addClass("hidden")})}});e.NameplateItemView=Backbone.View.extend({tagName:"li",className:"c-nameplate-list-item",events:{"click .c-nameplate-list-item":"nameplateSelected"},
nameplateSelected:function(a){a.preventDefault();this.model.trigger(Events.eventList.comparator.view.NameplateClickedEvent,this.model)},initialize:function(){this.template=_.template(b("#c-nameplate-list-item-template").html());this.model.bind("change:selected change:clicked",this.toggleClass,this);this.model.bind("change:count",this.updateCount,this);this.model.bind(Events.eventList.comparator.router.DerivativesChangedEvent,this.renderDerivatives,this);this.model.bind("destroy",this.destroy,this)},
render:function(){var a=this.template(this.model.toJSON());this.toggleClass().html(a);return this},toggleClass:function(){var a=b(this.el);a.toggleClass("click",this.model.get("clicked")&&!this.model.get("selected")).toggleClass("cur",this.model.get("selected"));return a},updateCount:function(){b(this.el).find(".count").text(this.model.get("count"))},renderDerivatives:function(){var a=this.model.get("derivatives");a!=null&&(new e.DerivativeListView({collection:a})).create()}});e.DerivativeListView=
Backbone.View.extend({children:[],id:"c-select-derivative-container",render:function(){var a=0,c=this.$el;c.html(this.template());var d=c.find("#c-drv-featurecarousel-ul"),f=this;_.each(this.collection.models,function(g){f.children[a]=new e.DerivativeItemView({model:g});d.append(f.children[a].render().$el);a++},this);if(this.children.length===4)d.addClass("bpc_4_derivatives");else this.children.length===5&&d.addClass("bpc_5_derivatives");return this},initialize:function(){this.template=_.template(b("#c-derivative-list-template").html());
Events.bind(Events.eventList.comparator.view.DerivativeSelectionCompletedEvent,this.hide,this);Events.bind(Events.eventList.comparator.view.DerivativeSelectionCancelledEvent,this.hide,this)},show:function(){var a=this.$el;a.hasClass("hidden")&&a.removeClass("hidden")},hide:function(){var a=this.$el;a.hasClass("hidden")||a.addClass("hidden")},create:function(){if(this.children&&this.children.length>0){_.each(this.children,function(a){a.destroy()});this.children=[];this.$el.empty()}b("#c-nameplate-derivatives").html(this.render().$el);
this.lazyload()}});e.DerivativeItemView=Backbone.View.extend({tagName:"li",events:{"click .c-derivative-list-item":"derivativeSelected"},derivativeSelected:function(a){a.preventDefault();this.model.trigger(Events.eventList.comparator.view.DerivativeSelectedEvent,this.model)},initialize:function(){this.template=_.template(b("#c-derivative-list-item-template").html());this.model.bind("change:selected",this.toggleClass,this);this.model.bind("destroy",this.destroy,this)},render:function(){var a=this.template(this.model.toJSON());
this.toggleClass().html(a);return this},toggleClass:function(){var a=b(this.el);a.toggleClass("cur",this.model.get("selected"));return a}});e.AddDerivativeView=Backbone.View.extend({className:"derivative add",events:{click:"addVehicleClicked"},addVehicleClicked:function(a){a.preventDefault();Events.fireEvent(Events.eventList.comparator.view.AddVehicleRequestEvent)},initialize:function(){this.template=_.template(b("#c-add-to-compare-template").html())},render:function(){b(this.el).html(this.template());
return this}});e.VehicleComparisonView=Backbone.View.extend({children:[],el:"#c-comparison-chart",events:{"click #c-start-over":"startOver"},startOver:function(a){a.preventDefault();Events.fireEvent(Events.eventList.comparator.view.StartOverEvent)},render:function(){var a=this.$el,c=a.find("#c-first-row");if(c.length<=0){a.html(this.template());c=a.find("#c-first-row")}else c.empty();c.append(this.keyFeaturesTemplate({hasKeyFeature:this.model.get("hasKeyFeature"),startOver:this.model.get("startOver")}));
var d=this.model.get("derivatives");if(d!=null&&d.length>0){this.children[0]=new e.VehiclesView({collection:d});c.append(this.children[0].render().$el);this.lazyload()}if(this.model.get("canAdd")){d=new e.AddDerivativeView({model:{}});c.append(d.render().$el);this.children[1]=d;a.prepend(c)}return this},initialize:function(){this.template=_.template(b("#c-first-row-template").html());this.keyFeaturesTemplate=_.template(b("#c-key-features-template").html());this.model.bind("change",this.render,this);
this.model.bind("destroy",this.destroy,this)},display:function(){this.render()}});e.VehiclesView=Backbone.View.extend({children:[],initialize:function(){this.collection.bind("reset",this.reset,this)},render:function(){if(this.collection!=null&&this.collection.length>0){var a=this.$el,c=0;_.each(this.collection.models,function(d){this.children[c]=new e.VehicleView({model:d});a.append(this.children[c].render().$el);c++},this)}return this},reset:function(){this.children!=null&&this.children.length>0&&
_.each(this.children,function(a){a.destroy()});this.children=[];this.$el.empty()}});e.VehicleView=Backbone.View.extend({className:"derivative",events:{"click .remove":"removeVehicleClicked"},removeVehicleClicked:function(a){a.preventDefault();Events.fireEvent(Events.eventList.comparator.view.RemoveDerivativeRequestEvent,this.model)},initialize:function(){this.template=_.template(b("#c-vehicle-template").html());this.model.bind("destroy",this.destroy,this)}});e.TablesView=Backbone.View.extend({children:[],
initialize:function(){this.template=_.template(b("#c-tables-template").html());this.collection.bind("destroy",this.destroy,this);this.collection.bind("reset",this.reset,this);this.collection.on("add",this.add,this);this.collection.on("remove",this.remove,this);this.collection.bind(Events.eventList.comparator.router.TableLoadCompletedEvent,this.initTooltip,this);this.expandCollapseButtonsAdded=false;b("#print-comparator-data").on("click",function(){Events.fireEvent(Events.eventList.comparator.view.PrintLinkClickedEvent);
h.print()})},events:{"click .c-expand-collapse-all":"toggleExpandCollapse"},initTooltip:function(){if(this.children.length>0){if(this.expandCollapseButtonsAdded===false){this.$el.prepend(this.template());this.expandCollapseButtonsAdded=true}b.fn.tooltip();this.children[0].expand()}b(".print_icon").show()},toggleExpandCollapse:function(a){a.preventDefault();a=b(a.target);if(a.attr("id")==="c-expand-all"||a.parent().attr("id")==="c-expand-all")Events.fireEvent(Events.eventList.comparator.view.ExpandTableEvent);
else if(a.attr("id")==="c-collapse-all"||a.parent().attr("id")==="c-collapse-all")Events.fireEvent(Events.eventList.comparator.view.CollapseTableEvent)},reset:function(){_.each(this.children,function(a){a.destroy()});this.children=[];this.$el.empty();this.expandCollapseButtonsAdded=false},add:function(a){this.$el.append((this.children[this.children.length]=new e.TableView({model:a})).render().$el)},remove:function(a){var c=a.get("id"),d=0;if((a=_.find(this.children,function(f){if(c===f.model.get("id"))return f;
d++}))&&a!=null){this.children.splice(d,1);a.destroy()}},render:function(){return this},display:function(){b("#tables").append(this.$el)}});e.TableView=Backbone.View.extend({children:[],className:"row expanddiv",events:{"click .c-table-title":"collapseExpand"},collapseExpand:function(a){a.preventDefault();this.$body.hasClass("hidden")?this.expand():this.collapse()},expand:function(){this.$body.removeClass("hidden");this.$head.addClass("comparator_icon_down");this.$head.removeClass("comparator_icon_right");
if(this.rowExpansionApplied===false){this.$body.each(function(){b(this).find(".row").each(function(){var a=b(this).outerHeight();b(this).find(".column").each(function(){b(this).css("height",a)});b(this).find(".column-header").each(function(){b(this).css("height",a)})})});this.rowExpansionApplied=true}},collapse:function(){this.$body.addClass("hidden");this.$head.removeClass("comparator_icon_down");this.$head.addClass("comparator_icon_right")},initialize:function(){this.template=_.template(b("#c-table-template").html());
this.model.bind("destroy",this.destroy,this);Events.bind(Events.eventList.comparator.view.CollapseTableEvent,this.collapse,this);Events.bind(Events.eventList.comparator.view.ExpandTableEvent,this.expand,this);this.rowExpansionApplied=false},render:function(){var a=this.$el;if(b("body").hasClass("lincoln_comparator"))this.model.attributes.title='<h3 class="title">'+this.model.attributes.title+"</h3>";a.html(this.template(this.model.toJSON()));var c=this.model.get("rows");if(c&&c!=null&&c.length>0){this.children[0]=
new e.RowsView({collection:c});a.append(this.children[0].render().$el)}if(typeof this.$tbody==="undefined"){this.$body=a.find(".c-header");this.$head=a.find(".c-table-title")}return this}});e.RowsView=Backbone.View.extend({className:"comparator_content c-header hidden",initialize:function(){this.template=_.template(b("#c-row-template").html());this.tooltipTemplate=_.template(b("#c-tooltip-template").html());this.collection.bind("reset",this.reset,this);this.collection.bind("add",this.addRow,this)},
reset:function(){this.$el.empty()},addRow:function(a,c,d){this.$el.append(this.renderRow(a,this.classForRow(d.index,this.collection.length-1)))},render:function(){var a=0,c=this.$el,d=this.collection.length-1;_.each(this.collection.models,function(f){c.append(this.renderRow(f,this.classForRow(a,d)));a++},this);return this},renderRow:function(a,c){var d=b(this.template({header:a.get("header"),className:c}));c=a.get("columns");c!=null&&c.length>0&&_.each(c.models,function(g){d.append(this.renderColumn(g))},
this);c=d.find(".column-header > .c-table-cell");var f=a.get("hasNote");f&&c.append(this.tooltipTemplate({hasNote:f,note:a.get("note"),noteCounter:a.get("noteCounter")}));return d},renderColumn:function(a){var c=a.get("hasNote"),d=b('<div class="column"><div class="c-table-cell"><span class="p">'+a.get("value")+"</span></div></div>");c&&d.find(".c-table-cell").append(this.tooltipTemplate({hasNote:c,note:a.get("note"),noteCounter:a.get("noteCounter")}));return d},classForRow:function(a){var c="";if(a===
0)c="first ";c+=a%2==0?"tooltip-row row even":"tooltip-row row odd";return c}});e.Util={loader:null,stack:[],showView:function(a,c,d){if(e.Util.stack[a]===i)e.Util.stack[a]=new c({model:d,collection:d});e.Util.stack[a].display()},blockUI:function(){if(e.Util.loader==null)e.Util.loader=ND.loadmask();e.Util.loader.show()},unblockUI:function(){e.Util.loader!=null&&e.Util.loader.hideSlowly()}};return e}(window,document,jQuery);

(function(C,D,g,m,n,k){var F=Backbone.Router.extend({routes:{"":"navToNameplatesPage","add/n/:nameplateId":"navToNameplatesPage"},navToNameplatesPage:function(a){var c=this,b=this.storage.get(Constants.comparatorStorage.nameplateCollection),d=c.storage.get(Constants.comparatorStorage.nameplateContainer);if(!b||b===null){g.Util.blockUI();this.fetchModel(Constants.comparatorStorage.nameplateCollection,new n.Nameplates,function(e){var f=this.storage.get(Constants.comparatorStorage.comparisonChart);if(f==
null){f=new m.ComparisonChart({canAdd:true,startOver:false,derivatives:null});this.storage.set(Constants.comparatorStorage.comparisonChart,f);g.Util.showView("VehicleComparisonView",g.VehicleComparisonView,f)}if(d==null){d=new m.NameplateContainer({vehicleCount:f.getDerivativeCount()});c.storage.set(Constants.comparatorStorage.nameplateContainer,d)}c.selectNameplate(e,d,a);g.Util.unblockUI()},function(e){e=t.buildURL(e.urlRoot);if(typeof this.nameplateWhitelist!=="undefined"&&this.nameplateWhitelist.length>
0)e+="?mid="+this.nameplateWhitelist.join(",");return e})}else this.selectNameplate(b,d,a)},selectNameplate:function(a,c,b){g.Util.showView("NameplateListView",g.NameplateListView,a);g.Util.showView("NameplateNavigationView",g.NameplateNavigationView,c);c=a.getSelected();var d=a.getClicked();if(c!=null&&c.length>0)this.navigateToDerivativesPage(c[0].get("id"));else if(d!=null)this.navigateToDerivativesPage(d.get("id"));else if(typeof b!=="undefined")(a=a.clickById(b))&&a!=null&&this.navigateToDerivativesPage(b);
Events.fireEvent(Events.eventList.comparator.omniture.ComparatorStartedEvent)},navigateToDerivativesPage:function(a){var c=this.storage.get(Constants.comparatorStorage.nameplateCollection).get(a);if(c!=null){var b=c.get("derivatives");if(typeof b==="undefined"||b==null){b=new n.Derivatives;b.url=t.buildURL(b.urlRoot,a);g.Util.blockUI();k.when(b.fetch()).then(function(){c.set("derivatives",b);g.Util.unblockUI();c.trigger(Events.eventList.comparator.router.DerivativesChangedEvent)})}else c.trigger(Events.eventList.comparator.router.DerivativesChangedEvent)}},
navToComparePage:function(){g.Util.blockUI();var a=this.storage.get(Constants.comparatorStorage.comparisonChart),c=a&&a!=null&&a.get("derivativeIds");if(c&&c!=null)if(c.length>0){a.url=a.urlRoot;a.url+=c.join(",");var b=this;k.when(b.deferredFetchAndPersist(Constants.comparatorStorage.comparisonChart,a)).then(function(){b.displayCompareChart(a);g.Util.unblockUI()})}else{Events.fireEvent(Events.eventList.comparator.router.StartOverEvent.name);g.Util.unblockUI()}else g.Util.unblockUI()},displayCompareChart:function(a){var c=
a.get("categories"),b=a.get("tables");if(b==null){b=new n.Tables;g.Util.showView("TablesView",g.TablesView,b)}else b.reset();var d=a.get("derivatives"),e=0,f=new n.Columns,o=false,h=false,i=0;_.each(c.models,function(j){var z=j.get("id"),E=j.get("features"),u=new n.Rows;j=new m.Table({title:j.get("name"),id:z,rows:u,order:i});i++;var r=0;_.each(E.models,function(s){var A=new n.Columns,v;_.each(d.models,function(p){r==0&&!o&&f.add(new m.Column({value:p.get("name"),derivativeId:p.get("derivativeId")}));
if(h===false&&p.get("summary")!="")h=true;var l=p.get("categories").get(z).get("features").get(s.get("id"));v=l.get("value");var q=l.get("noteAssigned"),w=l.get("note");l=w&&w!=null;var B=q&&q!=null;q=l?w:""+(B?q:"");l=B||l;A.add(new m.Column({value:v?v:"",derivativeId:p.get("derivativeId"),hasNote:l,noteCounter:l?++e:0,note:l?q:null}))});if(r==0){o=true;u.add(new m.Row({header:"&nbsp;",order:0,id:0,columns:f}))}r++;var x=s.get("note"),y=x&&x!=null;u.add(new m.Row({header:s.get("name"),id:s.get("id"),
order:r,columns:A,hasNote:y,noteCounter:y?++e:0,note:y?x:null}))});b.add(j)});b.trigger(Events.eventList.comparator.router.TableLoadCompletedEvent);a.set({canAdd:d.length<4,tables:b,hasKeyFeature:h,startOver:d.length>0},{silent:true});a.trigger("change");this.storage.set(Constants.comparatorStorage.comparisonChart,a);Events.fireEvent(Events.eventList.comparator.omniture.CompareDerivativesEvent)},registerEvents:function(){Events.eventBus.context=this;Events.bind(Events.eventList.comparator.router.NameplateClickedEvent.name,
Events.eventList.comparator.router.NameplateClickedEvent.handler,this);Events.bind(Events.eventList.comparator.router.DerivativeSelectedEvent.name,Events.eventList.comparator.router.DerivativeSelectedEvent.handler,this);Events.bind(Events.eventList.comparator.view.AddVehicleRequestEvent,Events.eventList.comparator.router.AddVehicleRequestEvent.handler,this);Events.bind(Events.eventList.comparator.view.DerivativeSelectionCompletedEvent,Events.eventList.comparator.router.DerivativeSelectionCompletedEvent.handler,
this);Events.bind(Events.eventList.comparator.view.RemoveDerivativeRequestEvent,Events.eventList.comparator.router.DerivativeRemovalRequestedEvent.handler,this);Events.bind(Events.eventList.comparator.view.StartOverEvent,Events.eventList.comparator.router.StartOverEvent.handler,this);Events.bind(Events.eventList.comparator.router.StartOverEvent.name,Events.eventList.comparator.router.StartOverEvent.handler,this);Events.bind(Events.eventList.comparator.view.PrintLinkClickedEvent,Events.eventList.comparator.router.PrintLinkClickedEvent.handler,
this)},toggleDerivativeSelection:function(a){var c=this.storage.get(Constants.comparatorStorage.nameplateCollection),b=this.storage.get(Constants.comparatorStorage.comparisonChart).get("derivativeIds"),d=b.length,e=a.get("id")||a.get("derivativeId"),f=this.storage.get(Constants.comparatorStorage.nameplateContainer);_.find(c.models,function(o){var h=o.get("derivatives");if(h&&h!=null){var i=h.get(e);if(i!=null){f.set("errorMessage","",{silent:true});if(i.get("selected")===false)if(d<4){b.push(i.get("id"));
i.set("selected",true);i.set("clicked",false)}else f.set("errorMessage",Constants.ct.limitReached,{silect:true});else{var j=_.indexOf(b,e);if(j>=0){b.splice(j,1);i.set("selected",false);i.set("clicked",false)}}h=h.getSelected();j=b.length;f.set({vehicleCount:j,enabled:j>1&&j<=4});o.set({selected:h!=null&&h.length!==0,count:h!=null?h.length:""});Util.log("is nameplate selected?"+o.get("selected"));Events.fireEvent(Events.eventList.comparator.omniture.NameplateSelectedEvent,o);Events.fireEvent(Events.eventList.comparator.omniture.DerivativeSelectedEvent,
i);return i}}})},deferredFetchAndPersist:function(a,c){var b=k.Deferred(),d=this;k.when(c.fetch()).done(function(){d.storage.set(a,c);b.resolve()}).fail(k.proxy(this.navToGenericErrorPage,d));return b.promise()},fetchModel:function(a,c,b,d){var e=this,f=e.storage.get(a);c.url=d?d.call(e,c):t.buildURL(c.urlRoot);!f||f==null||f.url!=c.url?k.when(c.fetch()).done(function(){e.storage.set(a,c);b.call(e,c)}).fail(k.proxy(this.navToGenericErrorPage,e)):b.call(e,f)},initialize:function(){this.storage=new m.Storage;
this.registerEvents();this.storage.set(Constants.comparatorStorage.comparableDerivativeCollection,new n.ComparableDerivatives);var a=k("#comparator-nameplate-whitelist");if(a.length)this.nameplateWhitelist=a.embeddedData().whitelist}}),t={buildURL:function(a,c){return a.replace(":pricezoneId",Config.priceZoneId).replace(":id",c)}};k(D).ready(function(){if(k("body").hasClass("bpcomparator")){C.ComparatorApp=new F;ND.analyticsTag.isSinglePageAppOmnitureConfigured()&&new CAnalytics;Backbone.history.start()}})})(window,
document,Views.Comparator,ComparatorModels,ComparatorCollections,jQuery);

ND.CP=window.ND.CP||{};ND.CP.Models=function(a,b){a={};a.CPDerivative=b.Model.extend({});a.CPColour=b.Model.extend({});a.CPTrim=b.Model.extend({});return a}(jQuery,Backbone);

ND.CP.Collections=function(a,c,b){a={};a.CPDerivative=c.Collection.extend({model:b.CPDerivative});a.CPColour=c.Collection.extend({model:b.CPColour,buildUrl:function(d){this.url=this.baseUrl.replace("{derivativeId}",d)}});a.CPTrim=c.Collection.extend({model:b.CPTrim,initialize:function(d){_.each(d,function(e){this.collection.add(new b.CPTrim({name:e.name,imageURL:e.imageURL}))},this)}});return a}(jQuery,Backbone,ND.CP.Models);

ND.CP.Views=function(d,g,b,c){d={};d.CPDerivativeSelector=c.View.extend({events:{"change select":"onChange"},initialize:function(){this.$el=b("#cp-derivative-selector");this.template=_.template(b("#cp-derivative-selector-template").html());this.collection.bind("change:selected",this.render,this)},render:function(){this.$el.html(this.template({collection:this.collection.models}));return this},updateSelected:function(){this.$el.html()},onCollectionReset:function(){this.render()},onChange:function(a){a=
this.collection.get(b(a.currentTarget).val());c.trigger(ND.CP.Events.ChangeSelectedDerivative,a)}});d.CPCar=c.View.extend({initialize:function(){this.template=_.template(b("#cp-car-template").html());this.$el=b("#cp-car")},render:function(){this.$el.hide();this.$el.html(this.template({model:this.model}));this.$el.fadeIn();return this}});d.CPColourSelector=c.View.extend({initialize:function(){this.$el=b("#cp-colour-selector");this.template=_.template(b("#cp-colour-selector-template").html());this.colourItemTemplate=
_.template(b("#cp-colour-selector-item-template").html());this.collection.bind("reset",this.renderColours,this);this.collection.bind("change:selected",this.renderModel,this)},renderColours:function(){this.$el.html(this.template());var a=this.$el.find("#cp-colour-list");this.collection.each(function(e){e=new ND.CP.Views.CPColourSelectorItem({model:e,template:this.colourItemTemplate});a.append(e.render().$el)},this);return this},renderModel:function(a){a.selected||this.$el.find(".cp-sub-title").html("&#x200F;"+
a.get("name"))}});d.CPColourSelectorItem=c.View.extend({tagName:"li",events:{"click .cp-color-item":"onClick"},initialize:function(a){this.template=a.template;this.model.bind("change:selected",this.toggleSelected,this)},toggleSelected:function(){var a=this.model.get("selected");b(this.el).toggleClass("cp-active",a)},render:function(){this.$el.html(this.template({model:this.model}));return this},onClick:function(a){a.preventDefault();this.model.get("selected")||c.trigger(ND.CP.Events.ChangeSelectedColour,
this.model)}});d.CPTrim=c.View.extend({initialize:function(){this.template=_.template(b("#cp-trim-template").html());this.$el=b("#cp-trim")},render:function(){this.$el.hide();if(this.model){this.$el.html(this.template({model:this.model}));this.$el.show()}return this}});d.CPTrimSelector=c.View.extend({initialize:function(){this.$el=b("#cp-trim-selector");this.template=_.template(b("#cp-trim-selector-template").html());this.trimItemTemplate=_.template(b("#cp-trim-selector-item-template").html());this.collection.bind("reset",
this.onCollectionReset,this)},render:function(){this.$el.html(this.template());var a=this.$el.find("#cp-trim-list");this.collection.each(function(e){e=new ND.CP.Views.CPTrimSelectorItem({model:e,template:this.trimItemTemplate});a.append(e.render().$el)},this);return this},onCollectionReset:function(){this.render()}});d.CPTrimSelectorItem=c.View.extend({tagName:"li",events:{"click .cp-trim-item":"onClick"},initialize:function(a){this.template=a.template;this.model.bind("change:selected",this.toggleSelected,
this)},toggleSelected:function(){var a=this.model.get("selected");b(this.el).toggleClass("cp-active",a)},render:function(){this.$el.html(this.template({model:this.model}));return this},onClick:function(a){a.preventDefault();this.model.get("selected")||c.trigger(ND.CP.Events.ChangeSelectedTrim,this.model)}});d.ViewManager=function(){var a=null,e=function(){if(a===null){a=ND.loadmask();a.show()}},f=function(){if(a!==null){a.hide();a=null}};return{initialise:function(){c.on(ND.CP.Events.BlockUI,e,this);
c.on(ND.CP.Events.UnblockUI,f,this)}}};return d}(window,document,jQuery,Backbone);

ND.CP.Events={ApplicationReady:"ApplicationReadyEvent",DerivativesLoaded:"DerivativesLoadedEvent",ChangeSelectedDerivative:"ChangeSelectedDerivativeEvent",ColoursLoaded:"ColoursLoadedEvent",ChangeSelectedColour:"ChangeSelectedColourEvent",TrimsLoaded:"TrimsLoadedEvent",ChangeSelectedTrim:"ChangeSelectedTrimEvent",BlockUI:"BlockUIEvent",UnblockUI:"UnblockUIEvent",ErrorOccurred:"ErrorOccurred"};

ND.CP.Helpers={buildURL:function(a,b){return a.replace(":derivativeId",b.derativeId)}};

ND.CP.Analytics=Backbone.Model.extend({initialize:function(){Backbone.on(ND.CP.Events.ChangeSelectedColour,this.colourChanged,this);Backbone.on(ND.CP.Events.ChangeSelectedTrim,this.trimChanged,this)},setupParams:function(a,b){a={type:b};this.resetOmnitureVars();return a},colourChanged:function(a){a=this.setupParams(a,"o");a.pname=_da.pname;a.link=a.title=_da.pname+":change color";a.onclicks="exterior:colorizer";$.publish("/analytics/link",a)},trimChanged:function(a){a=this.setupParams(a,"o");_da.region=
undefined;a.pname=_da.pname;a.link=a.title=_da.pname+":change trims";a.onclicks="exterior:trims";$.publish("/analytics/link",a)},resetOmnitureVars:function(){_da.tool=_da.der=_da.events=_da.region=undefined;_da.funnel.stepname=undefined}});

(function(d,e,c){var f=Backbone.Router.extend({selectedDerivativeId:null,selectedDerivative:null,selectedColour:null,selectedTrim:null,derivativeCollection:null,colourCollection:null,trimCollection:null,derivativeSelectorView:null,carView:null,colourSelectorView:null,trimView:null,trimSelectorView:null,viewManager:null,routes:{":derivativeId":"setDerivativeId"},setDerivativeId:function(a){this.selectedDerivativeId=a},initialize:function(){this.setupConfig();this.setupCollections();this.setupViews();
this.setupEvents();Backbone.trigger(ND.CP.Events.ApplicationReady)},setupConfig:function(){var a=c("#colour-picker-config");if(a.length>0)this.settings=c.extend(ND.CP.settings,JSON.parse(a.html()))},setupCollections:function(){this.derivativeCollection=new ND.CP.Collections.CPDerivative;this.derivativeCollection.url=this.settings.derivativesRESTPointURL;this.colourCollection=new ND.CP.Collections.CPColour;this.colourCollection.baseUrl=this.settings.colourTrimRESTPointURL;this.trimCollection=new ND.CP.Collections.CPTrim},
setupViews:function(){this.derivativeSelectorView=new ND.CP.Views.CPDerivativeSelector({collection:this.derivativeCollection});this.colourSelectorView=new ND.CP.Views.CPColourSelector({collection:this.colourCollection});this.carView=new ND.CP.Views.CPCar;this.trimView=new ND.CP.Views.CPTrim;this.trimSelectorView=new ND.CP.Views.CPTrimSelector({collection:this.trimCollection});this.viewManager=ND.CP.Views.ViewManager();this.viewManager.initialise()},setupEvents:function(){var a=this;a.derivativeCollection.on("request",
function(){Backbone.trigger(ND.CP.Events.BlockUI)});a.derivativeCollection.on("reset",function(){Backbone.trigger(ND.CP.Events.UnblockUI);Backbone.trigger(ND.CP.Events.DerivativesLoaded)});a.colourCollection.on("request",function(){Backbone.trigger(ND.CP.Events.BlockUI)});a.colourCollection.on("sync",function(){Backbone.trigger(ND.CP.Events.UnblockUI);Backbone.trigger(ND.CP.Events.ColoursLoaded)});a.trimCollection.on("reset",function(){Backbone.trigger(ND.CP.Events.TrimsLoaded)});Backbone.on(ND.CP.Events.ApplicationReady,
function(){a.derivativeCollection.fetch({reset:true})});Backbone.on(ND.CP.Events.DerivativesLoaded,function(){if(!a.derivativeCollection.length)return false;var b=a.selectedDerivativeId?a.derivativeCollection.get(a.selectedDerivativeId):a.derivativeCollection.at(0);Backbone.trigger(ND.CP.Events.ChangeSelectedDerivative,b)});Backbone.on(ND.CP.Events.ChangeSelectedDerivative,function(b){a.selectedDerivative=b;a.derivativeCollection.select(b);a.navigate(b.get("id"));a.colourCollection.buildUrl(a.selectedDerivative.id);
a.colourCollection.fetch({reset:true})});Backbone.on(ND.CP.Events.ColoursLoaded,function(){if(!a.colourCollection.length)return false;var b=a.colourCollection.at(0);Backbone.trigger(ND.CP.Events.ChangeSelectedColour,b)});Backbone.on(ND.CP.Events.ChangeSelectedColour,function(b){a.selectedColour=b;a.colourCollection.select(a.selectedColour);a.carView.model=a.selectedColour;a.carView.render();a.trimSelectorView.collection.reset(a.selectedColour.get("trims"))});Backbone.on(ND.CP.Events.TrimsLoaded,function(){var b=
a.trimCollection.at(0);Backbone.trigger(ND.CP.Events.ChangeSelectedTrim,b)});Backbone.on(ND.CP.Events.ChangeSelectedTrim,function(b){if(b){a.selectedTrim=b;a.trimCollection.select(a.selectedTrim);a.trimView.model=a.selectedTrim}else a.trimView.model=null;a.trimView.render()})}});c(e).ready(function(){if(c("#content > #colour-picker").length){_.templateSettings={interpolate:/\{\{\=(.+?)\}\}/gim,evaluate:/\{\{(.+?)\}\}/gim};d.CPApp=new f;ND.analyticsTag.isSinglePageAppOmnitureConfigured()&&new ND.CP.Analytics;
Backbone.history.start()}})})(window,document,jQuery);
